<<<<<<< HEAD
import*as e from"../../ui/legacy/legacy.js";import*as t from"../../core/i18n/i18n.js";import*as r from"../../core/platform/platform.js";import*as s from"../../core/sdk/sdk.js";import*as i from"../../ui/visual_logging/visual_logging.js";import"../../ui/legacy/components/data_grid/data_grid.js";import*as o from"../../core/host/host.js";import*as l from"../../models/text_utils/text_utils.js";import{render as a,html as n,nothing as d}from"../../ui/lit/lit.js";var u={cssText:`.data-grid{border:none}::part(url-outer){width:100%;display:inline-flex;justify-content:flex-start}::part(filter-highlight){font-weight:bold}::part(url-prefix){overflow-x:hidden;text-overflow:ellipsis}::part(url-suffix){flex:none}\n/*# sourceURL=${import.meta.resolve("./developerResourcesListView.css")} */\n`};const c={status:"Status",url:"URL",initiator:"Initiator",totalBytes:"Total Bytes",duration:"Duration",error:"Error",developerResources:"Developer resources",copyUrl:"Copy URL",copyInitiatorUrl:"Copy initiator URL",pending:"pending",success:"success",failure:"failure",sBytes:"{n, plural, =1 {# byte} other {# bytes}}"},h=t.i18n.registerUIStrings("panels/developer_resources/DeveloperResourcesListView.ts",c),p=t.i18n.getLocalizedString.bind(void 0,h),{withThousandsSeparator:g}=r.NumberUtilities;class m extends e.Widget.VBox{#e=[];#t=null;#r;#s=[];constructor(r=(r,s,i)=>{a(n`
            <devtools-data-grid
              name=${p(c.developerResources)}
              striped
              .filters=${r.filters}
               @contextmenu=${r.onContextMenu}
              class="flex-auto"
            >
              <table>
                <tr>
                  <th id="status" sortable fixed width="60px">
                    ${p(c.status)}
                  </th>
                  <th id="url" sortable width="250px">
                    ${p(c.url)}
                  </th>
                  <th id="initiator" sortable width="80px">
                    ${p(c.initiator)}
                  </th>
                  <th id="size" sortable fixed width="80px" align="right">
                    ${p(c.totalBytes)}
                  </th>
                  <th id="duration" sortable fixed width="80px" align="right">
                    ${p(c.duration)}
                  </th>
                  <th id="error-message" sortable width="200px">
                    ${p(c.error)}
                  </th>
                </tr>
                ${r.items.map((s=>n`
                  <tr selected=${s===this.#t||d}
                      data-url=${s.url??d}
                      data-initiator-url=${s.initiator.initiatorUrl??d}>
                    <td>${!0===s.success?p(c.success):!1===s.success?p(c.failure):p(c.pending)}</td>
                    <td title=${s.url} aria-label=${s.url}>${(()=>{const t=function(t){const r=document.createElement("div");e.ARIAUtils.setHidden(r,!0),r.setAttribute("part","url-outer");const s=r.createChild("div");s.setAttribute("part","url-prefix");const i=r.createChild("div");i.setAttribute("part","url-suffix");const o=/^(.*)(\/[^/]*)$/.exec(t);return s.textContent=o?o[1]:t,i.textContent=o?o[2]:"",r}(s.url);return r.highlight(t,s.url,"url"),t})()}</td>
                    <td title=${s.initiator.initiatorUrl||""}
                        aria-label=${s.initiator.initiatorUrl||""}
                        @mouseenter=${()=>r.onInitiatorMouseEnter(s.initiator.frameId)}
                        @mouseleave=${r.onInitiatorMouseLeave}
                    >${s.initiator.initiatorUrl||""}</td>
                    <td aria-label=${null!==s.size?p(c.sBytes,{n:s.size}):d}
                        data-value=${s.size??d}>${null!==s.size?n`<span>${g(s.size)}</span>`:""}</td>
                    <td aria-label=${null!==s.duration?t.TimeUtilities.millisToString(s.duration):d}
                        data-value=${s.duration??d}>${null!==s.duration?n`<span>${t.TimeUtilities.millisToString(s.duration)}</span>`:""}</td>
                    <td class="error-message">${(()=>{const e=document.createElement("span");return s.errorMessage&&(e.textContent=s.errorMessage,r.highlight(e,s.errorMessage,"error-message")),e})()}</td>
                  </tr>`))}
              </table>
            </devtools-data-grid>`,i,{host:r})}){super(!0),this.#r=r,this.registerRequiredCSS(u)}select(e){this.#t=e,this.requestUpdate()}selectedItem(){return this.#t}#i(e,t){const r=t.dataset.url;r&&e.clipboardSection().appendItem(p(c.copyUrl),(()=>{o.InspectorFrontendHost.InspectorFrontendHostInstance.copyText(r)}),{jslogContext:"copy-url"});const s=t.dataset.initiatorUrl;s&&e.clipboardSection().appendItem(p(c.copyInitiatorUrl),(()=>{o.InspectorFrontendHost.InspectorFrontendHostInstance.copyText(s)}),{jslogContext:"copy-initiator-url"})}set items(e){this.#e=[...e],this.requestUpdate()}reset(){this.items=[],this.requestUpdate()}updateFilterAndHighlight(e){this.#s=e,this.requestUpdate()}getNumberOfVisibleItems(){return parseInt(this.contentElement.querySelector("devtools-data-grid")?.getAttribute("aria-rowcount")||"",10)??0}performUpdate(){const e={items:this.#e,filters:this.#s,highlight:this.#o.bind(this),onContextMenu:e=>{e.detail?.element&&this.#i(e.detail.menu,e.detail.element)},onInitiatorMouseEnter:e=>{const t=e?s.FrameManager.FrameManager.instance().getFrame(e):null;t&&t.highlight()},onInitiatorMouseLeave:()=>{s.OverlayModel.OverlayModel.hideDOMNodeHighlight()}};this.#r(e,{},this.contentElement)}#o(t,r,s){const i=this.#s.find((e=>e.key?.split(",")?.includes(s)));if(!i?.regex||t.querySelector(".filter-highlight"))return;const o=i.regex.exec(r);if(!o?.length)return;const a=new l.TextRange.SourceRange(o.index,o[0].length);e.UIUtils.highlightRangesWithStyleClass(t,[a],"filter-highlight");for(const e of t.querySelectorAll(".filter-highlight"))e.setAttribute("part","filter-highlight")}}var v={cssText:`:host{overflow:hidden}.developer-resource-view-toolbar-container{display:flex;border-bottom:1px solid var(--sys-color-divider);flex:0 0 auto}.developer-resource-view-toolbar{width:100%}.developer-resource-view-toolbar-summary{background-color:var(--sys-color-cdt-base-container);border-top:1px solid var(--sys-color-divider);padding-left:5px;flex:0 0 19px;display:flex;padding-right:5px}.developer-resource-view-toolbar-summary .developer-resource-view-message{padding-top:2px;padding-left:1ex;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.developer-resource-view-results{overflow-y:auto;display:flex;flex:auto}\n/*# sourceURL=${import.meta.resolve("./developerResourcesView.css")} */\n`};const f={filterByText:"Filter by URL and error",loadHttpsDeveloperResources:"Load `HTTP(S)` developer resources through the website you inspect, not through DevTools",enableLoadingThroughTarget:"Load through website",resourcesCurrentlyLoading:"{PH1} resources, {PH2} currently loading",resources:"{n, plural, =1 {# resource} other {# resources}}",numberOfResourceMatch:"{n, plural, =1 {# resource matches} other {# resources match}}",noResourceMatches:"No resource matches"},x=t.i18n.registerUIStrings("panels/developer_resources/DeveloperResourcesView.ts",f),w=t.i18n.getLocalizedString.bind(void 0,x);class b extends e.ThrottledWidget.ThrottledWidget{textFilterRegExp;filterInput;coverageResultsElement;listView;statusToolbarElement;statusMessageElement;loader;constructor(){super(!0),this.registerRequiredCSS(v),this.element.setAttribute("jslog",`${i.panel("developer-resources").track({resize:!0})}`);const t=this.contentElement.createChild("div","developer-resource-view-toolbar-container");t.setAttribute("jslog",`${i.toolbar()}`),t.role="toolbar";const r=t.createChild("devtools-toolbar","developer-resource-view-toolbar");r.role="presentation",this.textFilterRegExp=null,this.filterInput=new e.Toolbar.ToolbarFilter(w(f.filterByText),1),this.filterInput.addEventListener("TextChanged",this.onFilterChanged,this),r.appendToolbarItem(this.filterInput);const o=s.PageResourceLoader.getLoadThroughTargetSetting(),l=new e.Toolbar.ToolbarSettingCheckbox(o,w(f.loadHttpsDeveloperResources),w(f.enableLoadingThroughTarget));r.appendToolbarItem(l),this.coverageResultsElement=this.contentElement.createChild("div","developer-resource-view-results"),this.listView=new m,this.listView.show(this.coverageResultsElement),this.statusToolbarElement=this.contentElement.createChild("div","developer-resource-view-toolbar-summary"),this.statusMessageElement=this.statusToolbarElement.createChild("div","developer-resource-view-message"),this.loader=s.PageResourceLoader.PageResourceLoader.instance(),this.loader.addEventListener("Update",this.update,this),this.update()}async doUpdate(){const e=this.listView.selectedItem();this.listView.reset(),this.listView.items=this.loader.getScopedResourcesLoaded().values(),e&&this.listView.select(e),this.updateStats()}async select(e){await this.lastUpdatePromise,this.listView.select(e)}async selectedItem(){return await this.lastUpdatePromise,this.listView.selectedItem()}updateStats(){const{loading:e,resources:t}=this.loader.getScopedNumberOfResources();this.statusMessageElement.textContent=e>0?w(f.resourcesCurrentlyLoading,{PH1:t,PH2:e}):w(f.resources,{n:t})}onFilterChanged(){if(!this.listView)return;const t=this.filterInput.value();this.textFilterRegExp=t?r.StringUtilities.createPlainTextSearchRegex(t,"i"):null,this.textFilterRegExp?this.listView.updateFilterAndHighlight([{key:"url,error-message",regex:this.textFilterRegExp,negative:!1}]):this.listView.updateFilterAndHighlight([]),this.updateStats();const s=this.listView.getNumberOfVisibleItems();let i="";i=0===s?w(f.noResourceMatches):w(f.numberOfResourceMatch,{n:s}),e.ARIAUtils.alert(i)}}var y=Object.freeze({__proto__:null,DeveloperResourcesRevealer:class{async reveal(t){const r=s.PageResourceLoader.PageResourceLoader.instance().getResourcesLoaded().get(t.key);if(r){await e.ViewManager.ViewManager.instance().showView("developer-resources");const t=await e.ViewManager.ViewManager.instance().view("developer-resources").widget();return await t.select(r)}}},DeveloperResourcesView:b});export{y as DeveloperResourcesView};
=======
import*as e from"../../core/i18n/i18n.js";import*as t from"../../core/platform/platform.js";import*as i from"../../core/sdk/sdk.js";import*as s from"../../ui/legacy/legacy.js";import*as r from"../../ui/visual_logging/visual_logging.js";import*as o from"../../core/host/host.js";import*as l from"../../models/text_utils/text_utils.js";import*as a from"../../ui/legacy/components/data_grid/data_grid.js";const n=new CSSStyleSheet;n.replaceSync(".data-grid{border:none}.data-grid td .url-outer{width:100%;display:inline-flex;justify-content:flex-start}.data-grid td .url-outer .filter-highlight{font-weight:bold}.data-grid td .url-prefix{overflow-x:hidden;text-overflow:ellipsis}.data-grid td .url-suffix{flex:none}.data-grid td.error-message .filter-highlight{font-weight:bold}\n/*# sourceURL=developerResourcesListView.css */\n");const d={status:"Status",url:"URL",initiator:"Initiator",totalBytes:"Total Bytes",error:"Error",developerResources:"Developer resources",copyUrl:"Copy URL",copyInitiatorUrl:"Copy initiator URL",pending:"pending",success:"success",failure:"failure",sBytes:"{n, plural, =1 {# byte} other {# bytes}}"},h=e.i18n.registerUIStrings("panels/developer_resources/DeveloperResourcesListView.ts",d),c=e.i18n.getLocalizedString.bind(void 0,h);class u extends s.Widget.VBox{nodeForItem;isVisibleFilter;highlightRegExp;dataGrid;constructor(e){super(!0),this.nodeForItem=new Map,this.isVisibleFilter=e,this.highlightRegExp=null;const t=[{id:"status",title:c(d.status),width:"60px",fixedWidth:!0,sortable:!0},{id:"url",title:c(d.url),width:"250px",fixedWidth:!1,sortable:!0},{id:"initiator",title:c(d.initiator),width:"80px",fixedWidth:!1,sortable:!0},{id:"size",title:c(d.totalBytes),width:"80px",fixedWidth:!0,sortable:!0,align:"right"},{id:"error-message",title:c(d.error),width:"200px",fixedWidth:!1,sortable:!0}];this.dataGrid=new a.SortableDataGrid.SortableDataGrid({displayName:c(d.developerResources),columns:t,editCallback:void 0,refreshCallback:void 0,deleteCallback:void 0}),this.dataGrid.setResizeMethod("last"),this.dataGrid.setStriped(!0),this.dataGrid.element.classList.add("flex-auto"),this.dataGrid.addEventListener("SortingChanged",this.sortingChanged,this),this.dataGrid.setRowContextMenuCallback(this.populateContextMenu.bind(this));const i=this.dataGrid.asWidget();i.show(this.contentElement),this.setDefaultFocusedChild(i)}select(e){const t=this.nodeForItem.get(e);t&&t.select()}selectedItem(){return this.dataGrid.selectedNode?this.dataGrid.selectedNode.item:null}populateContextMenu(e,t){const i=t.item;e.clipboardSection().appendItem(c(d.copyUrl),(()=>{o.InspectorFrontendHost.InspectorFrontendHostInstance.copyText(i.url)}),{jslogContext:"copy-url"}),i.initiator.initiatorUrl&&e.clipboardSection().appendItem(c(d.copyInitiatorUrl),(()=>{o.InspectorFrontendHost.InspectorFrontendHostInstance.copyText(i.initiator.initiatorUrl)}),{jslogContext:"copy-initiator-url"})}update(e){let t=!1;const i=this.dataGrid.rootNode();for(const s of e){let e=this.nodeForItem.get(s);e?this.isVisibleFilter(e.item)&&(t=e.refreshIfNeeded()||t):(e=new g(s),this.nodeForItem.set(s,e),this.isVisibleFilter(e.item)&&(i.appendChild(e),t=!0))}t&&this.sortingChanged()}reset(){this.nodeForItem.clear(),this.dataGrid.rootNode().removeChildren()}updateFilterAndHighlight(e){this.highlightRegExp=e;let t=!1;for(const e of this.nodeForItem.values()){const i=this.isVisibleFilter(e.item),s=Boolean(e.parent);i&&e.setHighlight(this.highlightRegExp),i!==s&&(t=!0,i?this.dataGrid.rootNode().appendChild(e):e.remove())}t&&this.sortingChanged()}sortingChanged(){const e=this.dataGrid.sortColumnId();if(!e)return;const t=g.sortFunctionForColumn(e);t&&this.dataGrid.sortNodes(t,!this.dataGrid.isSortOrderAscending())}wasShown(){super.wasShown(),this.registerCSSFiles([n])}}class g extends a.SortableDataGrid.SortableDataGridNode{item;highlightRegExp;constructor(e){super(),this.item=e,this.highlightRegExp=null}setHighlight(e){this.highlightRegExp!==e&&(this.highlightRegExp=e,this.refresh())}refreshIfNeeded(){return this.refresh(),!0}createCell(e){const r=this.createTD(e);switch(e){case"url":{s.Tooltip.Tooltip.install(r,this.item.url);const t=r.createChild("div","url-outer"),i=t.createChild("div","url-prefix"),o=t.createChild("div","url-suffix"),l=/^(.*)(\/[^/]*)$/.exec(this.item.url);i.textContent=l?l[1]:this.item.url,o.textContent=l?l[2]:"",this.highlightRegExp&&this.highlight(t,this.item.url),this.setCellAccessibleName(this.item.url,r,e);break}case"initiator":{const t=this.item.initiator.initiatorUrl||"";r.textContent=t,s.Tooltip.Tooltip.install(r,t),this.setCellAccessibleName(t,r,e),r.onmouseenter=()=>{const e=this.item.initiator.frameId,t=e?i.FrameManager.FrameManager.instance().getFrame(e):null;t&&t.highlight()},r.onmouseleave=()=>i.OverlayModel.OverlayModel.hideDOMNodeHighlight();break}case"status":null===this.item.success?r.textContent=c(d.pending):r.textContent=this.item.success?c(d.success):c(d.failure);break;case"size":{const i=this.item.size;if(null!==i){r.createChild("span").textContent=t.NumberUtilities.withThousandsSeparator(i);const s=c(d.sBytes,{n:i});this.setCellAccessibleName(s,r,e)}break}case"error-message":r.classList.add("error-message"),this.item.errorMessage&&(r.textContent=this.item.errorMessage,this.highlightRegExp&&this.highlight(r,this.item.errorMessage))}return r}highlight(e,t){if(!this.highlightRegExp)return;const i=this.highlightRegExp.exec(t);if(!i||!i.length)return;const r=new l.TextRange.SourceRange(i.index,i[0].length);s.UIUtils.highlightRangesWithStyleClass(e,[r],"filter-highlight")}static sortFunctionForColumn(e){const t=e=>null===e?-1:Number(e);switch(e){case"url":return(e,t)=>e.item.url.localeCompare(t.item.url);case"status":return(e,i)=>t(e.item.success)-t(i.item.success);case"size":return(e,i)=>t(e.item.size)-t(i.item.size);case"initiator":return(e,t)=>(e.item.initiator.initiatorUrl||"").localeCompare(t.item.initiator.initiatorUrl||"");case"error-message":return(e,t)=>(e.item.errorMessage||"").localeCompare(t.item.errorMessage||"");default:return console.assert(!1,"Unknown sort field: "+e),null}}}const p=new CSSStyleSheet;p.replaceSync(":host{overflow:hidden}.developer-resource-view-toolbar-container{display:flex;border-bottom:1px solid var(--sys-color-divider);flex:0 0 auto}.developer-resource-view-toolbar{display:inline-block;width:100%}.developer-resource-view-toolbar-summary{background-color:var(--sys-color-cdt-base-container);border-top:1px solid var(--sys-color-divider);padding-left:5px;flex:0 0 19px;display:flex;padding-right:5px}.developer-resource-view-toolbar-summary .developer-resource-view-message{padding-top:2px;padding-left:1ex;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.developer-resource-view-results{overflow-y:auto;display:flex;flex:auto}\n/*# sourceURL=developerResourcesView.css */\n");const m={filterByText:"Filter by URL and error",loadHttpsDeveloperResources:"Load `HTTP(S)` developer resources through the website you inspect, not through DevTools",enableLoadingThroughTarget:"Load through website",resourcesCurrentlyLoading:"{PH1} resources, {PH2} currently loading",resources:"{n, plural, =1 {# resource} other {# resources}}"},x=e.i18n.registerUIStrings("panels/developer_resources/DeveloperResourcesView.ts",m),v=e.i18n.getLocalizedString.bind(void 0,x);class w extends s.ThrottledWidget.ThrottledWidget{textFilterRegExp;filterInput;coverageResultsElement;listView;statusToolbarElement;statusMessageElement;loader;constructor(){super(!0),this.element.setAttribute("jslog",`${r.panel("developer-resources").track({resize:!0})}`);const e=this.contentElement.createChild("div","developer-resource-view-toolbar-container");e.setAttribute("jslog",`${r.toolbar()}`);const t=new s.Toolbar.Toolbar("developer-resource-view-toolbar",e);this.textFilterRegExp=null,this.filterInput=new s.Toolbar.ToolbarFilter(v(m.filterByText),1),this.filterInput.addEventListener("TextChanged",this.onFilterChanged,this),t.appendToolbarItem(this.filterInput);const o=i.PageResourceLoader.getLoadThroughTargetSetting(),l=new s.Toolbar.ToolbarSettingCheckbox(o,v(m.loadHttpsDeveloperResources),v(m.enableLoadingThroughTarget));t.appendToolbarItem(l),this.coverageResultsElement=this.contentElement.createChild("div","developer-resource-view-results"),this.listView=new u(this.isVisible.bind(this)),this.listView.show(this.coverageResultsElement),this.statusToolbarElement=this.contentElement.createChild("div","developer-resource-view-toolbar-summary"),this.statusMessageElement=this.statusToolbarElement.createChild("div","developer-resource-view-message"),this.loader=i.PageResourceLoader.PageResourceLoader.instance(),this.loader.addEventListener("Update",this.update,this),this.update()}async doUpdate(){const e=this.listView.selectedItem();this.listView.reset(),this.listView.update(this.loader.getScopedResourcesLoaded().values()),e&&this.listView.select(e),this.updateStats()}async select(e){await this.lastUpdatePromise,this.listView.select(e)}async selectedItem(){return await this.lastUpdatePromise,this.listView.selectedItem()}updateStats(){const{loading:e,resources:t}=this.loader.getScopedNumberOfResources();this.statusMessageElement.textContent=e>0?v(m.resourcesCurrentlyLoading,{PH1:t,PH2:e}):v(m.resources,{n:t})}isVisible(e){return!this.textFilterRegExp||this.textFilterRegExp.test(e.url)||this.textFilterRegExp.test(e.errorMessage||"")}onFilterChanged(){if(!this.listView)return;const e=this.filterInput.value();this.textFilterRegExp=e?t.StringUtilities.createPlainTextSearchRegex(e,"i"):null,this.listView.updateFilterAndHighlight(this.textFilterRegExp),this.updateStats()}wasShown(){super.wasShown(),this.registerCSSFiles([p])}}var f=Object.freeze({__proto__:null,DeveloperResourcesRevealer:class{async reveal(e){const t=i.PageResourceLoader.PageResourceLoader.instance().getResourcesLoaded().get(e.key);if(t){await s.ViewManager.ViewManager.instance().showView("developer-resources");return(await s.ViewManager.ViewManager.instance().view("developer-resources").widget()).select(t)}}},DeveloperResourcesView:w});export{f as DeveloperResourcesView};
>>>>>>> 2c830f7d0232ead70791aff6968a0e95ce850767
