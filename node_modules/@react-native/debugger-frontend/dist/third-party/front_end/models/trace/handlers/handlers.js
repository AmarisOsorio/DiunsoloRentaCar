<<<<<<< HEAD
import*as e from"../../../third_party/third-party-web/third-party-web.js";import*as t from"../types/types.js";import*as n from"../helpers/helpers.js";import*as i from"../../../core/platform/platform.js";import*as s from"../../../core/root/root.js";import*as a from"../../cpu_profile/cpu_profile.js";import*as r from"../../../core/common/common.js";function o(e,t){const n=l(e);if(n)return c(n,t)}function c(t,n){return e.ThirdPartyWeb.getEntity(t)??d(n,t)}function l(e,n){if(t.Events.isProfileCall(e))return e.callFrame.url;if(t.Events.isSyntheticNetworkRequest(e))return e.args.data.url;if(e.args?.data?.stackTrace&&e.args.data.stackTrace.length>0)return e.args.data.stackTrace[0].url;if(t.Events.isParseHTML(e))return e.args.beginData.url;if(n){if(t.Events.isDecodeImage(e)){const t=n.ImagePainting.paintImageForEvent.get(e);return t?l(t,n):null}if(t.Events.isDrawLazyPixelRef(e)&&e.args?.LazyPixelRef){const t=n.ImagePainting.paintImageByDrawLazyPixelRef.get(e.args.LazyPixelRef);return t?l(t,n):null}}return e.args?.data?.url?e.args.data.url:null}function d(t,n){if(n.startsWith("chrome-extension:"))return function(e,t,n){const i=new URL(t),s=function(e){return e.protocol+"//"+e.host}(i),a=new URL(s).host,r=n||a,o=e.get(s);if(o)return o;const c={name:r,company:r,category:"Chrome Extension",homepage:"https://chromewebstore.google.com/detail/"+a,categories:[],domains:[s],averageExecutionTime:0,totalExecutionTime:0,totalOccurrences:0};return e.set(s,c),c}(t,n);if(!n.startsWith("http"))return;const i=e.ThirdPartyWeb.getRootDomain(n);if(!i)return;if(t.has(i))return t.get(i);const s={name:i,company:i,category:"",categories:[],domains:[i],averageExecutionTime:0,totalExecutionTime:0,totalOccurrences:0,isUnrecognized:!0};return t.set(i,s),s}function u(e,t){const n=o(e,t.createdEntityCache);if(!n)return;if(t.entityByEvent.has(e))return;const i=t.eventsByEntity.get(n);i?i.push(e):t.eventsByEntity.set(n,[e]),t.entityByEvent.set(e,n)}function f(e,t,n){const i=o(e,t.createdEntityCache);if(!i)return;const s=[e,...Object.values(n).flat()],a=t.eventsByEntity.get(i);a?a.push(...s):t.eventsByEntity.set(i,s);for(const e of s)t.entityByEvent.set(e,i)}var m=Object.freeze({__proto__:null,addEventToEntityMapping:u,addNetworkRequestToEntityMapping:f,getEntityForEvent:o,getEntityForUrl:c,getNonResolvedURL:l,makeUpEntity:d});function g(e){return`${e.pid}-${e.tid}`}const p=new Map,h=new Map,v=new Map,E=[],T=new Map;var y=Object.freeze({__proto__:null,data:function(){return{animationFrames:E,presentationForFrame:T}},deps:function(){return["Meta"]},finalize:async function(){for(const[e,i]of p.entries()){const s=h.get(e);if(s){n.Trace.sortTraceEventsInPlace(i),n.Trace.sortTraceEventsInPlace(s);for(let e=0;e<i.length;e++){const a=s.at(e);if(!a)break;const r=i[e],o=n.SyntheticEvents.SyntheticEventsManager.registerSyntheticEvent({rawSourceEvent:r,...r,dur:t.Timing.Micro(a.ts-r.ts),args:{data:{beginEvent:r,endEvent:a}}});E.push(o);const c=r.args?.id;if(c){const e=v.get(c);e&&T.set(o,e)}}}}},handleEvent:function(e){if(t.Events.isAnimationFrameAsyncStart(e)){const t=g(e),n=p.get(t)??[];n.push(e),p.set(t,n)}else if(t.Events.isAnimationFrameAsyncEnd(e)){const t=g(e),n=h.get(t)??[];n.push(e),h.set(t,n)}else t.Events.isAnimationFramePresentation(e)&&e.args?.id&&v.set(e.args.id,e)},reset:function(){p.clear(),h.clear(),E.length=0,T.clear(),v.clear()}});const M=[],I=[];var w=Object.freeze({__proto__:null,data:function(){return{animations:I}},finalize:async function(){const e=n.Trace.createMatchedSortedSyntheticEvents(M);I.push(...e)},handleEvent:function(e){t.Events.isAnimation(e)&&M.push(e)},reset:function(){M.length=0,I.length=0}});const S=new Map,F=new Map,P=new Map,_=[],R=[];let C=[];const L="-$-";function k(e){const t=F.get(e.ts)?.get(e.pid)?.get(e.tid)?.get(e.cat);if(!t)return;const{flows:n,bindingParsed:s}=t;if(!s){for(const t of n){i.MapUtilities.getWithDefault(P,t,(()=>new Map)).set(e.ts,e)}t.bindingParsed=!0}}function b(e){const t=`${(n=e).cat}${L}${n.name}${L}${n.id}`;var n;switch(e.ph){case"s":{const n={flowId:e.id,times:new Map([[e.ts,void 0]])};return S.set(t,e.id),void D(e,n.flowId)}case"t":{const n=S.get(t);if(void 0===n)return;return void D(e,n)}case"f":{const n=S.get(t);if(void 0===n)return;D(e,n),S.delete(t)}}}function D(e,t){const n=i.MapUtilities.getWithDefault(F,e.ts,(()=>new Map)),s=i.MapUtilities.getWithDefault(n,e.pid,(()=>new Map)),a=i.MapUtilities.getWithDefault(s,e.tid,(()=>new Map));i.MapUtilities.getWithDefault(a,e.cat,(()=>({flows:new Set,bindingParsed:!1}))).flows.add(t)}function N(){return{flows:C}}var B=Object.freeze({__proto__:null,data:N,finalize:async function(){_.forEach(b),R.forEach(k),C=[...P.values()].map((e=>[...e.values()])).map((e=>e.filter((e=>void 0!==e)))).filter((e=>e.length>1))},handleEvent:function(e){t.Events.isFlowPhaseEvent(e)?_.push(e):R.push(e)},reset:function(){C=[],_.length=0,R.length=0,S.clear(),F.clear(),P.clear()}});const W=new Map,U=new Map,O=new Map,x=new Map,z=new Map;function A(e){switch(e){case"seller":return"seller";case"bidder":return"bidder";default:return"unknown"}}function q(e){return n.SyntheticEvents.SyntheticEventsManager.registerSyntheticEvent({rawSourceEvent:e,name:"SyntheticAuctionWorklet",s:"t",cat:e.cat,tid:e.tid,ts:e.ts,ph:"I",pid:e.args.data.pid,host:e.args.data.host,target:e.args.data.target,type:A(e.args.data.type)})}function j(){return{worklets:new Map(O)}}var H=Object.freeze({__proto__:null,data:j,finalize:async function(){for(const[e,t]of x){const n=z.get(e);if(!n)continue;const i=W.get(e),s=U.get(e);let a=null;i?(a={...q(i),args:{data:{runningInProcessEvent:i,utilityThread:t,v8HelperThread:n}}},s&&(a.args.data.doneWithProcessEvent=s)):s&&(a={...q(s),args:{data:{doneWithProcessEvent:s,utilityThread:t,v8HelperThread:n}}},i&&(a.args.data.runningInProcessEvent=i)),null!==a&&O.set(e,a)}},handleEvent:function(e){if(t.Events.isAuctionWorkletRunningInProcess(e))W.set(e.args.data.pid,e);else if(t.Events.isAuctionWorkletDoneWithProcess(e))U.set(e.args.data.pid,e);else if(t.Events.isThreadName(e)){if("auction_worklet.CrUtilityMain"===e.args.name)return void x.set(e.pid,e);"AuctionV8HelperThread"===e.args.name&&z.set(e.pid,e)}},reset:function(){W.clear(),U.clear(),O.clear(),x.clear(),z.clear()}});const $=new Map;let G="",V="";const X=new Map;let Y=t.Events.ProcessID(-1),K=t.Events.ThreadID(-1),Q=t.Events.ProcessID(-1),J=t.Events.ThreadID(-1),Z=null,ee=null;const te=new Map,ne=new Set,ie={min:t.Timing.Micro(Number.POSITIVE_INFINITY),max:t.Timing.Micro(Number.NEGATIVE_INFINITY),range:t.Timing.Micro(Number.POSITIVE_INFINITY)},se=new Map,ae=new Map,re=new Map,oe=[],ce=new Map;let le=t.Timing.Micro(-1);const de=new Set(["B","E","X","I"]);let ue=!0;const fe=new Set(["TracingStartedInPage","TracingSessionIdForWorker","TracingStartedInBrowser"]);function me(e,n){i.MapUtilities.getWithDefault(X,n.processId,(()=>new Map)).set(n.frame,n);const s=i.MapUtilities.getWithDefault($,n.frame,(()=>new Map)),a=i.MapUtilities.getWithDefault(s,n.processId,(()=>[])),r=a.at(-1);r&&r.frame.url===n.url||a.push({frame:n,window:{min:e.ts,max:t.Timing.Micro(0),range:t.Timing.Micro(0)}})}function ge(){return{traceBounds:{...ie},browserProcessId:Y,browserThreadId:K,processNames:te,gpuProcessId:Q,gpuThreadId:J===t.Events.ThreadID(-1)?void 0:J,viewportRect:Z||void 0,devicePixelRatio:ee??void 0,mainFrameId:G,mainFrameURL:V,navigationsByFrameId:se,navigationsByNavigationId:ae,finalDisplayUrlByNavigationId:re,threadsInProcess:ce,rendererProcessesByFrame:$,topLevelRendererIds:ne,frameByProcessId:X,mainFrameNavigations:oe,traceIsGeneric:ue}}var pe=Object.freeze({__proto__:null,data:ge,finalize:async function(){le>=0&&(ie.min=le),ie.range=t.Timing.Micro(ie.max-ie.min);for(const[,e]of $){const n=[...e.values()].flat().sort(((e,t)=>e.window.min-t.window.min));for(let e=0;e<n.length;e++){const i=n[e],s=n[e+1];s?(i.window.max=t.Timing.Micro(s.window.min-1),i.window.range=t.Timing.Micro(i.window.max-i.window.min)):(i.window.max=t.Timing.Micro(ie.max),i.window.range=t.Timing.Micro(ie.max-i.window.min))}}for(const[e,t]of se)if(!$.has(e)){se.delete(e);for(const e of t)e.args.data&&ae.delete(e.args.data.navigationId)}const e=oe.at(0),i=n.Timing.secondsToMicro(t.Timing.Seconds(.5));if(e){const t=e.ts-ie.min<i;e.args.data?.isOutermostMainFrame&&e.args.data?.documentLoaderURL&&t&&(V=e.args.data.documentLoaderURL)}},handleEvent:function(e){if(ue&&fe.has(e.name)&&(ue=!1),t.Events.isProcessName(e)&&te.set(e.pid,e),0!==e.ts&&!e.name.endsWith("::UMA")&&de.has(e.ph)){ie.min=t.Timing.Micro(Math.min(e.ts,ie.min));const n=e.dur??t.Timing.Micro(0);ie.max=t.Timing.Micro(Math.max(e.ts+n,ie.max))}if(!t.Events.isProcessName(e)||"Browser"!==e.args.name&&"HeadlessBrowser"!==e.args.name)if(!t.Events.isProcessName(e)||"Gpu"!==e.args.name&&"GPU Process"!==e.args.name)if(t.Events.isThreadName(e)&&"CrGpuMain"===e.args.name)J=e.tid;else{if(t.Events.isThreadName(e)&&"CrBrowserMain"===e.args.name&&(K=e.tid),t.Events.isMainFrameViewport(e)&&null===Z){const t=e.args.data.viewport_rect,n=t[0],i=t[1],s=t[2],a=t[5];Z=new DOMRect(n,i,s,a),ee=e.args.data.dpr}if(t.Events.isTracingStartedInBrowser(e)){if(le=e.ts,!e.args.data)throw new Error("No frames found in trace data");for(const t of e.args.data.frames??[]){me(e,t),t.parent||ne.add(t.processId);const n="isOutermostMainFrame"in t;"isInPrimaryMainFrame"in t&&n?t.isInPrimaryMainFrame&&t.isOutermostMainFrame&&(G=t.frame,V=t.url):n?t.isOutermostMainFrame&&(G=t.frame,V=t.url):!t.parent&&t.url&&(G=t.frame,V=t.url)}}else if(t.Events.isFrameCommittedInBrowser(e)){const t=e.args.data;if(!t)return;if(me(e,t),t.parent)return;ne.add(t.processId)}else if(t.Events.isCommitLoad(e)){const t=e.args.data;if(!t)return;const{frame:n,name:i,url:s}=t;me(e,{processId:e.pid,frame:n,name:i,url:s})}else if(t.Events.isThreadName(e)){i.MapUtilities.getWithDefault(ce,e.pid,(()=>new Map)).set(e.tid,e)}else{if(t.Events.isNavigationStart(e)&&e.args.data){const t=e.args.data.navigationId;if(ae.has(t))return;ae.set(t,e),re.set(t,e.args.data.documentLoaderURL);const n=e.args.frame,i=se.get(n)||[];return i.push(e),se.set(n,i),void(n===G&&oe.push(e))}if(t.Events.isResourceSendRequest(e)){if("Document"!==e.args.data.resourceType)return;const t=e.args.data.requestId;if(!ae.get(t))return;re.set(t,e.args.data.url)}else if(t.Events.isDidCommitSameDocumentNavigation(e)){if("PRIMARY_MAIN_FRAME"!==e.args.render_frame_host.frame_type)return;const t=oe.at(-1),n=t?.args.data?.navigationId??"";re.set(n,e.args.url)}else;}}else Q=e.pid;else Y=e.pid},reset:function(){se.clear(),ae.clear(),re.clear(),te.clear(),oe.length=0,Y=t.Events.ProcessID(-1),K=t.Events.ThreadID(-1),Q=t.Events.ProcessID(-1),J=t.Events.ThreadID(-1),Z=null,ne.clear(),ce.clear(),$.clear(),X.clear(),ie.min=t.Timing.Micro(Number.POSITIVE_INFINITY),ie.max=t.Timing.Micro(Number.NEGATIVE_INFINITY),ie.range=t.Timing.Micro(Number.POSITIVE_INFINITY),le=t.Timing.Micro(-1),ue=!0}});const he=1e3,ve=1e6,Ee=new Map,Te=new Map,ye=new Map,Me=new Map,Ie=[],we=new Map,Se=new Map,Fe={eventsByEntity:new Map,entityByEvent:new Map,createdEntityCache:new Map};function Pe(e,t,n){Te.has(e)||Te.set(e,{});const i=Te.get(e);if(!i)throw new Error(`Unable to locate trace events for request ID ${e}`);if(Array.isArray(i[t])){const e=n;i[t].push(...e)}else i[t]=n}function _e(e){for(const t of e)if(t>0)return t;return 0}function Re(){return{byId:ye,byOrigin:Me,byTime:Ie,eventToInitiator:Se,webSocket:[...Ee.values()],entityMappings:{entityByEvent:new Map(Fe.entityByEvent),eventsByEntity:new Map(Fe.eventsByEntity),createdEntityCache:new Map(Fe.createdEntityCache)}}}var Ce=Object.freeze({__proto__:null,data:Re,deps:function(){return["Meta"]},finalize:async function(){const{rendererProcessesByFrame:e}=ge();for(const[s,a]of Te.entries()){if(!a.sendRequests||!a.receiveResponse)continue;const r=[];for(let e=0;e<a.sendRequests.length-1;e++){const n=a.sendRequests[e],i=a.sendRequests[e+1];let s=n.ts,o=t.Timing.Micro(i.ts-n.ts);if(a.willSendRequests?.[e]&&a.willSendRequests[e+1]){const n=a.willSendRequests[e],i=a.willSendRequests[e+1];s=n.ts,o=t.Timing.Micro(i.ts-n.ts)}r.push({url:n.args.data.url,priority:n.args.data.priority,requestMethod:n.args.data.requestMethod,ts:s,dur:o})}const o=0!==a.resourceFinish?.args.data.encodedDataLength,c=a.receiveResponse.args.data.fromCache&&!a.receiveResponse.args.data.fromServiceWorker&&!o,l=void 0!==a.resourceMarkAsCached,d=l?void 0:a.receiveResponse.args.data.timing;if(!d&&!l)continue;const u=a.sendRequests[0],m=a.sendRequests[a.sendRequests.length-1],g=m.args.data.priority;let p=g;a.changePriority&&(p=a.changePriority.args.data.priority);const h=a.willSendRequests?.length?t.Timing.Micro(a.willSendRequests[0].ts):t.Timing.Micro(u.ts),v=a.willSendRequests?.length?t.Timing.Micro(a.willSendRequests[a.willSendRequests.length-1].ts):t.Timing.Micro(m.ts),E=a.resourceFinish?a.resourceFinish.ts:v,T=a.resourceFinish?.args.data.finishTime?t.Timing.Micro(a.resourceFinish.args.data.finishTime*ve):t.Timing.Micro(E),y=t.Timing.Micro(d?(T||v)-v:0),M=t.Timing.Micro(E-(T||E)),I=t.Timing.Micro(v-h),w=d?d.requestTime*ve-v:0,S=t.Timing.Micro(i.NumberUtilities.clamp(w,0,Number.MAX_VALUE)),F=d?t.Timing.Micro(_e([d.dnsStart*he,d.connectStart*he,d.sendStart*he,a.receiveResponse.ts-v])):t.Timing.Micro(a.receiveResponse.ts-h),P=d?t.Timing.Micro(d.requestTime*ve+d.sendStart*he):h,_=d?t.Timing.Micro((d.receiveHeadersEnd-d.sendEnd)*he):t.Timing.Micro(0),R=d?t.Timing.Micro(d.requestTime*ve+d.receiveHeadersEnd*he):h,C=d?t.Timing.Micro((T||R)-R):t.Timing.Micro(E-a.receiveResponse.ts),L=t.Timing.Micro(y+M),k=d?t.Timing.Micro((d.dnsEnd-d.dnsStart)*he):t.Timing.Micro(0),b=d?t.Timing.Micro((d.sslEnd-d.sslStart)*he):t.Timing.Micro(0),D=d?t.Timing.Micro((d.proxyEnd-d.proxyStart)*he):t.Timing.Micro(0),N=d?t.Timing.Micro((d.sendEnd-d.sendStart)*he):t.Timing.Micro(0),B=d?t.Timing.Micro((d.connectEnd-d.connectStart)*he):t.Timing.Micro(0),{frame:W,url:U,renderBlocking:O}=m.args.data,{encodedDataLength:x,decodedBodyLength:z}=a.resourceFinish?a.resourceFinish.args.data:{encodedDataLength:0,decodedBodyLength:0},A=new URL(U),q="https:"===A.protocol,j=n.Trace.activeURLForFrameAtTime(W,m.ts,e)||"",H=n.SyntheticEvents.SyntheticEventsManager.registerSyntheticEvent({rawSourceEvent:m,args:{data:{syntheticData:{dnsLookup:k,download:C,downloadStart:R,finishTime:T,initialConnection:B,isDiskCached:c,isHttps:q,isMemoryCached:l,isPushedResource:o,networkDuration:y,processingDuration:M,proxyNegotiation:D,queueing:S,redirectionDuration:I,requestSent:N,sendStartTime:P,ssl:b,stalled:F,totalTime:L,waiting:_},decodedBodyLength:z,encodedDataLength:x,frame:W,fromServiceWorker:a.receiveResponse.args.data.fromServiceWorker,isLinkPreload:m.args.data.isLinkPreload||!1,mimeType:a.receiveResponse.args.data.mimeType,priority:p,initialPriority:g,protocol:a.receiveResponse.args.data.protocol??"unknown",redirects:r,renderBlocking:O??"non_blocking",requestId:s,requestingFrameUrl:j,requestMethod:m.args.data.requestMethod,resourceType:m.args.data.resourceType??"Other",statusCode:a.receiveResponse.args.data.statusCode,responseHeaders:a.receiveResponse.args.data.headers||[],fetchPriorityHint:m.args.data.fetchPriorityHint??"auto",initiator:m.args.data.initiator,stackTrace:m.args.data.stackTrace,timing:d,url:U,failed:a.resourceFinish?.args.data.didFail??!1,finished:Boolean(a.resourceFinish),connectionId:a.receiveResponse.args.data.connectionId,connectionReused:a.receiveResponse.args.data.connectionReused}},cat:"loading",name:"SyntheticNetworkRequest",ph:"X",dur:t.Timing.Micro(E-h),tdur:t.Timing.Micro(E-h),ts:t.Timing.Micro(h),tts:t.Timing.Micro(h),pid:m.pid,tid:m.tid}),$=i.MapUtilities.getWithDefault(Me,A.host,(()=>({renderBlocking:[],nonRenderBlocking:[],all:[]})));n.Network.isSyntheticNetworkRequestEventRenderBlocking(H)?$.renderBlocking.push(H):$.nonRenderBlocking.push(H),$.all.push(H),Ie.push(H),ye.set(H.args.data.requestId,H),f(H,Fe,a);const G=H.args.data.initiator?.url||n.Trace.getZeroIndexedStackTraceForEvent(H)?.at(0)?.url;if(G){const e=we.get(G)??[];e.push(H),we.set(G,e)}}for(const e of Ie){const t=we.get(e.args.data.url);if(t)for(const n of t)Se.set(n,e)}Ee.forEach((e=>{let n=null,i=null;for(const s of e.events)t.Events.isWebSocketCreate(s)&&(n=s),t.Events.isWebSocketDestroy(s)&&(i=s);e.syntheticConnection=function(e,t,n){const{traceBounds:i}=ge(),s=e?e.ts:i.min,a=t?t.ts:i.max,r=a-s,o=e||t||n;return{name:"SyntheticWebSocketConnection",cat:o.cat,ph:"X",ts:s,dur:r,pid:o.pid,tid:o.tid,s:o.s,rawSourceEvent:o,_tag:"SyntheticEntryTag",args:{data:{identifier:o.args.data.identifier,priority:"Low",url:o.args.data.url||""}}}}(n,i,e.events[0])}))},handleEvent:function(e){if(t.Events.isResourceChangePriority(e))Pe(e.args.data.requestId,"changePriority",e);else if(t.Events.isResourceWillSendRequest(e))Pe(e.args.data.requestId,"willSendRequests",[e]);else if(t.Events.isResourceSendRequest(e))Pe(e.args.data.requestId,"sendRequests",[e]);else if(t.Events.isResourceReceiveResponse(e))Pe(e.args.data.requestId,"receiveResponse",e);else if(t.Events.isResourceReceivedData(e))Pe(e.args.data.requestId,"receivedData",[e]);else if(t.Events.isResourceFinish(e))Pe(e.args.data.requestId,"resourceFinish",e);else if(t.Events.isResourceMarkAsCached(e))Pe(e.args.data.requestId,"resourceMarkAsCached",e);else if(t.Events.isWebSocketCreate(e)||t.Events.isWebSocketInfo(e)||t.Events.isWebSocketTransfer(e)){const t=e.args.data.identifier;Ee.has(t)||(e.args.data.frame?Ee.set(t,{frame:e.args.data.frame,webSocketIdentifier:t,events:[],syntheticConnection:null}):e.args.data.workerId&&Ee.set(t,{workerId:e.args.data.workerId,webSocketIdentifier:t,events:[],syntheticConnection:null})),Ee.get(t)?.events.push(e)}},reset:function(){ye.clear(),Me.clear(),Te.clear(),Ie.length=0,we.clear(),Se.clear(),Ee.clear(),Fe.eventsByEntity.clear(),Fe.entityByEvent.clear(),Fe.createdEntityCache.clear()}});const Le=new Map,ke=new Map,be=new Map,De=new Map;function Ne(){return{profilesInProcess:ke,entryToNode:be}}function Be(e,t){const n=i.MapUtilities.getWithDefault(De,e,(()=>new Map));return i.MapUtilities.getWithDefault(n,t,(()=>({rawProfile:{startTime:0,endTime:0,nodes:[],samples:[],timeDeltas:[],lines:[]},profileId:t})))}var We=Object.freeze({__proto__:null,data:Ne,finalize:async function(e={}){!function(e){for(const[s,r]of De)for(const[o,c]of r){const l=c.threadId;if(!c.rawProfile.nodes.length||void 0===l)continue;const d=[],u=new a.CPUProfileDataModel.CPUProfileDataModel(c.rawProfile),f=n.TreeHelpers.makeEmptyTraceEntryTree();f.maxDepth=u.maxDepth;const m={rawProfile:c.rawProfile,parsedProfile:u,profileCalls:[],profileTree:f,profileId:o};function g(){u.forEachFrame((function(e,i,a,r){if(void 0===l)return;const c=n.Timing.milliToMicro(t.Timing.Milli(r)),u=i.id,f=n.Trace.makeProfileCall(i,o,a,c,s,l);m.profileCalls.push(f),d.push(m.profileCalls.length-1);const g=n.TreeHelpers.makeEmptyTraceEntryNode(f,u);be.set(f,g),g.depth=e,1===d.length&&m.profileTree?.roots.add(g)}),(function(e,i,s,a,r,c){const l=d.pop(),u=void 0!==l&&m.profileCalls[l];if(!u)return;const{callFrame:f,ts:g,pid:p,tid:h}=u,v=be.get(u);if(void 0===f||void 0===g||void 0===p||void 0===o||void 0===h||void 0===v)return;const E=n.Timing.milliToMicro(t.Timing.Milli(r)),T=n.Timing.milliToMicro(t.Timing.Milli(c));u.dur=E,v.selfTime=T;const y=d.at(-1),M=void 0!==y&&m.profileCalls.at(y),I=M&&be.get(M);I&&(v.parent=I,I.children.push(v))}))}i.MapUtilities.getWithDefault(ke,s,(()=>new Map)).set(l,m),e.isCPUProfile&&g()}}(e)},getProfileCallFunctionName:function(e,t){const n=e.profilesInProcess.get(t.pid)?.get(t.tid),i=n?.parsedProfile.nodeById(t.nodeId);return i?.functionName?i.functionName:t.callFrame.functionName},handleEvent:function(e){if(t.Events.isSyntheticCpuProfile(e)){const t=e.pid,n=e.tid,i=Be(t,"0x1");return i.rawProfile=e.args.data.cpuProfile,void(i.threadId=n)}if(t.Events.isProfile(e)){const t=Be(e.pid,e.id);return t.rawProfile.startTime=e.ts,void(t.threadId=e.tid)}if(t.Events.isProfileChunk(e)){const t=Be(e.pid,e.id).rawProfile,n=e.args?.data?.cpuProfile||{samples:[]},i=n?.samples||[],s=e.args?.data?.cpuProfile?.trace_ids||{},a=[];for(const e of n?.nodes||[]){const t=void 0===e.callFrame.lineNumber?-1:e.callFrame.lineNumber,n=void 0===e.callFrame.columnNumber?-1:e.callFrame.columnNumber,i=String(e.callFrame.scriptId),s=e.callFrame.url||"",r={...e,callFrame:{...e.callFrame,url:s,lineNumber:t,columnNumber:n,scriptId:i}};a.push(r)}const r=e.args.data?.timeDeltas||[],o=e.args.data?.lines||Array(i.length).fill(0);if(t.nodes.push(...a),t.samples?.push(...i),t.timeDeltas?.push(...r),t.lines?.push(...o),t.traceIds={...t.traceIds||{},...s},t.samples&&t.timeDeltas&&t.samples.length!==t.timeDeltas.length)return void console.error("Failed to parse CPU profile.");if(!t.endTime&&t.timeDeltas){const e=t.timeDeltas;t.endTime=e.reduce(((e,t)=>e+t),t.startTime)}}else;},reset:function(){Le.clear(),De.clear(),ke.clear(),be.clear()}});const Ue=new Map;let Oe={eventsByEntity:new Map,entityByEvent:new Map,createdEntityCache:new Map};const xe=Array(),ze=new Map;let Ae=[];const qe=[];let je=t.Configuration.defaults();const He=()=>({url:null,isOnMainFrame:!1,threads:new Map}),$e=()=>({name:null,entries:[],profileCalls:[],layoutEvents:[],updateLayoutTreeEvents:[]}),Ge=(e,t)=>i.MapUtilities.getWithDefault(e,t,He),Ve=(e,t)=>i.MapUtilities.getWithDefault(e.threads,t,$e);function Xe(){return{processes:new Map(Ue),compositorTileWorkers:new Map(Ye()),entryToNode:new Map(ze),allTraceEntries:[...Ae],entityMappings:{entityByEvent:new Map(Oe.entityByEvent),eventsByEntity:new Map(Oe.eventsByEntity),createdEntityCache:new Map(Oe.createdEntityCache)}}}function Ye(){const e=new Map;for(const t of xe){const n=e.get(t.pid)||[];n.push(t.tid),e.set(t.pid,n)}return e}function Ke(e,t,n,i){Qe(e,n),Je(e,t,n),Ze(e,n,i)}function Qe(e,t){for(const n of t.values())for(const[t,i]of n)for(const n of i.flat()){const i=Ge(e,t);if(null===i.url||"about:blank"===i.url)try{new URL(n.frame.url),i.url=n.frame.url}catch{i.url=null}}}function Je(e,t,n){for(const[i,s]of n)for(const[n]of s){const s=Ge(e,n);i===t&&(s.isOnMainFrame=!0)}}function Ze(e,t,n){for(const[t,i]of e)for(const[e,s]of n.get(t)??[]){Ve(i,e).name=s?.args.name??`${e}`}}function et(e){if(s.Runtime.experiments.isEnabled("react-native-specific-ui"))return;const t=j().worklets;if(!ge().traceIsGeneric)for(const[n,i]of e)if(null!==i.url);else{const s=t.get(n);s?i.url=s.host:e.delete(n)}}function tt(e){for(const[,t]of e)for(const[e,n]of t.threads)n.tree?.roots.size||t.threads.delete(e)}function nt(e,t){const i=Ne();for(const[s,a]of e)for(const[e,r]of a.threads){if(!r.entries.length){r.tree=n.TreeHelpers.makeEmptyTraceEntryTree();continue}n.Trace.sortTraceEventsInPlace(r.entries);const a=i.profilesInProcess.get(s)?.get(e);if(a){const t=a.parsedProfile,i=t&&new n.SamplesIntegrator.SamplesIntegrator(t,a.profileId,s,e,je),o=i?.buildProfileCalls(r.entries);if(i&&o){Ae=[...Ae,...o],r.entries=n.Trace.mergeEventsInOrder(r.entries,o),r.profileCalls=o;const e=i.jsSampleEvents;e&&(Ae=[...Ae,...e],r.entries=n.Trace.mergeEventsInOrder(r.entries,e))}}const o=n.TreeHelpers.treify(r.entries,t);r.tree=o.tree;for(const[e,t]of o.entryToNode)ze.set(e,t),u(e,Oe)}}function it(e){if(t.Events.isEnd(e)){const n=qe.pop();return n?n.name!==e.name||n.cat!==e.cat?(console.error("Begin/End events mismatch at "+n.ts+" ("+n.name+") vs. "+e.ts+" ("+e.name+")"),null):(n.dur=t.Timing.Micro(e.ts-n.ts),null):null}const n={...e,ph:"X",dur:t.Timing.Micro(0)};return qe.push(n),n}var st=Object.freeze({__proto__:null,assignIsMainFrame:Je,assignMeta:Ke,assignOrigin:Qe,assignThreadName:Ze,buildHierarchy:nt,data:Xe,deps:function(){return["Meta","Samples","AuctionWorklets","NetworkRequests"]},finalize:async function(){const{mainFrameId:e,rendererProcessesByFrame:t,threadsInProcess:i}=ge();Oe=Re().entityMappings,Ke(Ue,e,t,i),et(Ue),nt(Ue),tt(Ue),n.Trace.sortTraceEventsInPlace(Ae)},handleEvent:function(e){if(t.Events.isThreadName(e)&&e.args.name?.startsWith("CompositorTileWorker")&&xe.push({pid:e.pid,tid:e.tid}),t.Events.isBegin(e)||t.Events.isEnd(e)){const t=Ge(Ue,e.pid),n=Ve(t,e.tid),i=it(e);if(!i)return;return n.entries.push(i),void Ae.push(i)}if(t.Events.isInstant(e)||t.Events.isComplete(e)){const t=Ge(Ue,e.pid);Ve(t,e.tid).entries.push(e),Ae.push(e)}if(t.Events.isLayout(e)){const t=Ge(Ue,e.pid);Ve(t,e.tid).layoutEvents.push(e)}if(t.Events.isUpdateLayoutTree(e)){const t=Ge(Ue,e.pid);Ve(t,e.tid).updateLayoutTreeEvents.push(e)}},handleUserConfig:function(e){je=e},makeCompleteEvent:it,reset:function(){Ue.clear(),ze.clear(),Oe.eventsByEntity.clear(),Oe.entityByEvent.clear(),Oe.createdEntityCache.clear(),Ae.length=0,qe.length=0,xe.length=0},sanitizeProcesses:et,sanitizeThreads:tt});const at=new Map,rt=new Map;function ot(e,n){let i=n.get(e)?.parent;for(;i;){if(t.Events.isProfileCall(i.entry)||ct(i.entry))return i.entry;i=i.parent}return null}function ct(e){const n=t.Events.isConsoleRunTask(e),i=e.name.startsWith("v8")||e.name.startsWith("V8");return t.Events.isJSInvocationEvent(e)&&(n||!i)}function lt(e,n){return ut(e,n,ct,t.Events.isDebuggerAsyncTaskRun).at(0)}function dt(e,n){return ut(e,n,t.Events.isProfileCall,t.Events.isDebuggerAsyncTaskRun)}function ut(e,t,n,i){const s=t.get(e);if(!s)return[];const a=[[...s.children]],r=[];for(let e=0;e<a.length;e++){const t=a[e];for(let e=0;e<t.length;e++){const s=t[e];n(s.entry)?r.push(s.entry):i(s.entry)||a.push([...s.children])}}return r}function ft(){return{schedulerToRunEntryPoints:at,asyncCallToScheduler:rt}}var mt=Object.freeze({__proto__:null,data:ft,deps:function(){return["Renderer","Flows"]},finalize:async function(){const{flows:e}=N(),{entryToNode:n}=Xe();for(const s of e){const e=s.at(0);if(!e||!t.Events.isDebuggerAsyncTaskScheduled(e))continue;const a=e.args.taskName,r=s.at(1);if(!r||!t.Events.isDebuggerAsyncTaskRun(r))continue;const o=ot(e,n);if(!o)continue;const c=lt(r,n);if(!c)continue;i.MapUtilities.getWithDefault(at,o,(()=>[])).push(c);const l=dt(r,n);for(const e of l)rt.set(e,{taskName:a,scheduler:o})}},handleEvent:function(e){},reset:function(){at.clear(),rt.clear()}});const gt=new Map;var pt=Object.freeze({__proto__:null,data:function(){return{domStatsByFrameId:gt}},finalize:async function(){},handleEvent:function(e){if(!t.Events.isDOMStats(e))return;i.MapUtilities.getWithDefault(gt,e.args.data.frame,(()=>[])).push(e)},reset:function(){gt.clear()}});let ht=[];const vt=new Map,Et=[],Tt=[],yt=[],Mt=[];const It=["workerStart","redirectStart","redirectEnd","fetchStart","domainLookupStart","domainLookupEnd","connectStart","connectEnd","secureConnectionStart","requestStart","responseStart","responseEnd","navigationStart","unloadEventStart","unloadEventEnd","redirectStart","redirectEnd","fetchStart","commitNavigationEnd","domainLookupStart","domainLookupEnd","connectStart","connectEnd","secureConnectionStart","requestStart","responseStart","responseEnd","domLoading","domInteractive","domContentLoadedEventStart","domContentLoadedEventEnd","domComplete","loadEventStart","loadEventEnd"];function wt(){return{performanceMeasures:ht.filter((e=>"blink.user_timing"===e.cat)),consoleTimings:ht.filter((e=>"blink.console"===e.cat)),performanceMarks:[...Tt],timestampEvents:[...Mt],measureTraceByTraceId:new Map(vt)}}var St=Object.freeze({__proto__:null,data:wt,finalize:async function(){const e=[...Et,...yt];ht=n.Trace.createMatchedSortedSyntheticEvents(e),ht=ht.sort(((e,t)=>function(e,t,n){const i=e.ts,s=t.ts;if(i<s)return-1;if(i>s)return 1;const a=i+(e.dur??0),r=s+(t.dur??0);return a>r?-1:a<r?1:n.indexOf(t)-n.indexOf(e)}(e,t,[...ht])))},handleEvent:function(e){It.includes(e.name)||(t.Events.isUserTimingMeasure(e)&&vt.set(e.args.traceId,e),t.Events.isPerformanceMeasure(e)?Et.push(e):(t.Events.isPerformanceMark(e)&&Tt.push(e),t.Events.isConsoleTime(e)&&yt.push(e),t.Events.isConsoleTimeStamp(e)&&Mt.push(e)))},reset:function(){ht.length=0,Et.length=0,Tt.length=0,yt.length=0,Mt.length=0,vt.clear()}});const Ft=[],Pt=[],_t=[],Rt=new Map,Ct=new Map,Lt=[];function kt(){const e=wt().timestampEvents;for(const i of e){if(!i.args.data)continue;const e=String(i.args.data.name??i.args.data.message);Ct.set(e,i);const s=Nt(i),a=i.args.data.start,r=i.args.data.end;if(!s&&!a&&!r)continue;const o="number"==typeof a?t.Timing.Micro(a):Ct.get(String(a))?.ts,c="number"==typeof r?t.Timing.Micro(r):Ct.get(String(r))?.ts;if(void 0!==c&&void 0===o)continue;const l=o??i.ts,d=c??i.ts;if(s){const a={...i,name:e,cat:"devtools.extension",args:s,rawSourceEvent:i,dur:t.Timing.Micro(d-l),ts:l,ph:"X"},r=n.SyntheticEvents.SyntheticEventsManager.getActiveManager().registerSyntheticEvent(a);Ft.push(r);continue}const u={...i,name:e,cat:"disabled-by-default-v8.inspector",ph:"X",ts:l,dur:t.Timing.Micro(d-l),rawSourceEvent:i},f=n.SyntheticEvents.SyntheticEventsManager.getActiveManager().registerSyntheticEvent(u);Lt.push(f)}}function bt(e){for(const i of e){const e=Dt(i);if(!e)continue;const s={name:i.name,ph:t.Extensions.isExtensionPayloadMarker(e)?"I":"X",pid:i.pid,tid:i.tid,ts:i.ts,dur:i.dur,cat:"devtools.extension",args:e,rawSourceEvent:t.Events.isSyntheticUserTiming(i)?i.rawSourceEvent:i};if(t.Extensions.isExtensionPayloadMarker(e)){const e=n.SyntheticEvents.SyntheticEventsManager.getActiveManager().registerSyntheticEvent(s);_t.push(e)}else if(t.Extensions.isExtensionPayloadTrackEntry(s.args)){const e=n.SyntheticEvents.SyntheticEventsManager.getActiveManager().registerSyntheticEvent(s);Ft.push(e)}else;}}function Dt(e){const n=t.Events.isPerformanceMark(e)?e.args.data?.detail:e.args.data.beginEvent.args.detail;if(!n)return null;try{const e=JSON.parse(n);return"devtools"in e&&t.Extensions.isValidExtensionPayload(e.devtools)?e.devtools:null}catch{return null}}function Nt(e){if(!e.args.data)return null;const t=e.args.data.track;return""===t||void 0===t?null:{color:String(e.args.data.color),track:String(t),dataType:"track-entry",trackGroup:void 0!==e.args.data.trackGroup?String(e.args.data.trackGroup):void 0}}var Bt=Object.freeze({__proto__:null,data:function(){return{entryToNode:Rt,extensionTrackData:Pt,extensionMarkers:_t,syntheticConsoleEntriesForTimingsTrack:Lt}},deps:function(){return["UserTimings"]},extensionDataInConsoleTimeStamp:Nt,extensionDataInPerformanceTiming:Dt,extractConsoleAPIExtensionEntries:kt,extractPerformanceAPIExtensionEntries:bt,finalize:async function(){!function(){const e=wt().performanceMeasures,t=wt().performanceMarks;bt(n.Trace.mergeEventsInOrder(e,t)),kt(),n.Trace.sortTraceEventsInPlace(Ft),n.Extensions.buildTrackDataFromExtensionEntries(Ft,Pt,Rt)}()},handleEvent:function(e){},reset:function(){Ft.length=0,Lt.length=0,Pt.length=0,_t.length=0,Rt.clear(),Ct.clear()}});const Wt=[],Ut=[],Ot=new Map;let xt={},zt=null;const At=[],qt=[];function jt(){return{paints:Wt,snapshots:Ut,paintsToSnapshots:Ot}}var Ht=Object.freeze({__proto__:null,data:jt,deps:function(){return["Meta"]},finalize:async function(){const e=ge();n.Trace.sortTraceEventsInPlace(qt);for(const n of qt)if(t.Events.isSetLayerId(n)){if(e.mainFrameId!==n.args.data.frame)continue;zt=n.args.data.layerTreeId}else if(t.Events.isUpdateLayer(n))At.push(n);else{if(t.Events.isPaint(n)){if(!n.args.data.layerId)continue;Wt.push(n),xt[n.args.data.layerId]=n;continue}if(t.Events.isDisplayListItemListSnapshot(n)){let e=null;for(let t=At.length-1;t>-1;t--){const i=At[t];if(i.pid===n.pid&&i.tid===n.tid){e=i;break}}if(!e)continue;if(e.args.layerTreeId!==zt)continue;const t=xt[e.args.layerId];if(!t)continue;Ut.push(n),Ot.set(t,n)}}},handleEvent:function(e){(t.Events.isPaint(e)||t.Events.isDisplayListItemListSnapshot(e)||t.Events.isUpdateLayer(e)||t.Events.isSetLayerId(e))&&qt.push(e)},reset:function(){Wt.length=0,Ut.length=0,Ot.clear(),xt={},zt=null,At.length=0,qt.length=0}});function $t(e,t,n){let i="OTHER";return"CrRendererMain"===t.name?i="MAIN_THREAD":"DedicatedWorker thread"===t.name?i="WORKER":t.name?.startsWith("CompositorTileWorker")?i="RASTERIZER":n.worklets.has(e)?i="AUCTION_WORKLET":t.name?.startsWith("ThreadPool")&&(i="THREAD_POOL"),i}function Gt(e,t){const n=[];if(e.processes.size)for(const[i,s]of e.processes)for(const[a,r]of s.threads){if(!r.tree)continue;const o=$t(i,r,t);n.push({name:r.name,pid:i,tid:a,processIsOnMainFrame:s.isOnMainFrame,entries:r.entries,tree:r.tree,type:o,entryToNode:e.entryToNode})}return n}const Vt=new WeakMap;var Xt=Object.freeze({__proto__:null,threadsInRenderer:Gt,threadsInTrace:function(e){const t=Vt.get(e);if(t)return t;const n=Gt(e.Renderer,e.AuctionWorklets);if(n.length)return Vt.set(e,n),n;const i=[];if(e.Samples.profilesInProcess.size)for(const[t,n]of e.Samples.profilesInProcess)for(const[s,a]of n)a.profileTree&&i.push({pid:t,tid:s,name:null,entries:a.profileCalls,processIsOnMainFrame:!1,tree:a.profileTree,type:"CPU_PROFILE",entryToNode:e.Samples.entryToNode});return Vt.set(e,i),i}});const Yt=[];let Kt=null;class Qt{#e=[];#t={};#n=new sn;#i=null;#s=!1;#a=!1;#r=null;#o=null;#c=null;#l=null;#d=null;#u=null;#f=null;#m=null;#g=null;#p;constructor(e,t,n,i,s){const a=Gt(t,n).filter((e=>"MAIN_THREAD"===e.type&&e.processIsOnMainFrame)).map((e=>({tid:e.tid,pid:e.pid,startTime:e.entries[0].ts})));this.#p=s,this.#h(e,a,i.mainFrameId)}framesById(){return this.#t}frames(){return this.#e}#v(e,t){this.#i||this.#E(e,t),this.#l=e,this.#n.addFrameIfNotExists(t,e,!1,!1)}#T(e,t,n){this.#i||this.#E(e,t),this.#n.addFrameIfNotExists(t,e,!0,n),this.#n.setDropped(t,!0),this.#n.setPartial(t,n)}#y(e,t){if(this.#i){if(this.#s||!this.#a){if(this.#d){(this.#o?this.#o.triggerTime:this.#l||this.#d)>this.#i.startTime&&(this.#i.idle=!0,this.#l=null),this.#d=null}const e=this.#n.processPendingBeginFramesOnDrawFrame(t);for(const n of e){const e=this.#i.idle;this.#E(n.startTime,t),e&&this.#o&&this.#M(),n.isDropped&&(this.#i.dropped=!0),n.isPartial&&(this.#i.isPartial=!0)}}this.#s=!1}else this.#E(e,t)}#I(){this.#i&&this.#o&&!this.#d&&this.#M()}#w(){this.#i&&(this.#a=!0)}#S(){this.#c&&(this.#o=this.#c,this.#c=null,this.#a=!1,this.#s=!0)}#F(e){this.#r=e}#P(e,t){t&&(this.#d=e)}#E(e,n){this.#i&&this.#_(this.#i,e),this.#i=new Zt(n,e,t.Timing.Micro(e-ge().traceBounds.min))}#_(e,t){e.setLayerTree(this.#r),e.setEndTime(t),this.#r&&(this.#r.paints=e.paints);const n=this.#e[this.#e.length-1];this.#e.length&&n&&(e.startTime!==n.endTime||e.startTime>e.endTime)&&console.assert(!1,`Inconsistent frame time for frame ${this.#e.length} (${e.startTime} - ${e.endTime})`);const i=this.#e.push(e);e.setIndex(i-1),"number"==typeof e.mainFrameId&&(this.#t[e.mainFrameId]=e)}#M(){this.#o&&this.#i&&(this.#i.paints=this.#o.paints,this.#i.mainFrameId=this.#o.mainFrameId,this.#o=null)}#h(e,t,n){let i=0;this.#g=t.length&&t[0].tid||null,this.#m=t.length&&t[0].pid||null;for(let s=0;s<e.length;++s){for(;i+1<t.length&&t[i+1].startTime<=e[s].ts;)this.#g=t[++i].tid,this.#m=t[i].pid;this.#R(e[s],n)}this.#g=null,this.#m=null}#R(e,n){t.Events.isSetLayerId(e)&&e.args.data.frame===n?this.#f=e.args.data.layerTreeId:t.Events.isLayerTreeHostImplSnapshot(e)&&Number(e.id)===this.#f?this.#F({entry:e,paints:[]}):(function(e){return t.Events.isSetLayerId(e)||t.Events.isBeginFrame(e)||t.Events.isDroppedFrame(e)||t.Events.isRequestMainThreadFrame(e)||t.Events.isBeginMainThreadFrame(e)||t.Events.isNeedsBeginFrameChanged(e)||t.Events.isCommit(e)||t.Events.isCompositeLayers(e)||t.Events.isActivateLayerTree(e)||t.Events.isDrawFrame(e)}(e)&&this.#C(e),e.tid===this.#g&&e.pid===this.#m&&this.#L(e))}#C(e){e.args.layerTreeId===this.#f&&(t.Events.isBeginFrame(e)?this.#v(e.ts,e.args.frameSeqId):t.Events.isDrawFrame(e)?this.#y(e.ts,e.args.frameSeqId):t.Events.isActivateLayerTree(e)?this.#I():t.Events.isRequestMainThreadFrame(e)?this.#w():t.Events.isNeedsBeginFrameChanged(e)?this.#P(e.ts,e.args.data&&Boolean(e.args.data.needsBeginFrame)):t.Events.isDroppedFrame(e)&&this.#T(e.ts,e.args.frameSeqId,Boolean(e.args.hasPartialUpdate)))}#L(e){if(function(e){return"RunTask"===e.name&&e.cat.includes("disabled-by-default-devtools.timeline")}(e)&&(this.#u=e.ts),!this.#c&&Jt.has(e.name)&&(this.#c=new tn(this.#u||e.ts)),this.#c){if(t.Events.isBeginMainThreadFrame(e)&&e.args.data.frameId&&(this.#c.mainFrameId=e.args.data.frameId),t.Events.isPaint(e)){const t=this.#p.paintsToSnapshots.get(e);t&&this.#c.paints.push(new en(e,t))}(t.Events.isCompositeLayers(e)||t.Events.isCommit(e))&&e.args.layerTreeId===this.#f&&this.#S()}}}const Jt=new Set(["ScheduleStyleRecalculation","InvalidateLayout","BeginMainThreadFrame","ScrollLayer"]);class Zt{cat="devtools.legacy_frame";name="frame";ph="X";ts;pid=t.Events.ProcessID(-1);tid=t.Events.ThreadID(-1);index=-1;startTime;startTimeOffset;endTime;duration;idle;dropped;isPartial;layerTree;paints;mainFrameId;seqId;constructor(e,n,i){this.seqId=e,this.startTime=n,this.ts=n,this.startTimeOffset=i,this.endTime=this.startTime,this.duration=t.Timing.Micro(0),this.idle=!1,this.dropped=!1,this.isPartial=!1,this.layerTree=null,this.paints=[],this.mainFrameId=void 0}setIndex(e){this.index=e}setEndTime(e){this.endTime=e,this.duration=t.Timing.Micro(this.endTime-this.startTime)}setLayerTree(e){this.layerTree=e}get dur(){return this.duration}}class en{#k;#b;constructor(e,t){this.#k=e,this.#b=t}layerId(){return this.#k.args.data.layerId}event(){return this.#k}picture(){const e=this.#b.args.snapshot.params?.layer_rect,t=this.#b.args.snapshot.skp64;return e&&t?{rect:e,serializedPicture:t}:null}}class tn{paints;mainFrameId;triggerTime;constructor(e){this.paints=[],this.mainFrameId=void 0,this.triggerTime=e}}class nn{seqId;startTime;isDropped;isPartial;constructor(e,t,n,i){this.seqId=e,this.startTime=t,this.isDropped=n,this.isPartial=i}}class sn{queueFrames=[];mapFrames={};addFrameIfNotExists(e,t,n,i){e in this.mapFrames||(this.mapFrames[e]=new nn(e,t,n,i),this.queueFrames.push(e))}setDropped(e,t){e in this.mapFrames&&(this.mapFrames[e].isDropped=t)}setPartial(e,t){e in this.mapFrames&&(this.mapFrames[e].isPartial=t)}processPendingBeginFramesOnDrawFrame(e){const t=[];if(e in this.mapFrames){for(;this.queueFrames[0]!==e;){const e=this.queueFrames[0];this.mapFrames[e].isDropped&&t.push(this.mapFrames[e]),delete this.mapFrames[e],this.queueFrames.shift()}t.push(this.mapFrames[e]),delete this.mapFrames[e],this.queueFrames.shift()}return t}}var an=Object.freeze({__proto__:null,LayerPaintEvent:en,PendingFrame:tn,TimelineFrameBeginFrameQueue:sn,TimelineFrameModel:Qt,data:function(){return{frames:Kt?Array.from(Kt.frames()):[],framesById:Kt?{...Kt.framesById()}:{}}},deps:function(){return["Meta","Renderer","AuctionWorklets","LayerTree"]},finalize:async function(){n.Trace.sortTraceEventsInPlace(Yt);const e=new Qt(Yt,Xe(),j(),ge(),jt());Kt=e},framesWithinWindow:function(e,t,n){const s=i.ArrayUtilities.lowerBound(e,t||0,((e,t)=>e-t.endTime)),a=i.ArrayUtilities.lowerBound(e,n||1/0,((e,t)=>e-t.startTime));return e.slice(s,a)},handleEvent:function(e){Yt.push(e)},reset:function(){Yt.length=0}});const rn=new Map;let on=[];var cn=Object.freeze({__proto__:null,data:function(){return{mainGPUThreadTasks:on}},deps:function(){return["Meta"]},finalize:async function(){const{gpuProcessId:e,gpuThreadId:t}=ge(),n=rn.get(e);n&&t&&(on=n.get(t)||[])},handleEvent:function(e){t.Events.isGPUTask(e)&&n.Trace.addEventToProcessThread(e,rn)},reset:function(){rn.clear(),on=[]}});const ln=new Map,dn=new Map,un=new Map,fn=new Map,mn=new Map;var gn=Object.freeze({__proto__:null,data:function(){return{paintImageByDrawLazyPixelRef:un,paintImageForEvent:fn,paintImageEventForUrl:mn}},finalize:async function(){},handleEvent:function(e){if(t.Events.isPaintImage(e)){const t=ln.get(e.pid)||new Map,n=t.get(e.tid)||[];if(n.push(e),t.set(e.tid,n),ln.set(e.pid,t),e.args.data.url){i.MapUtilities.getWithDefault(mn,e.args.data.url,(()=>[])).push(e)}}else{if(t.Events.isDecodeLazyPixelRef(e)&&void 0!==e.args?.LazyPixelRef){const t=dn.get(e.pid)||new Map,n=t.get(e.tid)||[];n.push(e),t.set(e.tid,n),dn.set(e.pid,t)}if(t.Events.isDrawLazyPixelRef(e)&&void 0!==e.args?.LazyPixelRef){const t=ln.get(e.pid)?.get(e.tid)?.at(-1);if(!t)return;un.set(e.args.LazyPixelRef,t)}else if(t.Events.isDecodeImage(e)){const t=ln.get(e.pid)?.get(e.tid)?.at(-1);if(t)return void fn.set(e,t);const n=dn.get(e.pid)?.get(e.tid)?.at(-1);if(void 0===n?.args?.LazyPixelRef)return;const i=un.get(n.args.LazyPixelRef);if(!i)return;fn.set(e,i)}}},reset:function(){ln.clear(),dn.clear(),un.clear(),fn.clear(),mn.clear()}});const pn=new Map,hn=new Map,vn=new Map,En=new Map,Tn=new Map,yn=new Map,Mn=new Map;function In(e){En.set(e.event,e.initiator);const t=Tn.get(e.initiator)||[];t.push(e.event),Tn.set(e.initiator,t)}var wn=Object.freeze({__proto__:null,data:function(){return{eventToInitiator:En,initiatorToEvents:Tn}},deps:function(){return["Flows","AsyncJSCalls"]},finalize:async function(){!function(){const e=N().flows;for(let t=0;t<e.length;t++){const n=e[t];for(let e=0;e<n.length-1;e++)In({event:n[e+1],initiator:n[e]})}}(),function(){const e=ft().schedulerToRunEntryPoints.entries();for(const[t,n]of e)for(const e of n)In({event:e,initiator:t})}()},handleEvent:function(e){if(t.Events.isScheduleStyleRecalculation(e))pn.set(e.args.data.frame,e);else if(t.Events.isUpdateLayoutTree(e)){if(e.args.beginData){vn.set(e.args.beginData.frame,e);const t=pn.get(e.args.beginData.frame);t&&In({event:e,initiator:t})}}else if(t.Events.isInvalidateLayout(e)){let t=e;if(!hn.has(e.args.data.frame)){const i=vn.get(e.args.data.frame);if(i){const{endTime:s}=n.Timing.eventTimingsMicroSeconds(i),a=En.get(i);a&&s&&s>e.ts&&(t=a)}}hn.set(e.args.data.frame,t)}else if(t.Events.isLayout(e)){const t=hn.get(e.args.beginData.frame);t&&In({event:e,initiator:t}),hn.delete(e.args.beginData.frame)}else if(t.Events.isWebSocketCreate(e))yn.set(e.args.data.identifier,e);else if(t.Events.isWebSocketInfo(e)||t.Events.isWebSocketTransfer(e)){const t=yn.get(e.args.data.identifier);t&&In({event:e,initiator:t})}else if(t.Events.isSchedulePostTaskCallback(e))Mn.set(e.args.data.taskId,e);else if(t.Events.isRunPostTaskCallback(e)||t.Events.isAbortPostTaskCallback(e)){const t=Mn.get(e.args.data.taskId);t&&In({event:e,initiator:t})}},reset:function(){pn.clear(),hn.clear(),vn.clear(),En.clear(),Tn.clear(),yn.clear(),Mn.clear()}});const Sn=new Map,Fn=new Map;let Pn=null,_n=!1;const Rn=[];let Cn=null;function Ln(e,t){const n=Sn.get(e)||[];n.push(t),null!==Cn&&n.length>Cn&&n.shift(),Sn.set(e,n);const i=Fn.get(e)??0;Fn.set(e,i+1)}var kn=Object.freeze({__proto__:null,data:function(){return{invalidationsForEvent:Sn,invalidationCountForEvent:Fn}},finalize:async function(){},handleEvent:function(e){if(0!==Cn)if(t.Events.isUpdateLayoutTree(e)){Pn=e;for(const n of Rn){if(t.Events.isLayoutInvalidationTracking(n))continue;const i=Pn.args.beginData?.frame;i&&n.args.data.frame===i&&Ln(e,n)}}else if(t.Events.isInvalidationTracking(e)){if(_n&&(Rn.length=0,Pn=null,_n=!1),Pn&&(t.Events.isScheduleStyleInvalidationTracking(e)||t.Events.isStyleRecalcInvalidationTracking(e)||t.Events.isStyleInvalidatorInvalidationTracking(e))){const t=Pn.ts+(Pn.dur||0);e.ts>=Pn.ts&&e.ts<=t&&Pn.args.beginData?.frame===e.args.data.frame&&Ln(Pn,e)}Rn.push(e)}else if(t.Events.isPaint(e))_n=!0;else if(t.Events.isLayout(e)){const n=e.args.beginData.frame;for(const i of Rn)t.Events.isLayoutInvalidationTracking(i)&&i.args.data.frame===n&&Ln(e,i)}},handleUserConfig:function(e){Cn=e.maxInvalidationEventsPerEvent},reset:function(){Sn.clear(),Fn.clear(),Pn=null,Rn.length=0,_n=!1,Cn=null}});const bn=new Map;let Dn=[];let Nn=[];const Bn=new Set;function Wn(e,s){const a=e.args.data?.navigationId;if(!a)throw new Error("Navigation event unexpectedly had no navigation ID.");const r=On(s),{rendererProcessesByFrame:o}=ge(),c=o.get(r);if(!c)return;if(c.get(s.pid)&&!t.Events.isNavigationStart(s))if(t.Events.isFirstContentfulPaint(s)){const n=t.Timing.Micro(s.ts-e.ts);Un(r,a,{event:s,metricName:"FCP",classification:zn(n),navigation:e,timing:n})}else if(t.Events.isFirstPaint(s)){Un(r,a,{event:s,metricName:"FP",classification:"unclassified",navigation:e,timing:t.Timing.Micro(s.ts-e.ts)})}else if(t.Events.isMarkDOMContent(s)){const n=t.Timing.Micro(s.ts-e.ts);Un(r,a,{event:s,metricName:"DCL",classification:"unclassified",navigation:e,timing:n})}else if(t.Events.isInteractiveTime(s)){const i=t.Timing.Micro(s.ts-e.ts);Un(r,a,{event:s,metricName:"TTI",classification:An(i),navigation:e,timing:i});const o=n.Timing.milliToMicro(t.Timing.Milli(s.args.args.total_blocking_time_ms));Un(r,a,{event:s,metricName:"TBT",classification:Hn(o),navigation:e,timing:o})}else if(t.Events.isMarkLoad(s)){Un(r,a,{event:s,metricName:"L",classification:"unclassified",navigation:e,timing:t.Timing.Micro(s.ts-e.ts)})}else if(t.Events.isLargestContentfulPaintCandidate(s)){const n=s.args.data?.candidateIndex;if(!n)throw new Error("Largest Contenful Paint unexpectedly had no candidateIndex.");const o=t.Timing.Micro(s.ts-e.ts),c={event:s,metricName:"LCP",classification:qn(o),navigation:e,timing:o},l=i.MapUtilities.getWithDefault(bn,r,(()=>new Map)),d=i.MapUtilities.getWithDefault(l,a,(()=>new Map)).get("LCP");if(void 0===d)return Bn.add(c.event),void Un(r,a,c);const u=d.event;if(!t.Events.isLargestContentfulPaintCandidate(u))return;const f=u.args.data?.candidateIndex;if(!f)return;f<n&&(Bn.delete(u),Bn.add(c.event),Un(r,a,c))}else if(!t.Events.isLayoutShift(s))return i.assertNever(s,`Unexpected event type: ${s}`)}function Un(e,t,n){const s=i.MapUtilities.getWithDefault(bn,e,(()=>new Map)),a=i.MapUtilities.getWithDefault(s,t,(()=>new Map));a.delete(n.metricName),a.set(n.metricName,n)}function On(e){if(t.Events.isFirstContentfulPaint(e)||t.Events.isInteractiveTime(e)||t.Events.isLargestContentfulPaintCandidate(e)||t.Events.isNavigationStart(e)||t.Events.isLayoutShift(e)||t.Events.isFirstPaint(e))return e.args.frame;if(t.Events.isMarkDOMContent(e)||t.Events.isMarkLoad(e)){const t=e.args.data?.frame;if(!t)throw new Error("MarkDOMContent unexpectedly had no frame ID.");return t}i.assertNever(e,`Unexpected event type: ${e}`)}function xn(e){if(t.Events.isFirstContentfulPaint(e)||t.Events.isLargestContentfulPaintCandidate(e)||t.Events.isFirstPaint(e)){const t=e.args.data?.navigationId;if(!t)throw new Error("Trace event unexpectedly had no navigation ID.");const{navigationsByNavigationId:n}=ge(),i=n.get(t);return i||null}if(t.Events.isMarkDOMContent(e)||t.Events.isInteractiveTime(e)||t.Events.isLayoutShift(e)||t.Events.isMarkLoad(e)){const t=On(e),{navigationsByFrameId:i}=ge();return n.Trace.getNavigationForTraceEvent(e,t,i)}return t.Events.isNavigationStart(e)?null:i.assertNever(e,`Unexpected event type: ${e}`)}function zn(e){const i=n.Timing.secondsToMicro(t.Timing.Seconds(1.8));let s="bad";return e<=n.Timing.secondsToMicro(t.Timing.Seconds(3))&&(s="ok"),e<=i&&(s="good"),s}function An(e){const i=n.Timing.secondsToMicro(t.Timing.Seconds(3.8));let s="bad";return e<=n.Timing.secondsToMicro(t.Timing.Seconds(7.3))&&(s="ok"),e<=i&&(s="good"),s}function qn(e){const i=n.Timing.secondsToMicro(t.Timing.Seconds(2.5));let s="bad";return e<=n.Timing.secondsToMicro(t.Timing.Seconds(4))&&(s="ok"),e<=i&&(s="good"),s}function jn(e){return"unclassified"}function Hn(e){const i=n.Timing.milliToMicro(t.Timing.Milli(200));let s="bad";return e<=n.Timing.milliToMicro(t.Timing.Milli(600))&&(s="ok"),e<=i&&(s="good"),s}function $n(){return{metricScoresByFrameId:bn,allMarkerEvents:Dn}}var Gn=Object.freeze({__proto__:null,data:$n,deps:function(){return["Meta"]},finalize:async function(){Nn.sort(((e,t)=>e.ts-t.ts));for(const e of Nn){const t=xn(e);t&&Wn(t,e)}const e=function(){const e=[],t=[...bn.values()].flatMap((e=>[...e.values()]));for(let n=0;n<t.length;n++){const i=t[n].get("LCP");i?.event&&e.push(i.event)}return e}(),n=ge().mainFrameId,i=[...e,...Nn.filter((e=>!t.Events.isLargestContentfulPaintCandidate(e)))].filter(t.Events.isMarkerEvent);Dn=i.filter((e=>On(e)===n)).sort(((e,t)=>e.ts-t.ts))},getFrameIdForPageLoadEvent:On,handleEvent:function(e){t.Events.eventIsPageLoadEvent(e)&&Nn.push(e)},metricIsLCP:function(e){return"LCP"===e.metricName},reset:function(){bn.clear(),Nn=[],Dn=[],Bn.clear()},scoreClassificationForDOMContentLoaded:jn,scoreClassificationForFirstContentfulPaint:zn,scoreClassificationForLargestContentfulPaint:qn,scoreClassificationForTimeToInteractive:An,scoreClassificationForTotalBlockingTime:Hn});const Vn=new Map,Xn=new Map;var Yn=Object.freeze({__proto__:null,data:function(){return{lcpRequestByNavigationId:Xn}},deps:function(){return["Meta","NetworkRequests","PageLoadMetrics"]},finalize:async function(){const e=Re().byTime,{traceBounds:n,navigationsByNavigationId:i}=ge(),s=$n().metricScoresByFrameId;for(const[a,r]of i){const i=s.get(r.args.frame)?.get(a)?.get("LCP"),o=i?.event;if(!o||!t.Events.isLargestContentfulPaintCandidate(o))continue;const c=o.args.data?.nodeId;if(!c)continue;const l=Vn.get(o.pid)?.get(c),d=l?.args.data?.imageUrl;if(!d)continue;const u=r?.ts??n.min,f=l.ts;let m;for(const t of e)if(!(t.ts<u)){if(t.ts>=f)break;if(t.args.data.url===d||t.args.data.redirects.some((e=>e.url===d))){m=t;break}}m&&Xn.set(a,m)}},handleEvent:function(e){if(!t.Events.isLargestImagePaintCandidate(e)||!e.args.data)return;i.MapUtilities.getWithDefault(Vn,e.pid,(()=>new Map)).set(e.args.data.DOMNodeId,e)},reset:function(){Vn.clear()}});const Kn=new Map;var Qn=Object.freeze({__proto__:null,data:function(){return Kn},finalize:async function(){},handleEvent:function(e){t.Events.isLargestTextPaintCandidate(e)&&e.args.data&&Kn.set(e.args.data.DOMNodeId,e)},reset:function(){Kn.clear()}});const Jn=[],Zn=[],ei=[],ti=[];let ni={};function ii(){return{legacySyntheticScreenshots:ti.length?ti:null,screenshots:ei.length?ei:null}}var si=Object.freeze({__proto__:null,data:ii,deps:function(){return["Meta"]},finalize:async function(){const e=n.Trace.createMatchedSortedSyntheticEvents(Jn);ni=Object.fromEntries(e.map((e=>[e.args.data.beginEvent.args.chrome_frame_reporter.frame_sequence,t.Timing.Micro(e.ts+e.dur)])));for(const e of Zn){const{cat:t,name:i,ph:s,pid:a,tid:r}=e,o=n.SyntheticEvents.SyntheticEventsManager.registerSyntheticEvent({rawSourceEvent:e,cat:t,name:i,ph:s,pid:a,tid:r,ts:e.ts,args:{dataUri:`data:image/jpg;base64,${e.args.snapshot}`}});ti.push(o)}},handleEvent:function(e){t.Events.isLegacyScreenshot(e)?Zn.push(e):t.Events.isScreenshot(e)?ei.push(e):t.Events.isPipelineReporter(e)&&Jn.push(e)},reset:function(){Jn.length=0,Zn.length=0,ti.length=0,ei.length=0,ni={}},screenshotImageDataUri:function(e){return t.Events.isLegacySyntheticScreenshot(e)?e.args.dataUri:`data:image/jpg;base64,${e.args.snapshot}`}});const ai=n.Timing.milliToMicro(t.Timing.Milli(5e3)),ri=n.Timing.milliToMicro(t.Timing.Milli(1e3)),oi=[],ci=[],li=[],di=[],ui=[],fi=[],mi=[],gi=[],pi=new Set,hi=[],vi=[];let Ei=0,Ti=-1;const yi=[],Mi=new Map,Ii=[];function wi(e){return{min:e,max:e,range:t.Timing.Micro(0)}}function Si(e,n){e.max=n,e.range=t.Timing.Micro(e.max-e.min)}function Fi(e){const t=ii();if(t.screenshots){const i=n.Trace.findPreviousEventBeforeTimestamp(t.screenshots,e);return{before:i,after:i?t.screenshots[t.screenshots.indexOf(i)+1]:null}}if(t.legacySyntheticScreenshots){const i=n.Trace.findPreviousEventBeforeTimestamp(t.legacySyntheticScreenshots,e);return{before:i,after:i?t.legacySyntheticScreenshots[t.legacySyntheticScreenshots.indexOf(i)+1]:null}}return{before:null,after:null}}var Pi=Object.freeze({__proto__:null,MAX_CLUSTER_DURATION:ai,MAX_SHIFT_TIME_DELTA:ri,data:function(){return{clusters:yi,sessionMaxScore:Ei,clsWindowID:Ti,prePaintEvents:hi,layoutInvalidationEvents:ci,scheduleStyleInvalidationEvents:li,styleRecalcInvalidationEvents:[],renderFrameImplCreateChildFrameEvents:ui,domLoadingEvents:fi,layoutImageUnsizedEvents:mi,remoteFonts:gi,scoreRecords:Ii,backendNodeIds:[...pi],clustersByNavigationId:new Map(Mi),paintImageEvents:vi}},deps:function(){return["Screenshots","Meta"]},finalize:async function(){oi.sort(((e,t)=>e.ts-t.ts)),hi.sort(((e,t)=>e.ts-t.ts)),ci.sort(((e,t)=>e.ts-t.ts)),ui.sort(((e,t)=>e.ts-t.ts)),fi.sort(((e,t)=>e.ts-t.ts)),mi.sort(((e,t)=>e.ts-t.ts)),gi.sort(((e,t)=>e.beginRemoteFontLoadEvent.ts-t.beginRemoteFontLoadEvent.ts)),vi.sort(((e,t)=>e.ts-t.ts)),await async function(){const{navigationsByFrameId:e,mainFrameId:s,traceBounds:a}=ge(),r=e.get(s)||[];if(0===oi.length)return;let o=oi[0].ts,c=oi[0].ts,l=null;for(const e of oi){const s=e.ts-o>ai,a=e.ts-c>ri,d=i.ArrayUtilities.nearestIndexFromEnd(r,(t=>t.ts<e.ts)),u=l!==d&&null!==d;if(s||a||u||!yi.length){const n=e.ts,i=s?o+ai:1/0,l=a?c+ri:1/0,f=u?r[d].ts:1/0,m=Math.min(i,l,f);if(yi.length>0){Si(yi[yi.length-1].clusterWindow,t.Timing.Micro(m))}const g=null===d?t.Events.NO_NAVIGATION:r[d].args.data?.navigationId;yi.push({name:"SyntheticLayoutShiftCluster",events:[],clusterWindow:wi(n),clusterCumulativeScore:0,scoreWindows:{good:wi(n)},navigationId:g,ts:e.ts,pid:e.pid,tid:e.tid,ph:"X",cat:"",dur:t.Timing.Micro(-1)}),o=n}const f=yi[yi.length-1],m=null!==d?t.Timing.Micro(e.ts-r[d].ts):void 0;if(f.clusterCumulativeScore+=e.args.data?e.args.data.weighted_score_delta:0,!e.args.data)continue;const g=n.SyntheticEvents.SyntheticEventsManager.registerSyntheticEvent({rawSourceEvent:e,...e,name:"SyntheticLayoutShift",args:{frame:e.args.frame,data:{...e.args.data,rawEvent:e,navigationId:f.navigationId??void 0}},parsedData:{timeFromNavigation:m,screenshots:Fi(e.ts),cumulativeWeightedScoreInWindow:f.clusterCumulativeScore,sessionWindowData:{cumulativeWindowScore:0,id:yi.length}}});f.events.push(g),Si(f.clusterWindow,e.ts),c=e.ts,l=d}for(const e of yi){let s=0,o=-1;if(e===yi[yi.length-1]){const n=ai+e.clusterWindow.min,s=e.clusterWindow.max+ri,o=i.ArrayUtilities.nearestIndexFromBeginning(r,(t=>t.ts>e.clusterWindow.max)),c=o?r[o].ts:1/0,l=Math.min(n,s,a.max,c);Si(e.clusterWindow,t.Timing.Micro(l))}let c=0,l=null;for(const n of e.events){s+=n.args.data?n.args.data.weighted_score_delta:0,o=n.parsedData.sessionWindowData.id;const i=n.ts;n.parsedData.sessionWindowData.cumulativeWindowScore=e.clusterCumulativeScore,s<.1?Si(e.scoreWindows.good,i):s>=.1&&s<.25?(e.scoreWindows.needsImprovement||(Si(e.scoreWindows.good,t.Timing.Micro(i-1)),e.scoreWindows.needsImprovement=wi(i)),Si(e.scoreWindows.needsImprovement,i)):s>=.25&&(e.scoreWindows.bad||(e.scoreWindows.needsImprovement?Si(e.scoreWindows.needsImprovement,t.Timing.Micro(i-1)):Si(e.scoreWindows.good,t.Timing.Micro(i-1)),e.scoreWindows.bad=wi(n.ts)),Si(e.scoreWindows.bad,i)),e.scoreWindows.bad?Si(e.scoreWindows.bad,e.clusterWindow.max):e.scoreWindows.needsImprovement?Si(e.scoreWindows.needsImprovement,e.clusterWindow.max):Si(e.scoreWindows.good,e.clusterWindow.max);const a=n.args.data?.weighted_score_delta;void 0!==a&&a>c&&(c=a,l=n)}l&&(e.worstShiftEvent=l),e.ts=e.events[0].ts;const d=n.Timing.eventTimingsMicroSeconds(e.events[e.events.length-1]);if(e.dur=t.Timing.Micro(d.endTime-e.events[0].ts+ri),s>Ei&&(Ti=o,Ei=s),e.navigationId){i.MapUtilities.getWithDefault(Mi,e.navigationId,(()=>[])).push(e)}}}(),function(){const{traceBounds:e}=ge();Ii.push({ts:e.min,score:0});for(const e of yi){let t=0;e.events[0].args.data&&Ii.push({ts:e.clusterWindow.min,score:e.events[0].args.data.weighted_score_delta});for(let n=0;n<e.events.length;n++){const i=e.events[n];i.args.data&&(t+=i.args.data.weighted_score_delta,Ii.push({ts:i.ts,score:t}))}Ii.push({ts:e.clusterWindow.max,score:0})}}(),function(){pi.clear();for(const e of oi)if(e.args.data?.impacted_nodes)for(const t of e.args.data.impacted_nodes)pi.add(t.node_id);for(const e of ci)e.args.data?.nodeId&&pi.add(e.args.data.nodeId);for(const e of li)e.args.data?.nodeId&&pi.add(e.args.data.nodeId)}()},handleEvent:function(e){if(!t.Events.isLayoutShift(e)||e.args.data?.had_recent_input)if(t.Events.isLayoutInvalidationTracking(e))ci.push(e);else if(t.Events.isScheduleStyleInvalidationTracking(e)&&li.push(e),t.Events.isStyleRecalcInvalidationTracking(e)&&di.push(e),t.Events.isPrePaint(e))hi.push(e);else{if(t.Events.isRenderFrameImplCreateChildFrame(e)&&ui.push(e),t.Events.isDomLoading(e)&&fi.push(e),t.Events.isLayoutImageUnsized(e)&&mi.push(e),t.Events.isBeginRemoteFontLoad(e)&&gi.push({display:e.args.display,url:e.args.url,beginRemoteFontLoadEvent:e}),t.Events.isRemoteFontLoaded(e))for(const t of gi)t.url===e.args.url&&(t.name=e.args.name);t.Events.isPaintImage(e)&&vi.push(e)}else oi.push(e)},reset:function(){oi.length=0,ci.length=0,li.length=0,di.length=0,hi.length=0,vi.length=0,ui.length=0,mi.length=0,fi.length=0,gi.length=0,pi.clear(),yi.length=0,Ei=0,Ii.length=0,Ti=-1,Mi.clear()},scoreClassificationForLayoutShift:function(e){let t="good";return e>=.1&&(t="ok"),e>=.25&&(t="bad"),t}});const _i=new Map;var Ri=Object.freeze({__proto__:null,data:function(){return{updateCountersByProcess:_i}},finalize:async function(){},handleEvent:function(e){if(t.Events.isUpdateCounters(e)){const t=i.MapUtilities.getWithDefault(_i,e.pid,(()=>[]));t.push(e),_i.set(e.pid,t)}},reset:function(){_i.clear()}});const Ci=new Map;var Li=Object.freeze({__proto__:null,data:function(){return{frames:Ci}},finalize:async function(){},handleEvent:function(e){if(t.Events.isTracingStartedInBrowser(e))for(const t of e.args.data?.frames??[])Ci.set(t.frame,t);else if(t.Events.isCommitLoad(e)){const t=e.args.data;if(!t)return;const n=Ci.get(t.frame);if(!n)return;Ci.set(t.frame,{...n,url:t.url||n.url,name:t.name||t.name})}},reset:function(){Ci.clear()}});const ki=new Map;function bi(e,t){for(const n of e.frameByProcessId?.values()){const e=n.get(t);if(e)return e}return null}function Di(e,t){return e.find((e=>e.args.data.url===t.url))??null}function Ni(e){if(!e.sourceMap)throw new Error("expected source map");const t=e.sourceMap,n=e.content??"",i=n.length,s=n.split("\n"),a={},r=i;let o=r;const c=function(e){const t=new Map,n=e.mappings();for(let e=0;e<n.length-1;e++){const i=n[e],s=n[e+1];i.lineNumber===s.lineNumber&&t.set(i,s.columnNumber)}return t}(e.sourceMap);for(const e of t.mappings()){const n=e.sourceURL,i=e.lineNumber,r=e.columnNumber,l=c.get(e);if(!n)continue;const d=s[i];if(null==d){return{errorMessage:`${t.url()} mapping for line out of bounds: ${i+1}`}}if(r>d.length){return{errorMessage:`${t.url()} mapping for column out of bounds: ${i+1}:${r}`}}let u=0;if(void 0!==l){if(l>d.length){return{errorMessage:`${t.url()} mapping for last column out of bounds: ${i+1}:${l}`}}u=l-r}else u=d.length-r+1;a[n]=(a[n]||0)+u,o-=u}return{files:a,unmappedBytes:o,totalBytes:r}}function Bi(e,t){if(!e)return;const n=e.startsWith("data:");if(!t.isFreshRecording&&t.metadata?.sourceMaps&&!n){const n=t.metadata.sourceMaps.find((t=>t.sourceMapUrl===e));if(n)return n.sourceMap}}var Wi=Object.freeze({__proto__:null,data:function(){return{scripts:[...ki.values()]}},deps:function(){return["Meta","NetworkRequests"]},finalize:async function(e){const t=[...Re().byId.values()];for(const e of ki.values())e.request=Di(t,e)??void 0;if(!e.resolveSourceMap)return;const n=ge(),i=[];for(const t of ki.values()){if(!t.frame||!t.url||!t.sourceMapUrl)continue;const s=bi(n,t.frame)?.url;if(!s)continue;let a=t.url;t.sourceUrl&&(a=r.ParsedURL.ParsedURL.completeURL(s,t.sourceUrl)??t.sourceUrl);const o=r.ParsedURL.ParsedURL.completeURL(a,t.sourceMapUrl);if(!o)continue;t.sourceMapUrl=o;const c={scriptId:t.scriptId,scriptUrl:a,sourceMapUrl:o,frame:t.frame,cachedRawSourceMap:Bi(o,e)},l=e.resolveSourceMap(c).then((e=>{e&&(t.sourceMap=e)}));i.push(l)}await Promise.all(i)},getScriptGeneratedSizes:function(e){return e.sourceMap&&!e.sizes&&(e.sizes=Ni(e)),e.sizes??null},handleEvent:function(e){const n=(e,t)=>{const n=String(t),s=`${e}.${n}`;return i.MapUtilities.getWithDefault(ki,s,(()=>({isolate:e,scriptId:n,frame:"",ts:0})))};if(t.Events.isTargetRundownEvent(e)&&e.args.data){const{isolate:t,scriptId:i,frame:s}=e.args.data,a=n(t,i);return a.frame=s,void(a.ts=e.ts)}if(t.Events.isV8SourceRundownEvent(e)){const{isolate:t,scriptId:i,url:s,sourceUrl:a,sourceMapUrl:r,startLine:o,startColumn:c}=e.args.data,l=n(t,i);return l.url=s,a&&(l.sourceUrl=a),r&&(l.sourceMapUrl=r),void(l.inline=Boolean(o||c))}if(t.Events.isV8SourceRundownSourcesScriptCatchupEvent(e)){const{isolate:t,scriptId:i,sourceText:s}=e.args.data;n(t,i).content=s}else if(t.Events.isV8SourceRundownSourcesLargeScriptCatchupEvent(e)){const{isolate:t,scriptId:i,sourceText:s}=e.args.data,a=n(t,i);a.content=(a.content??"")+s}else;},reset:function(){ki.clear()}});let Ui=null;const Oi=new Map;var xi=Object.freeze({__proto__:null,data:function(){return{dataForUpdateLayoutEvent:Oi}},finalize:async function(){},handleEvent:function(e){t.Events.isSelectorStats(e)&&Ui&&e.args.selector_stats?Oi.set(Ui,{timings:e.args.selector_stats.selector_timings}):t.Events.isUpdateLayoutTree(e)&&(Ui=e)},reset:function(){Ui=null,Oi.clear()}});const zi=[],Ai=[],qi=[],ji=n.Timing.milliToMicro(t.Timing.Milli(200)),Hi=ji,$i=n.Timing.milliToMicro(t.Timing.Milli(500));let Gi=null;const Vi=[],Xi=[],Yi=new Map,Ki=[];const Qi=new Set(["pointerdown","touchstart","pointerup","touchend","mousedown","mouseup","click"]),Ji=new Set(["keydown","keypress","keyup"]);function Zi(e){return Qi.has(e.type)?"POINTER":Ji.has(e.type)?"KEYBOARD":"OTHER"}function es(e){const n={POINTER:new Map,KEYBOARD:new Map,OTHER:new Map};function i(e){const i=Zi(e),s=n[i],a=t.Timing.Micro(e.ts+e.dur),r=s.get(a);if(r){if(e.ts<r.ts)s.set(a,e);else if(e.ts===r.ts&&e.interactionId===r.interactionId){const t=r.processingEnd-r.processingStart;e.processingEnd-e.processingStart>t&&s.set(a,e)}e.processingStart<r.processingStart&&(r.processingStart=e.processingStart,ts(r)),e.processingEnd>r.processingEnd&&(r.processingEnd=e.processingEnd,ts(r))}else s.set(a,e)}for(const t of e)i(t);const s=Object.values(n).flatMap((e=>Array.from(e.values())));return s.sort(((e,t)=>e.ts-t.ts)),s}function ts(e){const n=e.args.data.beginEvent,i=e.args.data.endEvent;e.inputDelay=t.Timing.Micro(e.processingStart-n.ts),e.mainThreadHandling=t.Timing.Micro(e.processingEnd-e.processingStart),e.presentationDelay=t.Timing.Micro(i.ts-e.processingEnd)}function ns(){return{allEvents:zi,beginCommitCompositorFrameEvents:Ai,parseMetaViewportEvents:qi,interactionEvents:Vi,interactionEventsWithNoNesting:Xi,longestInteractionEvent:Gi,interactionsOverThreshold:new Set(Vi.filter((e=>e.dur>ji)))}}var is=Object.freeze({__proto__:null,LONG_INTERACTION_THRESHOLD:ji,categoryOfInteraction:Zi,data:ns,deps:function(){return["Meta"]},finalize:async function(){const{navigationsByFrameId:e}=ge();for(const i of Ki){const s=Yi.get(i.id);if(!s)continue;const{type:a,interactionId:r,timeStamp:o,processingStart:c,processingEnd:l}=i.args.data;if(!(a&&r&&o&&c&&l))continue;const d=t.Timing.Micro(n.Timing.milliToMicro(c)-n.Timing.milliToMicro(o)+i.ts),u=t.Timing.Micro(n.Timing.milliToMicro(l)-n.Timing.milliToMicro(o)+i.ts),f=i.args.frame??i.args.data.frame??"",m=n.Trace.getNavigationForTraceEvent(i,f,e),g=m?.args.data?.navigationId,p=n.SyntheticEvents.SyntheticEventsManager.registerSyntheticEvent({rawSourceEvent:i,cat:i.cat,name:i.name,pid:i.pid,tid:i.tid,ph:i.ph,processingStart:d,processingEnd:u,inputDelay:t.Timing.Micro(-1),mainThreadHandling:t.Timing.Micro(-1),presentationDelay:t.Timing.Micro(-1),args:{data:{beginEvent:i,endEvent:s,frame:f,navigationId:g}},ts:i.ts,dur:t.Timing.Micro(s.ts-i.ts),type:i.args.data.type,interactionId:i.args.data.interactionId});ts(p),Vi.push(p)}Xi.push(...es(Vi));for(const e of Xi)(!Gi||Gi.dur<e.dur)&&(Gi=e)},handleEvent:function(e){if(t.Events.isBeginCommitCompositorFrame(e))return void Ai.push(e);if(t.Events.isParseMetaViewport(e))return void qi.push(e);if(!t.Events.isEventTiming(e))return;if(t.Events.isEventTimingEnd(e)&&Yi.set(e.id,e),zi.push(e),!e.args.data||!t.Events.isEventTimingStart(e))return;const{duration:n,interactionId:i}=e.args.data;n<1||void 0===i||0===i||Ki.push(e)},removeNestedInteractions:es,reset:function(){zi.length=0,Ai.length=0,qi.length=0,Vi.length=0,Ki.length=0,Yi.clear(),Xi.length=0,Gi=null},scoreClassificationForInteractionToNextPaint:function(e){return e<=Hi?"good":e<=$i?"ok":"bad"}});const ss=new Map,as=new Map,rs=[],os=[],cs=[],ls=n.Timing.milliToMicro(t.Timing.Milli(30)),ds=n.Timing.milliToMicro(t.Timing.Milli(50));function us(e,t){const n=i.MapUtilities.getWithDefault(ss,e,(()=>[]));n.push(t),ss.set(e,n);const s=i.MapUtilities.getWithDefault(as,t,(()=>[]));s.push(e),as.set(t,s)}function fs(e,t,n=!0){let i=t.at(-1);for(;i&&e.ts>i.ts+(i.dur||0);)t.pop(),i=t.at(-1);n&&t.push(e)}var ms=Object.freeze({__proto__:null,FORCED_REFLOW_THRESHOLD:ls,LONG_MAIN_THREAD_TASK_THRESHOLD:ds,data:function(){return{perEvent:ss,perWarning:as}},deps:function(){return["UserInteractions"]},finalize:async function(){const e=ns().interactionsOverThreshold;for(const t of e)us(t,"LONG_INTERACTION")},handleEvent:function(e){if(function(e){if(fs(e,rs),fs(e,os,t.Events.isJSInvocationEvent(e)),os.length&&("Layout"===e.name||"UpdateLayoutTree"===e.name))return void cs.push(e);if(1===rs.length){const e=cs.reduce(((e,t)=>e+(t.dur||0)),0);e>=ls&&cs.forEach((e=>us(e,"FORCED_REFLOW"))),cs.length=0}}(e),"RunTask"!==e.name)if(t.Events.isFireIdleCallback(e)){const{duration:t}=n.Timing.eventTimingsMilliSeconds(e);t>e.args.data.allottedMilliseconds&&us(e,"IDLE_CALLBACK_OVER_TIME")}else;else{const{duration:t}=n.Timing.eventTimingsMicroSeconds(e);t>ds&&us(e,"LONG_TASK")}},reset:function(){ss.clear(),as.clear(),rs.length=0,os.length=0,cs.length=0}});const gs=[],ps=new Map,hs=new Map;var vs=Object.freeze({__proto__:null,data:function(){return{workerSessionIdEvents:gs,workerIdByThread:ps,workerURLById:hs}},finalize:async function(){for(const e of gs)e.args.data&&(ps.set(e.args.data.workerThreadId,e.args.data.workerId),hs.set(e.args.data.workerId,e.args.data.url))},handleEvent:function(e){t.Events.isTracingSessionIdForWorker(e)&&gs.push(e)},reset:function(){gs.length=0,ps.clear(),hs.clear()}}),Es=Object.freeze({__proto__:null,AnimationFrames:y,Animations:w,AsyncJSCalls:mt,AuctionWorklets:H,DOMStats:pt,ExtensionTraceData:Bt,Flows:B,Frames:an,GPU:cn,ImagePainting:gn,Initiators:wn,Invalidations:kn,LargestImagePaint:Yn,LargestTextPaint:Qn,LayerTree:Ht,LayoutShifts:Pi,Memory:Ri,Meta:pe,NetworkRequests:Ce,PageFrames:Li,PageLoadMetrics:Gn,Renderer:st,Samples:We,Screenshots:si,Scripts:Wi,SelectorStats:xi,UserInteractions:is,UserTimings:St,Warnings:ms,Workers:vs}),Ts=Object.freeze({__proto__:null});export{m as Helpers,Es as ModelHandlers,Xt as Threads,Ts as Types};
=======
import*as e from"../helpers/helpers.js";import*as t from"../types/types.js";import*as n from"../../../core/platform/platform.js";import*as r from"../../cpu_profile/cpu_profile.js";import*as i from"../../../core/root/root.js";const a=[],s=[];let o=1;var c=Object.freeze({__proto__:null,reset:function(){a.length=0,s.length=0},handleEvent:function(e){t.TraceEvents.isTraceEventAnimation(e)&&a.push(e)},finalize:async function(){const t=e.Trace.createMatchedSortedSyntheticEvents(a);s.push(...t),o=3},data:function(){if(3!==o)throw new Error("Animation handler is not finalized");return{animations:s}}});const d=new Map,l=new Map,m=new Map,u=new Map,f=new Map;function g(e){switch(e){case"seller":return"seller";case"bidder":return"bidder";default:return"unknown"}}function T(t){return e.SyntheticEvents.SyntheticEventsManager.registerSyntheticBasedEvent({rawSourceEvent:t,name:"SyntheticAuctionWorkletEvent",s:"t",cat:t.cat,tid:t.tid,ts:t.ts,ph:"I",pid:t.args.data.pid,host:t.args.data.host,target:t.args.data.target,type:g(t.args.data.type)})}function h(){return{worklets:new Map(m)}}var v=Object.freeze({__proto__:null,reset:function(){d.clear(),l.clear(),m.clear(),u.clear(),f.clear()},handleEvent:function(e){if(t.TraceEvents.isTraceEventAuctionWorkletRunningInProcess(e))d.set(e.args.data.pid,e);else if(t.TraceEvents.isTraceEventAuctionWorkletDoneWithProcess(e))l.set(e.args.data.pid,e);else if(t.TraceEvents.isThreadName(e)){if("auction_worklet.CrUtilityMain"===e.args.name)return void u.set(e.pid,e);"AuctionV8HelperThread"===e.args.name&&f.set(e.pid,e)}},finalize:async function(){for(const[e,t]of u){const n=f.get(e);if(!n)continue;const r=d.get(e),i=l.get(e);let a=null;r?(a={...T(r),args:{data:{runningInProcessEvent:r,utilityThread:t,v8HelperThread:n}}},i&&(a.args.data.doneWithProcessEvent=i)):i&&(a={...T(i),args:{data:{doneWithProcessEvent:i,utilityThread:t,v8HelperThread:n}}},r&&(a.args.data.runningInProcessEvent=r)),null!==a&&m.set(e,a)}},data:h});let p=1;const E=[],w=new Map,M=new Map,I=new Map,S=[],y=[],F=[];function P(e,t){return t+"@"+e}var _=Object.freeze({__proto__:null,EnhancedTracesVersion:1,initialize:function(){if(1!==p)throw new Error("Enhanced Traces Handler was not reset");p=2},reset:function(){E.length=0,w.clear(),M.clear(),I.clear(),S.length=0,y.length=0,F.length=0,p=1},handleEvent:function(e){if(2!==p)throw new Error("Enhanced Traces Handler is not initialized while handling event");if(t.TraceEvents.isTraceEventTargetRundown(e)){const t=e.args?.data;w.set(P(t.isolate,t.scriptId),t.v8context),S.find((e=>e.id===t.frame))||S.push({id:t.frame,type:t.frameType,isolate:t.isolate,pid:e.pid,url:t.url}),y.find((e=>e.v8Context===t.v8context))||y.push({id:-1,origin:t.origin,v8Context:t.v8context,auxData:{frameId:t.frame,isDefault:t.isDefault,type:t.contextType}})}else if(t.TraceEvents.isTraceEventScriptRundown(e)){E.push(e);const t=e.args.data;F.find((e=>e.scriptId===t.scriptId&&e.isolate===t.isolate))||F.push({scriptId:t.scriptId,isolate:t.isolate,executionContextId:t.executionContextId,startLine:t.startLine,startColumn:t.startColumn,endLine:t.endLine,endColumn:t.endColumn,hash:t.hash,isModule:t.isModule,url:t.url,hasSourceUrl:t.hasSourceUrl,sourceMapUrl:t.sourceMapUrl})}else if(t.TraceEvents.isTraceEventScriptRundownSource(e)){const t=e.args.data,n=P(t.isolate,t.scriptId);t.sourceText&&M.set(n,t.sourceText),t.length&&I.set(n,t.length)}},finalize:async function(){if(2!==p)throw new Error("Enhanced Traces Handler is not initialized while being finalized");const e=new Map;E.forEach((t=>{const n=t.args.data,r=w.get(P(n.isolate,n.scriptId));r&&e.set(r,n.executionContextId)})),y.forEach((t=>{if(t.v8Context){const n=e.get(t.v8Context);n&&(t.id=n)}})),F.forEach((e=>{const t=P(e.isolate,e.scriptId);e.sourceText=M.get(t),e.length=I.get(t)})),p=3},data:function(){if(3!==p)throw new Error("Enhanced Traces Handler is not finalized");return{targets:S,executionContexts:y,scripts:F}}});let C=[];const R=[],k=[],L=[],D=[];let b=1;const N=["workerStart","redirectStart","redirectEnd","fetchStart","domainLookupStart","domainLookupEnd","connectStart","connectEnd","secureConnectionStart","requestStart","responseStart","responseEnd"],z=["navigationStart","unloadEventStart","unloadEventEnd","redirectStart","redirectEnd","fetchStart","commitNavigationEnd","domainLookupStart","domainLookupEnd","connectStart","connectEnd","secureConnectionStart","requestStart","responseStart","responseEnd","domLoading","domInteractive","domContentLoadedEventStart","domContentLoadedEventEnd","domComplete","loadEventStart","loadEventEnd"];function W(){if(3!==b)throw new Error("UserTimings handler is not finalized");return{performanceMeasures:C.filter((e=>"blink.user_timing"===e.cat)),consoleTimings:C.filter((e=>"blink.console"===e.cat)),performanceMarks:[...k],timestampEvents:[...D]}}var x=Object.freeze({__proto__:null,reset:function(){C.length=0,R.length=0,k.length=0,L.length=0,D.length=0,b=2},handleEvent:function(e){if(2!==b)throw new Error("UserTimings handler is not initialized");[...N,...z].includes(e.name)||(t.TraceEvents.isTraceEventPerformanceMeasure(e)?R.push(e):(t.TraceEvents.isTraceEventPerformanceMark(e)&&k.push(e),t.TraceEvents.isTraceEventConsoleTime(e)&&L.push(e),t.TraceEvents.isTraceEventTimeStamp(e)&&D.push(e)))},finalize:async function(){if(2!==b)throw new Error("UserTimings handler is not initialized");const t=[...R,...L];C=e.Trace.createMatchedSortedSyntheticEvents(t),b=3},data:W});const O=[],B=[],U=[];let q=1;function H(e){for(const n of e){const e=A(n);if(!e)continue;const r={name:n.name,ph:"X",pid:t.TraceEvents.ProcessID(0),tid:t.TraceEvents.ThreadID(0),ts:n.ts,selfTime:t.Timing.MicroSeconds(0),dur:n.dur,cat:"devtools.extension",args:e};t.Extensions.isExtensionPayloadMarker(e)?U.push(r):t.Extensions.isExtensionPayloadTrackEntry(e)&&O.push(r)}}function A(e){const n=t.TraceEvents.isTraceEventPerformanceMark(e)?e.args.data?.detail:e.args.data.beginEvent.args.detail;if(!n)return null;try{const e=JSON.parse(n);return"devtools"in e&&t.Extensions.isValidExtensionPayload(e.devtools)?e.devtools:null}catch(e){return null}}var j=Object.freeze({__proto__:null,handleEvent:function(e){},reset:function(){q=2,O.length=0,B.length=0,U.length=0},finalize:async function(){if(2!==q)throw new Error("ExtensionTraceData handler is not initialized");!function(){const t=W().performanceMeasures,n=W().performanceMarks;H(e.Trace.mergeEventsInOrder(t,n)),e.Extensions.buildTrackDataFromExtensionEntries(O,B)}(),q=3},extractExtensionEntries:H,extensionDataInTiming:A,data:function(){if(3!==q)throw new Error("ExtensionTraceData handler is not finalized");return{extensionTrackData:[...B],extensionMarkers:[...U]}},deps:function(){return["UserTimings"]}});const G=new Map;let V="",$="";const X=new Map;let Y=t.TraceEvents.ProcessID(-1),K=t.TraceEvents.ThreadID(-1),Q=t.TraceEvents.ProcessID(-1),J=t.TraceEvents.ThreadID(-1),Z=null;const ee=new Map,te=new Set,ne={min:t.Timing.MicroSeconds(Number.POSITIVE_INFINITY),max:t.Timing.MicroSeconds(Number.NEGATIVE_INFINITY),range:t.Timing.MicroSeconds(Number.POSITIVE_INFINITY)},re=new Map,ie=new Map,ae=[],se=new Map;let oe=t.Timing.MicroSeconds(-1);const ce=new Set(["B","E","X","I"]);let de=1,le=!0;const me=new Set(["TracingStartedInPage","TracingSessionIdForWorker","TracingStartedInBrowser"]);function ue(e,r){n.MapUtilities.getWithDefault(X,r.processId,(()=>new Map)).set(r.frame,r);const i=n.MapUtilities.getWithDefault(G,r.frame,(()=>new Map)),a=n.MapUtilities.getWithDefault(i,r.processId,(()=>[])),s=a.at(-1);s&&s.frame.url===r.url||a.push({frame:r,window:{min:e.ts,max:t.Timing.MicroSeconds(0),range:t.Timing.MicroSeconds(0)}})}function fe(){if(3!==de)throw new Error("Meta Handler is not finalized");return{traceBounds:{...ne},browserProcessId:Y,browserThreadId:K,processNames:ee,gpuProcessId:Q,gpuThreadId:J===t.TraceEvents.ThreadID(-1)?void 0:J,viewportRect:Z||void 0,mainFrameId:V,mainFrameURL:$,navigationsByFrameId:re,navigationsByNavigationId:ie,threadsInProcess:se,rendererProcessesByFrame:G,topLevelRendererIds:te,frameByProcessId:X,mainFrameNavigations:ae,traceIsGeneric:le}}var ge=Object.freeze({__proto__:null,reset:function(){re.clear(),ie.clear(),ee.clear(),ae.length=0,Y=t.TraceEvents.ProcessID(-1),K=t.TraceEvents.ThreadID(-1),Q=t.TraceEvents.ProcessID(-1),J=t.TraceEvents.ThreadID(-1),Z=null,te.clear(),se.clear(),G.clear(),X.clear(),ne.min=t.Timing.MicroSeconds(Number.POSITIVE_INFINITY),ne.max=t.Timing.MicroSeconds(Number.NEGATIVE_INFINITY),ne.range=t.Timing.MicroSeconds(Number.POSITIVE_INFINITY),oe=t.Timing.MicroSeconds(-1),le=!0,de=1},initialize:function(){if(1!==de)throw new Error("Meta Handler was not reset");de=2},handleEvent:function(e){if(2!==de)throw new Error("Meta Handler is not initialized");if(le&&me.has(e.name)&&(le=!1),t.TraceEvents.isProcessName(e)&&ee.set(e.pid,e),0!==e.ts&&!e.name.endsWith("::UMA")&&ce.has(e.ph)){ne.min=t.Timing.MicroSeconds(Math.min(e.ts,ne.min));const n=e.dur||t.Timing.MicroSeconds(0);ne.max=t.Timing.MicroSeconds(Math.max(e.ts+n,ne.max))}if(!t.TraceEvents.isProcessName(e)||"Browser"!==e.args.name&&"HeadlessBrowser"!==e.args.name)if(!t.TraceEvents.isProcessName(e)||"Gpu"!==e.args.name&&"GPU Process"!==e.args.name)if(t.TraceEvents.isThreadName(e)&&"CrGpuMain"===e.args.name)J=e.tid;else{if(t.TraceEvents.isThreadName(e)&&"CrBrowserMain"===e.args.name&&(K=e.tid),t.TraceEvents.isTraceEventMainFrameViewport(e)&&null===Z){const t=e.args.data.viewport_rect,n=t[0],r=t[1],i=t[2],a=t[5];Z=new DOMRect(n,r,i,a)}if(t.TraceEvents.isTraceEventTracingStartedInBrowser(e)){if(oe=e.ts,!e.args.data)throw new Error("No frames found in trace data");for(const t of e.args.data.frames??[]){ue(e,t),t.parent||te.add(t.processId);const n="isOutermostMainFrame"in t;"isInPrimaryMainFrame"in t&&n?t.isInPrimaryMainFrame&&t.isOutermostMainFrame&&(V=t.frame,$=t.url):n?t.isOutermostMainFrame&&(V=t.frame,$=t.url):!t.parent&&t.url&&(V=t.frame,$=t.url)}}else if(t.TraceEvents.isTraceEventFrameCommittedInBrowser(e)){const t=e.args.data;if(!t)return;if(ue(e,t),t.parent)return;te.add(t.processId)}else if(t.TraceEvents.isTraceEventCommitLoad(e)){const t=e.args.data;if(!t)return;const{frame:n,name:r,url:i}=t;ue(e,{processId:e.pid,frame:n,name:r,url:i})}else if(t.TraceEvents.isThreadName(e)){n.MapUtilities.getWithDefault(se,e.pid,(()=>new Map)).set(e.tid,e)}else if(t.TraceEvents.isTraceEventNavigationStartWithURL(e)&&e.args.data){const t=e.args.data.navigationId;if(ie.has(t))return;ie.set(t,e);const n=e.args.frame,r=re.get(n)||[];return r.push(e),re.set(n,r),void(n===V&&ae.push(e))}}else Q=e.pid;else Y=e.pid},finalize:async function(){if(2!==de)throw new Error("Handler is not initialized");oe>=0&&(ne.min=oe),ne.range=t.Timing.MicroSeconds(ne.max-ne.min);for(const[,e]of G){const n=[...e.values()].flat();for(let e=0;e<n.length;e++){const r=n[e],i=n[e+1];i?(r.window.max=t.Timing.MicroSeconds(i.window.min-1),r.window.range=t.Timing.MicroSeconds(r.window.max-r.window.min)):(r.window.max=t.Timing.MicroSeconds(ne.max),r.window.range=t.Timing.MicroSeconds(ne.max-r.window.min))}}for(const[e,t]of re)if(!G.has(e)){re.delete(e);for(const e of t)e.args.data&&ie.delete(e.args.data.navigationId)}const n=ae.at(0),r=e.Timing.secondsToMicroseconds(t.Timing.Seconds(.5));if(n){const e=n.ts-ne.min<r;n.args.data?.isOutermostMainFrame&&n.args.data?.documentLoaderURL&&e&&($=n.args.data.documentLoaderURL)}de=3},data:fe});let Te=1;const he=[],ve=[],pe=new Map;let Ee={},we=null;const Me=[],Ie=[];function Se(){return{paints:he,snapshots:ve,paintsToSnapshots:pe}}var ye=Object.freeze({__proto__:null,reset:function(){Te=1,he.length=0,ve.length=0,pe.clear(),Ee={},we=null,Me.length=0,Ie.length=0},initialize:function(){if(1!==Te)throw new Error("LayerTree Handler was not reset before being initialized");Te=2},handleEvent:function(e){(t.TraceEvents.isTraceEventPaint(e)||t.TraceEvents.isTraceEventDisplayListItemListSnapshot(e)||t.TraceEvents.isTraceEventUpdateLayer(e)||t.TraceEvents.isTraceEventSetLayerId(e))&&Ie.push(e)},finalize:async function(){if(2!==Te)throw new Error("LayerTree Handler is not initialized");const n=fe();e.Trace.sortTraceEventsInPlace(Ie);for(const e of Ie)if(t.TraceEvents.isTraceEventSetLayerId(e)){if(n.mainFrameId!==e.args.data.frame)continue;we=e.args.data.layerTreeId}else if(t.TraceEvents.isTraceEventUpdateLayer(e))Me.push(e);else{if(t.TraceEvents.isTraceEventPaint(e)){if(!e.args.data.layerId)continue;he.push(e),Ee[e.args.data.layerId]=e;continue}if(t.TraceEvents.isTraceEventDisplayListItemListSnapshot(e)){let t=null;for(let n=Me.length-1;n>-1;n--){const r=Me[n];if(r.pid===e.pid&&r.tid===e.tid){t=r;break}}if(!t)continue;if(t.args.layerTreeId!==we)continue;const n=Ee[t.args.layerId];if(!n)continue;ve.push(e),pe.set(n,e)}}Te=3},data:Se,deps:function(){return["Meta"]}});const Fe=new Map,Pe=new Map,_e=new Map,Ce=new Map;let Re=1;function ke(){if(3!==Re)throw new Error("Samples Handler is not finalized");return{profilesInProcess:Pe,entryToNode:_e}}function Le(e,t){const r=n.MapUtilities.getWithDefault(Ce,e,(()=>new Map));return n.MapUtilities.getWithDefault(r,t,(()=>({rawProfile:{startTime:0,endTime:0,nodes:[],samples:[],timeDeltas:[],lines:[]},profileId:t})))}var De=Object.freeze({__proto__:null,reset:function(){Fe.clear(),Ce.clear(),Pe.clear(),_e.clear(),Re=1},initialize:function(){if(1!==Re)throw new Error("Samples Handler was not reset");Re=2},handleEvent:function(e){if(2!==Re)throw new Error("Samples Handler is not initialized");if(t.TraceEvents.isSyntheticCpuProfile(e)){const t=e.pid,n=e.tid,r=Le(t,"0x1");return r.rawProfile=e.args.data.cpuProfile,void(r.threadId=n)}if(t.TraceEvents.isTraceEventProfile(e)){const t=Le(e.pid,e.id);return t.rawProfile.startTime=e.ts,void(t.threadId=e.tid)}if(t.TraceEvents.isTraceEventProfileChunk(e)){const t=Le(e.pid,e.id).rawProfile,n=e.args?.data?.cpuProfile||{samples:[]},r=n?.samples||[],i=[];for(const e of n?.nodes||[]){const t=void 0===e.callFrame.lineNumber?-1:e.callFrame.lineNumber,n=void 0===e.callFrame.columnNumber?-1:e.callFrame.columnNumber,r=String(e.callFrame.scriptId),a=e.callFrame.url||"",s={...e,callFrame:{...e.callFrame,url:a,lineNumber:t,columnNumber:n,scriptId:r}};i.push(s)}const a=e.args.data?.timeDeltas||[],s=e.args.data?.lines||Array(r.length).fill(0);if(t.nodes.push(...i),t.samples?.push(...r),t.timeDeltas?.push(...a),t.lines?.push(...s),t.samples&&t.timeDeltas&&t.samples.length!==t.timeDeltas.length)return void console.error("Failed to parse CPU profile.");if(!t.endTime&&t.timeDeltas){const e=t.timeDeltas;t.endTime=e.reduce(((e,t)=>e+t),t.startTime)}}else;},finalize:async function(){if(2!==Re)throw new Error("Samples Handler is not initialized");!function(){for(const[s,o]of Ce)for(const[c,d]of o){const l=d.threadId;if(!d.rawProfile.nodes.length||void 0===l)continue;const m=[],u=new r.CPUProfileDataModel.CPUProfileDataModel(d.rawProfile),f=e.TreeHelpers.makeEmptyTraceEntryTree();f.maxDepth=u.maxDepth;const g={rawProfile:d.rawProfile,parsedProfile:u,profileCalls:[],profileTree:f,profileId:c},T=n.MapUtilities.getWithDefault(Pe,s,(()=>new Map));function i(n,r,i,a){if(void 0===l)return;const o=e.Timing.millisecondsToMicroseconds(t.Timing.MilliSeconds(a)),d=r.id,u=e.Trace.makeProfileCall(r,c,i,o,s,l);g.profileCalls.push(u),m.push(g.profileCalls.length-1);const f=e.TreeHelpers.makeEmptyTraceEntryNode(u,d);_e.set(u,f),f.depth=n,1===m.length&&g.profileTree?.roots.add(f)}function a(n,r,i,a,s,o){const d=m.pop(),l=void 0!==d&&g.profileCalls[d];if(!l)return;const{callFrame:u,ts:f,pid:T,tid:h}=l,v=_e.get(l);if(void 0===u||void 0===f||void 0===T||void 0===c||void 0===h||void 0===v)return;const p=e.Timing.millisecondsToMicroseconds(t.Timing.MilliSeconds(s)),E=e.Timing.millisecondsToMicroseconds(t.Timing.MilliSeconds(o));l.dur=p,l.selfTime=E;const w=m.at(-1),M=void 0!==w&&g.profileCalls.at(w),I=M&&_e.get(M);I&&(v.parent=I,I.children.push(v))}u.forEachFrame(i,a),T.set(l,g)}}(),Re=3},data:ke,getProfileCallFunctionName:function(e,t){const n=e.profilesInProcess.get(t.pid)?.get(t.tid),r=n?.parsedProfile.nodeById(t.nodeId);return r?.functionName?r.functionName:t.callFrame.functionName}});let be;const Ne=new Map,ze=Array(),We=new Map;let xe=[];const Oe=[];let Be=1,Ue=t.Configuration.defaults();const qe=()=>({url:null,isOnMainFrame:!1,threads:new Map}),He=()=>({name:null,entries:[],profileCalls:[]}),Ae=(e,t)=>n.MapUtilities.getWithDefault(e,t,qe),je=(e,t)=>n.MapUtilities.getWithDefault(e.threads,t,He);function Ge(){if(3!==Be)throw new Error("Renderer Handler is not finalized");return{processes:new Map(Ne),compositorTileWorkers:new Map(Ve()),entryToNode:new Map(We),allTraceEntries:[...xe]}}function Ve(){const e=new Map;for(const t of ze){const n=e.get(t.pid)||[];n.push(t.tid),e.set(t.pid,n)}return e}function $e(e,t,n,r){Xe(e,n),Ye(e,t,n),Ke(e,n,r)}function Xe(e,t){for(const n of t.values())for(const[t,r]of n)for(const n of r.flat()){const r=Ae(e,t);if(null===r.url||"about:blank"===r.url)try{new URL(n.frame.url),r.url=n.frame.url}catch(e){r.url=null}}}function Ye(e,t,n){for(const[r,i]of n)for(const[n]of i){const i=Ae(e,n);r===t&&(i.isOnMainFrame=!0)}}function Ke(e,t,n){for(const[t,r]of e)for(const[e,i]of n.get(t)??[]){je(r,e).name=i?.args.name??`${e}`}}function Qe(e){if(be)return;const t=h().worklets;if(!fe().traceIsGeneric)for(const[n,r]of e)if(null!==r.url);else{const i=t.get(n);i?r.url=i.host:e.delete(n)}}function Je(e){for(const[,t]of e)for(const[e,n]of t.threads)n.tree?.roots.size||t.threads.delete(e)}function Ze(t,n){const r=ke();for(const[i,a]of t)for(const[t,s]of a.threads){if(!s.entries.length){s.tree=e.TreeHelpers.makeEmptyTraceEntryTree();continue}e.Trace.sortTraceEventsInPlace(s.entries);const a=r.profilesInProcess.get(i)?.get(t);if(a){const n=a.parsedProfile,r=n&&new e.SamplesIntegrator.SamplesIntegrator(n,a.profileId,i,t,Ue),o=r?.buildProfileCalls(s.entries);if(r&&o){xe=[...xe,...o],s.entries=e.Trace.mergeEventsInOrder(s.entries,o),s.profileCalls=o;const t=r.jsSampleEvents;t&&(xe=[...xe,...t],s.entries=e.Trace.mergeEventsInOrder(s.entries,t))}}const o=e.TreeHelpers.treify(s.entries,n);s.tree=o.tree;for(const[e,t]of o.entryToNode)We.set(e,t)}}function et(e){if(t.TraceEvents.isTraceEventEnd(e)){const n=Oe.pop();return n?n.name!==e.name||n.cat!==e.cat?(console.error("Begin/End events mismatch at "+n.ts+" ("+n.name+") vs. "+e.ts+" ("+e.name+")"),null):(n.dur=t.Timing.MicroSeconds(e.ts-n.ts),null):null}const n={...e,ph:"X",dur:t.Timing.MicroSeconds(0)};return Oe.push(n),n}var tt=Object.freeze({__proto__:null,handleUserConfig:function(e){Ue=e},reset:function(){Ne.clear(),We.clear(),xe.length=0,Oe.length=0,ze.length=0,Be=1},initialize:function(){if(1!==Be)throw new Error("Renderer Handler was not reset");be=i.Runtime.experiments.isEnabled("react-native-specific-ui"),Be=2},handleEvent:function(e){if(2!==Be)throw new Error("Renderer Handler is not initialized");if(t.TraceEvents.isThreadName(e)&&e.args.name?.startsWith("CompositorTileWorker")&&ze.push({pid:e.pid,tid:e.tid}),t.TraceEvents.isTraceEventBegin(e)||t.TraceEvents.isTraceEventEnd(e)){const t=Ae(Ne,e.pid),n=je(t,e.tid),r=et(e);if(!r)return;return n.entries.push(r),void xe.push(r)}if(t.TraceEvents.isTraceEventInstant(e)||t.TraceEvents.isTraceEventComplete(e)){const t=Ae(Ne,e.pid);je(t,e.tid).entries.push(e),xe.push(e)}},finalize:async function(){if(2!==Be)throw new Error("Renderer Handler is not initialized");const{mainFrameId:t,rendererProcessesByFrame:n,threadsInProcess:r}=fe();$e(Ne,t,n,r),Qe(Ne),Ze(Ne),Je(Ne),e.Trace.sortTraceEventsInPlace(xe),Be=3},data:Ge,assignMeta:$e,assignOrigin:Xe,assignIsMainFrame:Ye,assignThreadName:Ke,sanitizeProcesses:Qe,sanitizeThreads:Je,buildHierarchy:Ze,makeCompleteEvent:et,deps:function(){return["Meta","Samples","AuctionWorklets"]}});function nt(e,t,n){let r="OTHER";return"CrRendererMain"===t.name?r="MAIN_THREAD":"DedicatedWorker thread"===t.name?r="WORKER":t.name?.startsWith("CompositorTileWorker")?r="RASTERIZER":n.worklets.has(e)?r="AUCTION_WORKLET":t.name?.startsWith("ThreadPool")&&(r="THREAD_POOL"),r}function rt(e,t){const n=[];if(e.processes.size)for(const[r,i]of e.processes)for(const[a,s]of i.threads){if(!s.tree)continue;const o=nt(r,s,t);n.push({name:s.name,pid:r,tid:a,processIsOnMainFrame:i.isOnMainFrame,entries:s.entries,tree:s.tree,type:o,entryToNode:e.entryToNode})}return n}var it=Object.freeze({__proto__:null,threadsInRenderer:rt,threadsInTrace:function(e){const t=rt(e.Renderer,e.AuctionWorklets);if(t.length)return t;const n=[];if(e.Samples.profilesInProcess.size)for(const[t,r]of e.Samples.profilesInProcess)for(const[i,a]of r)a.profileTree&&n.push({pid:t,tid:i,name:null,entries:a.profileCalls,processIsOnMainFrame:!1,tree:a.profileTree,type:"CPU_PROFILE",entryToNode:e.Samples.entryToNode});return n}});let at=1;const st=[];let ot=null;class ct{#e=[];#t={};#n=new gt;#r=null;#i=!1;#a=!1;#s=null;#o=null;#c=null;#d=null;#l=null;#m=null;#u=null;#f=null;#g=null;#T;constructor(e,t,n,r,i){const a=rt(t,n).filter((e=>"MAIN_THREAD"===e.type&&e.processIsOnMainFrame)).map((e=>({tid:e.tid,pid:e.pid,startTime:e.entries[0].ts})));this.#T=i,this.#h(e,a,r.mainFrameId)}framesById(){return this.#t}frames(){return this.#e}#v(e,t){this.#r||this.#p(e,t),this.#d=e,this.#n.addFrameIfNotExists(t,e,!1,!1)}#E(e,t,n){this.#r||this.#p(e,t),this.#n.addFrameIfNotExists(t,e,!0,n),this.#n.setDropped(t,!0),this.#n.setPartial(t,n)}#w(e,t){if(this.#r){if(this.#i||!this.#a){if(this.#l){(this.#o?this.#o.triggerTime:this.#d||this.#l)>this.#r.startTime&&(this.#r.idle=!0,this.#d=null),this.#l=null}const e=this.#n.processPendingBeginFramesOnDrawFrame(t);for(const n of e){const e=this.#r.idle;this.#p(n.startTime,t),e&&this.#o&&this.#M(),n.isDropped&&(this.#r.dropped=!0),n.isPartial&&(this.#r.isPartial=!0)}}this.#i=!1}else this.#p(e,t)}#I(){this.#r&&this.#o&&!this.#l&&this.#M()}#S(){this.#r&&(this.#a=!0)}#y(){this.#c&&(this.#o=this.#c,this.#c=null,this.#a=!1,this.#i=!0)}#F(e){this.#s=e}#P(e,t){t&&(this.#l=e)}#p(e,n){this.#r&&this.#_(this.#r,e),this.#r=new lt(n,e,t.Timing.MicroSeconds(e-fe().traceBounds.min))}#_(e,t){e.setLayerTree(this.#s),e.setEndTime(t),this.#s&&(this.#s.paints=e.paints);const n=this.#e[this.#e.length-1];this.#e.length&&n&&(e.startTime!==n.endTime||e.startTime>e.endTime)&&console.assert(!1,`Inconsistent frame time for frame ${this.#e.length} (${e.startTime} - ${e.endTime})`),this.#e.push(e),"number"==typeof e.mainFrameId&&(this.#t[e.mainFrameId]=e)}#M(){this.#o&&this.#r&&(this.#r.paints=this.#o.paints,this.#r.mainFrameId=this.#o.mainFrameId,this.#o=null)}#h(e,t,n){let r=0;this.#g=t.length&&t[0].tid||null,this.#f=t.length&&t[0].pid||null;for(let i=0;i<e.length;++i){for(;r+1<t.length&&t[r+1].startTime<=e[i].ts;)this.#g=t[++r].tid,this.#f=t[r].pid;this.#C(e[i],n)}this.#g=null,this.#f=null}#C(e,n){t.TraceEvents.isTraceEventSetLayerId(e)&&e.args.data.frame===n?this.#u=e.args.data.layerTreeId:t.TraceEvents.isTraceEventLayerTreeHostImplSnapshot(e)&&Number(e.id)===this.#u?this.#F({entry:e,paints:[]}):(function(e){return t.TraceEvents.isTraceEventSetLayerId(e)||t.TraceEvents.isTraceEventBeginFrame(e)||t.TraceEvents.isTraceEventDroppedFrame(e)||t.TraceEvents.isTraceEventRequestMainThreadFrame(e)||t.TraceEvents.isTraceEventBeginMainThreadFrame(e)||t.TraceEvents.isTraceEventNeedsBeginFrameChanged(e)||t.TraceEvents.isTraceEventCommit(e)||t.TraceEvents.isTraceEventCompositeLayers(e)||t.TraceEvents.isTraceEventActivateLayerTree(e)||t.TraceEvents.isTraceEventDrawFrame(e)}(e)&&this.#R(e),e.tid===this.#g&&e.pid===this.#f&&this.#k(e))}#R(e){e.args.layerTreeId===this.#u&&(t.TraceEvents.isTraceEventBeginFrame(e)?this.#v(e.ts,e.args.frameSeqId):t.TraceEvents.isTraceEventDrawFrame(e)?this.#w(e.ts,e.args.frameSeqId):t.TraceEvents.isTraceEventActivateLayerTree(e)?this.#I():t.TraceEvents.isTraceEventRequestMainThreadFrame(e)?this.#S():t.TraceEvents.isTraceEventNeedsBeginFrameChanged(e)?this.#P(e.ts,e.args.data&&Boolean(e.args.data.needsBeginFrame)):t.TraceEvents.isTraceEventDroppedFrame(e)&&this.#E(e.ts,e.args.frameSeqId,Boolean(e.args.hasPartialUpdate)))}#k(e){if(function(e){return"RunTask"===e.name&&e.cat.includes("disabled-by-default-devtools.timeline")}(e)&&(this.#m=e.ts),!this.#c&&dt.has(e.name)&&(this.#c=new ut(this.#m||e.ts)),this.#c){if(t.TraceEvents.isTraceEventBeginMainThreadFrame(e)&&e.args.data.frameId&&(this.#c.mainFrameId=e.args.data.frameId),t.TraceEvents.isTraceEventPaint(e)){const t=this.#T.paintsToSnapshots.get(e);t&&this.#c.paints.push(new mt(e,t))}(t.TraceEvents.isTraceEventCompositeLayers(e)||t.TraceEvents.isTraceEventCommit(e))&&e.args.layerTreeId===this.#u&&this.#y()}}}const dt=new Set(["ScheduleStyleRecalculation","InvalidateLayout","BeginMainThreadFrame","ScrollLayer"]);class lt{startTime;startTimeOffset;endTime;duration;idle;dropped;isPartial;layerTree;paints;mainFrameId;seqId;constructor(e,n,r){this.seqId=e,this.startTime=n,this.startTimeOffset=r,this.endTime=this.startTime,this.duration=t.Timing.MicroSeconds(0),this.idle=!1,this.dropped=!1,this.isPartial=!1,this.layerTree=null,this.paints=[],this.mainFrameId=void 0}setEndTime(e){this.endTime=e,this.duration=t.Timing.MicroSeconds(this.endTime-this.startTime)}setLayerTree(e){this.layerTree=e}}class mt{#L;#D;constructor(e,t){this.#L=e,this.#D=t}layerId(){return this.#L.args.data.layerId}event(){return this.#L}picture(){const e=this.#D.args.snapshot.params?.layer_rect,t=this.#D.args.snapshot.skp64;return e&&t?{rect:e,serializedPicture:t}:null}}class ut{paints;mainFrameId;triggerTime;constructor(e){this.paints=[],this.mainFrameId=void 0,this.triggerTime=e}}class ft{seqId;startTime;isDropped;isPartial;constructor(e,t,n,r){this.seqId=e,this.startTime=t,this.isDropped=n,this.isPartial=r}}class gt{queueFrames=[];mapFrames={};addFrameIfNotExists(e,t,n,r){e in this.mapFrames||(this.mapFrames[e]=new ft(e,t,n,r),this.queueFrames.push(e))}setDropped(e,t){e in this.mapFrames&&(this.mapFrames[e].isDropped=t)}setPartial(e,t){e in this.mapFrames&&(this.mapFrames[e].isPartial=t)}processPendingBeginFramesOnDrawFrame(e){const t=[];if(e in this.mapFrames){for(;this.queueFrames[0]!==e;){const e=this.queueFrames[0];this.mapFrames[e].isDropped&&t.push(this.mapFrames[e]),delete this.mapFrames[e],this.queueFrames.shift()}t.push(this.mapFrames[e]),delete this.mapFrames[e],this.queueFrames.shift()}return t}}var Tt=Object.freeze({__proto__:null,reset:function(){at=1,st.length=0},initialize:function(){if(1!==at)throw new Error("FramesHandler was not reset before being initialized");at=2},handleEvent:function(e){st.push(e)},finalize:async function(){if(2!==at)throw new Error("FramesHandler is not initialized");e.Trace.sortTraceEventsInPlace(st);const t=new ct(st,Ge(),h(),fe(),Se());ot=t},data:function(){return{frames:ot?Array.from(ot.frames()):[],framesById:ot?{...ot.framesById()}:{}}},deps:function(){return["Meta","Renderer","AuctionWorklets","LayerTree"]},TimelineFrameModel:ct,TimelineFrame:lt,LayerPaintEvent:mt,PendingFrame:ut,TimelineFrameBeginFrameQueue:gt,framesWithinWindow:function(e,t,r){const i=n.ArrayUtilities.lowerBound(e,t||0,((e,t)=>e-t.endTime)),a=n.ArrayUtilities.lowerBound(e,r||1/0,((e,t)=>e-t.startTime));return e.slice(i,a)}});let ht=1;const vt=new Map;let pt=[];var Et=Object.freeze({__proto__:null,reset:function(){vt.clear(),pt=[],ht=1},initialize:function(){if(1!==ht)throw new Error("GPU Handler was not reset before being initialized");ht=2},handleEvent:function(n){if(2!==ht)throw new Error("GPU Handler is not initialized");t.TraceEvents.isTraceEventGPUTask(n)&&e.Trace.addEventToProcessThread(n,vt)},finalize:async function(){if(2!==ht)throw new Error("GPU Handler is not initialized");const{gpuProcessId:e,gpuThreadId:t}=fe(),n=vt.get(e);n&&t&&(pt=n.get(t)||[]),ht=3},data:function(){if(3!==ht)throw new Error("GPU Handler is not finalized");return{mainGPUThreadTasks:pt}},deps:function(){return["Meta"]}});const wt=new Map,Mt=new Map,It=new Map,St=new Map;var yt=Object.freeze({__proto__:null,reset:function(){wt.clear(),Mt.clear(),It.clear(),St.clear()},handleEvent:function(e){if(t.TraceEvents.isTraceEventPaintImage(e)){const t=wt.get(e.pid)||new Map,n=t.get(e.tid)||[];return n.push(e),t.set(e.tid,n),void wt.set(e.pid,t)}if(t.TraceEvents.isTraceEventDecodeLazyPixelRef(e)&&void 0!==e.args?.LazyPixelRef){const t=Mt.get(e.pid)||new Map,n=t.get(e.tid)||[];n.push(e),t.set(e.tid,n),Mt.set(e.pid,t)}if(t.TraceEvents.isTraceEventDrawLazyPixelRef(e)&&void 0!==e.args?.LazyPixelRef){const t=wt.get(e.pid)?.get(e.tid)?.at(-1);if(!t)return;It.set(e.args.LazyPixelRef,t)}else if(t.TraceEvents.isTraceEventDecodeImage(e)){const t=wt.get(e.pid)?.get(e.tid)?.at(-1);if(t)return void St.set(e,t);const n=Mt.get(e.pid)?.get(e.tid)?.at(-1);if(!n||void 0===n.args?.LazyPixelRef)return;const r=It.get(n.args.LazyPixelRef);if(!r)return;St.set(e,r)}},data:function(){return{paintImageByDrawLazyPixelRef:It,paintImageForEvent:St}}});let Ft=1;const Pt=new Map,_t=new Map,Ct=new Map,Rt=[],kt=new Map,Lt=new Map,Dt=new Map,bt=new Map,Nt=new Map,zt=new Map,Wt=new Map;function xt(e){Lt.set(e.event,e.initiator);const t=Dt.get(e.initiator)||[];t.push(e.event),Dt.set(e.initiator,t)}var Ot=Object.freeze({__proto__:null,reset:function(){Pt.clear(),_t.clear(),Ct.clear(),Nt.clear(),Lt.clear(),Dt.clear(),bt.clear(),zt.clear(),Wt.clear(),kt.clear(),Rt.length=0,Ft=1},initialize:function(){if(1!==Ft)throw new Error("InitiatorsHandler was not reset before being initialized");Ft=2},handleEvent:function(n){if(t.TraceEvents.isTraceEventScheduleStyleRecalculation(n))Pt.set(n.args.data.frame,n);else if(t.TraceEvents.isTraceEventUpdateLayoutTree(n)){if(n.args.beginData){Ct.set(n.args.beginData.frame,n);const e=Pt.get(n.args.beginData.frame);e&&xt({event:n,initiator:e})}}else if(t.TraceEvents.isTraceEventInvalidateLayout(n)){let t=n;if(!_t.has(n.args.data.frame)){const r=Ct.get(n.args.data.frame);if(r){const{endTime:i}=e.Timing.eventTimingsMicroSeconds(r),a=Lt.get(r);a&&i&&i>n.ts&&(t=a)}}_t.set(n.args.data.frame,t)}else if(t.TraceEvents.isTraceEventLayout(n)){const e=_t.get(n.args.beginData.frame);e&&xt({event:n,initiator:e}),_t.delete(n.args.beginData.frame)}else if(t.TraceEvents.isTraceEventRequestAnimationFrame(n))bt.set(n.args.data.id,n);else if(t.TraceEvents.isTraceEventFireAnimationFrame(n)){const e=bt.get(n.args.data.id);e&&xt({event:n,initiator:e})}else if(t.TraceEvents.isTraceEventTimerInstall(n))Nt.set(n.args.data.timerId,n);else if(t.TraceEvents.isTraceEventTimerFire(n)){const e=Nt.get(n.args.data.timerId);e&&xt({event:n,initiator:e})}else if(t.TraceEvents.isTraceEventRequestIdleCallback(n))zt.set(n.args.data.id,n);else if(t.TraceEvents.isTraceEventFireIdleCallback(n)){const e=zt.get(n.args.data.id);e&&xt({event:n,initiator:e})}else if(t.TraceEvents.isTraceEventWebSocketCreate(n))Wt.set(n.args.data.identifier,n);else if(t.TraceEvents.isTraceEventWebSocketInfo(n)||t.TraceEvents.isTraceEventWebSocketTransfer(n)){const e=Wt.get(n.args.data.identifier);e&&xt({event:n,initiator:e})}else if(t.TraceEvents.isTraceEventHandlePostMessage(n))Rt.push(n);else if(t.TraceEvents.isTraceEventSchedulePostMessage(n)){const e=n.args.data?.traceId;e&&kt.set(e,n)}},finalize:async function(){if(2!==Ft)throw new Error("InitiatorsHandler is not initialized");!function(){for(const e of Rt){const t=e.args.data?.traceId,n=kt.get(t);n&&xt({event:e,initiator:n})}}(),Ft=3},data:function(){return{eventToInitiator:Lt,initiatorToEvents:Dt}}});let Bt=1;const Ut=new Map;let qt=null,Ht=!1;const At=[];function jt(e,t){const n=Ut.get(e)||[];n.push(t),Ut.set(e,n)}var Gt=Object.freeze({__proto__:null,reset:function(){Bt=1,Ut.clear(),qt=null,At.length=0,Ht=!1},initialize:function(){if(1!==Bt)throw new Error("InvalidationsHandler was not reset before being initialized");Bt=2},handleEvent:function(e){if(t.TraceEvents.isTraceEventUpdateLayoutTree(e)){qt=e;for(const n of At){if(t.TraceEvents.isTraceEventLayoutInvalidationTracking(n))continue;const r=qt.args.beginData?.frame;r&&n.args.data.frame===r&&jt(e,n)}}else if(t.TraceEvents.isTraceEventInvalidationTracking(e)){if(Ht&&(At.length=0,qt=null,Ht=!1),qt&&(t.TraceEvents.isTraceEventScheduleStyleInvalidationTracking(e)||t.TraceEvents.isTraceEventStyleRecalcInvalidationTracking(e)||t.TraceEvents.isTraceEventStyleInvalidatorInvalidationTracking(e))){const t=qt.ts+(qt.dur||0);e.ts>=qt.ts&&e.ts<=t&&qt.args.beginData?.frame===e.args.data.frame&&jt(qt,e)}At.push(e)}else if(t.TraceEvents.isTraceEventPaint(e))Ht=!0;else if(t.TraceEvents.isTraceEventLayout(e)){const n=e.args.beginData.frame;for(const r of At)t.TraceEvents.isTraceEventLayoutInvalidationTracking(r)&&r.args.data.frame===n&&jt(e,r)}},finalize:async function(){if(2!==Bt)throw new Error("InvalidationsHandler is not initialized");Bt=3},data:function(){return{invalidationsForEvent:Ut}}});const Vt=new Map;var $t=Object.freeze({__proto__:null,reset:function(){Vt.clear()},handleEvent:function(e){t.TraceEvents.isTraceEventLargestImagePaintCandidate(e)&&e.args.data&&Vt.set(e.args.data.DOMNodeId,e)},data:function(){return Vt}});const Xt=new Map;var Yt=Object.freeze({__proto__:null,reset:function(){Xt.clear()},handleEvent:function(e){t.TraceEvents.isTraceEventLargestTextPaintCandidate(e)&&e.args.data&&Xt.set(e.args.data.DOMNodeId,e)},data:function(){return Xt}});const Kt=e.Timing.millisecondsToMicroseconds(t.Timing.MilliSeconds(5e3)),Qt=e.Timing.millisecondsToMicroseconds(t.Timing.MilliSeconds(1e3)),Jt=[],Zt=[],en=[],tn=[],nn=[],rn=new Set,an=[];let sn=0,on=-1;const cn=[],dn=[];let ln=1;function mn(e){return{min:e,max:e,range:t.Timing.MicroSeconds(0)}}function un(e,n){e.max=n,e.range=t.Timing.MicroSeconds(e.max-e.min)}var fn=Object.freeze({__proto__:null,MAX_CLUSTER_DURATION:Kt,MAX_SHIFT_TIME_DELTA:Qt,initialize:function(){if(1!==ln)throw new Error("LayoutShifts Handler was not reset");ln=2},reset:function(){ln=1,Jt.length=0,Zt.length=0,en.length=0,tn.length=0,an.length=0,nn.length=0,rn.clear(),cn.length=0,sn=0,dn.length=0,on=-1},handleEvent:function(e){if(2!==ln)throw new Error("Handler is not initialized");!t.TraceEvents.isTraceEventLayoutShift(e)||e.args.data?.had_recent_input?t.TraceEvents.isTraceEventLayoutInvalidationTracking(e)?Zt.push(e):(t.TraceEvents.isTraceEventScheduleStyleInvalidationTracking(e)&&en.push(e),t.TraceEvents.isTraceEventStyleRecalcInvalidationTracking(e)&&tn.push(e),t.TraceEvents.isTraceEventPrePaint(e)?an.push(e):t.TraceEvents.isTraceEventRenderFrameImplCreateChildFrame(e)&&nn.push(e)):Jt.push(e)},finalize:async function(){Jt.sort(((e,t)=>e.ts-t.ts)),an.sort(((e,t)=>e.ts-t.ts)),Zt.sort(((e,t)=>e.ts-t.ts)),nn.sort(((e,t)=>e.ts-t.ts)),await async function(){const{navigationsByFrameId:r,mainFrameId:i,traceBounds:a}=fe(),s=r.get(i)||[];if(0===Jt.length)return;let o=Jt[0].ts,c=Jt[0].ts,d=null;for(const r of Jt){const i=r.ts-o>Kt,a=r.ts-c>Qt,l=n.ArrayUtilities.nearestIndexFromEnd(s,(e=>e.ts<r.ts)),m=d!==l&&null!==l;if(i||a||m||!cn.length){const e=r.ts,n=i?o+Kt:1/0,d=a?c+Qt:1/0,u=m?s[l].ts:1/0,f=Math.min(n,d,u);if(cn.length>0){un(cn[cn.length-1].clusterWindow,t.Timing.MicroSeconds(f))}const g=null===l?void 0:s[l].args.data?.navigationId;cn.push({events:[],clusterWindow:mn(e),clusterCumulativeScore:0,scoreWindows:{good:mn(e),needsImprovement:null,bad:null},navigationId:g}),o=e}const u=cn[cn.length-1],f=null!==l?t.Timing.MicroSeconds(r.ts-s[l].ts):void 0;if(u.clusterCumulativeScore+=r.args.data?r.args.data.weighted_score_delta:0,!r.args.data)continue;const g=e.SyntheticEvents.SyntheticEventsManager.registerSyntheticBasedEvent({rawSourceEvent:r,...r,args:{frame:r.args.frame,data:{...r.args.data,rawEvent:r}},parsedData:{timeFromNavigation:f,cumulativeWeightedScoreInWindow:u.clusterCumulativeScore,sessionWindowData:{cumulativeWindowScore:0,id:cn.length}}});u.events.push(g),un(u.clusterWindow,r.ts),c=r.ts,d=l}for(const e of cn){let r=0,i=-1;if(e===cn[cn.length-1]){const r=Kt+e.clusterWindow.min,i=e.clusterWindow.max+Qt,o=n.ArrayUtilities.nearestIndexFromBeginning(s,(t=>t.ts>e.clusterWindow.max)),c=o?s[o].ts:1/0,d=Math.min(r,i,a.max,c);un(e.clusterWindow,t.Timing.MicroSeconds(d))}for(const n of e.events){r+=n.args.data?n.args.data.weighted_score_delta:0,i=n.parsedData.sessionWindowData.id;const a=n.ts;n.parsedData.sessionWindowData.cumulativeWindowScore=e.clusterCumulativeScore,r<.1?un(e.scoreWindows.good,a):r>=.1&&r<.25?(e.scoreWindows.needsImprovement||(un(e.scoreWindows.good,t.Timing.MicroSeconds(a-1)),e.scoreWindows.needsImprovement=mn(a)),un(e.scoreWindows.needsImprovement,a)):r>=.25&&(e.scoreWindows.bad||(e.scoreWindows.needsImprovement?un(e.scoreWindows.needsImprovement,t.Timing.MicroSeconds(a-1)):un(e.scoreWindows.good,t.Timing.MicroSeconds(a-1)),e.scoreWindows.bad=mn(n.ts)),un(e.scoreWindows.bad,a)),e.scoreWindows.bad?un(e.scoreWindows.bad,e.clusterWindow.max):e.scoreWindows.needsImprovement?un(e.scoreWindows.needsImprovement,e.clusterWindow.max):un(e.scoreWindows.good,e.clusterWindow.max)}r>sn&&(on=i,sn=r)}}(),function(){const{traceBounds:e}=fe();dn.push({ts:e.min,score:0});for(const e of cn){let t=0;e.events[0].args.data&&dn.push({ts:e.clusterWindow.min,score:e.events[0].args.data.weighted_score_delta});for(let n=0;n<e.events.length;n++){const r=e.events[n];r.args.data&&(t+=r.args.data.weighted_score_delta,dn.push({ts:r.ts,score:t}))}dn.push({ts:e.clusterWindow.max,score:0})}}(),function(){rn.clear();for(const e of Jt)if(e.args.data?.impacted_nodes)for(const t of e.args.data.impacted_nodes)rn.add(t.node_id);for(const e of Zt)e.args.data?.nodeId&&rn.add(e.args.data.nodeId);for(const e of en)e.args.data?.nodeId&&rn.add(e.args.data.nodeId)}(),ln=3},data:function(){if(3!==ln)throw new Error("Layout Shifts Handler is not finalized");return{clusters:cn,sessionMaxScore:sn,clsWindowID:on,prePaintEvents:an,layoutInvalidationEvents:Zt,scheduleStyleInvalidationEvents:en,styleRecalcInvalidationEvents:[],renderFrameImplCreateChildFrameEvents:nn,scoreRecords:dn,backendNodeIds:[...rn]}},deps:function(){return["Screenshots","Meta"]},scoreClassificationForLayoutShift:function(e){let t="good";return e>=.1&&(t="ok"),e>=.25&&(t="bad"),t}});const gn=new Map;var Tn=Object.freeze({__proto__:null,reset:function(){gn.clear()},handleEvent:function(e){if(t.TraceEvents.isTraceEventUpdateCounters(e)){const t=n.MapUtilities.getWithDefault(gn,e.pid,(()=>[]));t.push(e),gn.set(e.pid,t)}},data:function(){return{updateCountersByProcess:gn}}});const hn=1e3,vn=1e6,pn=new Map,En=new Map,wn=new Map,Mn=[],In=new Map,Sn=new Map;function yn(e,t,n){En.has(e)||En.set(e,{});const r=En.get(e);if(!r)throw new Error(`Unable to locate trace events for request ID ${e}`);if(Array.isArray(r[t])){const e=n;r[t].push(...e)}else r[t]=n}function Fn(e){for(const t of e)if(t>0)return t;return 0}let Pn=1;var _n=Object.freeze({__proto__:null,reset:function(){wn.clear(),En.clear(),Mn.length=0,In.clear(),Sn.clear(),pn.clear(),Pn=1},initialize:function(){Pn=2},handleEvent:function(e){if(2!==Pn)throw new Error("Network Request handler is not initialized");if(t.TraceEvents.isTraceEventResourceChangePriority(e))yn(e.args.data.requestId,"changePriority",e);else if(t.TraceEvents.isTraceEventResourceWillSendRequest(e))yn(e.args.data.requestId,"willSendRequests",[e]);else if(t.TraceEvents.isTraceEventResourceSendRequest(e))yn(e.args.data.requestId,"sendRequests",[e]);else if(t.TraceEvents.isTraceEventResourceReceiveResponse(e))yn(e.args.data.requestId,"receiveResponse",e);else if(t.TraceEvents.isTraceEventResourceReceivedData(e))yn(e.args.data.requestId,"receivedData",[e]);else if(t.TraceEvents.isTraceEventResourceFinish(e))yn(e.args.data.requestId,"resourceFinish",e);else if(t.TraceEvents.isTraceEventResourceMarkAsCached(e))yn(e.args.data.requestId,"resourceMarkAsCached",e);else if(t.TraceEvents.isTraceEventWebSocketCreate(e)||t.TraceEvents.isTraceEventWebSocketInfo(e)||t.TraceEvents.isTraceEventWebSocketTransfer(e)){const t=e.args.data.identifier;pn.has(t)||(e.args.data.frame?pn.set(t,{frame:e.args.data.frame,webSocketIdentifier:t,events:[],syntheticConnectionEvent:null}):e.args.data.workerId&&pn.set(t,{workerId:e.args.data.workerId,webSocketIdentifier:t,events:[],syntheticConnectionEvent:null})),pn.get(t)?.events.push(e)}},finalize:async function(){if(2!==Pn)throw new Error("Network Request handler is not initialized");const{rendererProcessesByFrame:r}=fe();for(const[i,a]of En.entries()){if(!a.sendRequests||!a.receiveResponse)continue;const s=[];for(let e=0;e<a.sendRequests.length-1;e++){const n=a.sendRequests[e],r=a.sendRequests[e+1];let i=n.ts,o=t.Timing.MicroSeconds(r.ts-n.ts);if(a.willSendRequests&&a.willSendRequests[e]&&a.willSendRequests[e+1]){const n=a.willSendRequests[e],r=a.willSendRequests[e+1];i=n.ts,o=t.Timing.MicroSeconds(r.ts-n.ts)}s.push({url:n.args.data.url,priority:n.args.data.priority,requestMethod:n.args.data.requestMethod,ts:i,dur:o})}const o=0!==a.resourceFinish?.args.data.encodedDataLength,c=a.receiveResponse.args.data.fromCache&&!a.receiveResponse.args.data.fromServiceWorker&&!o,d=void 0!==a.resourceMarkAsCached,l=d||c,m=a.receiveResponse.args.data.timing;if(!m&&!l)continue;const u=a.sendRequests[0],f=a.sendRequests[a.sendRequests.length-1],g=f.args.data.priority;let T=g;a.changePriority&&(T=a.changePriority.args.data.priority);const h=a.willSendRequests&&a.willSendRequests.length?t.Timing.MicroSeconds(a.willSendRequests[0].ts):t.Timing.MicroSeconds(u.ts),v=a.willSendRequests&&a.willSendRequests.length?t.Timing.MicroSeconds(a.willSendRequests[a.willSendRequests.length-1].ts):t.Timing.MicroSeconds(f.ts),p=a.resourceFinish?a.resourceFinish.ts:v,E=a.resourceFinish?.args.data.finishTime?t.Timing.MicroSeconds(a.resourceFinish.args.data.finishTime*vn):t.Timing.MicroSeconds(p),w=l?t.Timing.MicroSeconds(0):t.Timing.MicroSeconds((E||v)-v),M=t.Timing.MicroSeconds(p-(E||p)),I=t.Timing.MicroSeconds(v-h),S=l?t.Timing.MicroSeconds(0):t.Timing.MicroSeconds(n.NumberUtilities.clamp(m.requestTime*vn-v,0,Number.MAX_VALUE)),y=l?t.Timing.MicroSeconds(a.receiveResponse.ts-h):t.Timing.MicroSeconds(Fn([m.dnsStart*hn,m.connectStart*hn,m.sendStart*hn,a.receiveResponse.ts-v])),F=l?h:t.Timing.MicroSeconds(m.requestTime*vn+m.sendStart*hn),P=l?t.Timing.MicroSeconds(0):t.Timing.MicroSeconds((m.receiveHeadersEnd-m.sendEnd)*hn),_=l?h:t.Timing.MicroSeconds(m.requestTime*vn+m.receiveHeadersEnd*hn),C=l?t.Timing.MicroSeconds(p-a.receiveResponse.ts):t.Timing.MicroSeconds((E||_)-_),R=t.Timing.MicroSeconds(w+M),k=l?t.Timing.MicroSeconds(0):t.Timing.MicroSeconds((m.dnsEnd-m.dnsStart)*hn),L=l?t.Timing.MicroSeconds(0):t.Timing.MicroSeconds((m.sslEnd-m.sslStart)*hn),D=l?t.Timing.MicroSeconds(0):t.Timing.MicroSeconds((m.proxyEnd-m.proxyStart)*hn),b=l?t.Timing.MicroSeconds(0):t.Timing.MicroSeconds((m.sendEnd-m.sendStart)*hn),N=l?t.Timing.MicroSeconds(0):t.Timing.MicroSeconds((m.connectEnd-m.connectStart)*hn),{frame:z,url:W,renderBlocking:x}=f.args.data,{encodedDataLength:O,decodedBodyLength:B}=a.resourceFinish?a.resourceFinish.args.data:{encodedDataLength:0,decodedBodyLength:0},U=new URL(W),q="https:"===U.protocol,H=e.Trace.activeURLForFrameAtTime(z,f.ts,r)||"",A=e.SyntheticEvents.SyntheticEventsManager.registerSyntheticBasedEvent({rawSourceEvent:f,args:{data:{syntheticData:{dnsLookup:k,download:C,downloadStart:_,finishTime:E,initialConnection:N,isDiskCached:c,isHttps:q,isMemoryCached:d,isPushedResource:o,networkDuration:w,processingDuration:M,proxyNegotiation:D,queueing:S,redirectionDuration:I,requestSent:b,sendStartTime:F,ssl:L,stalled:y,totalTime:R,waiting:P},decodedBodyLength:B,encodedDataLength:O,frame:z,fromServiceWorker:a.receiveResponse.args.data.fromServiceWorker,isLinkPreload:f.args.data.isLinkPreload||!1,mimeType:a.receiveResponse.args.data.mimeType,priority:T,initialPriority:g,protocol:a.receiveResponse.args.data.protocol??"unknown",redirects:s,renderBlocking:x??"non_blocking",requestId:i,requestingFrameUrl:H,requestMethod:f.args.data.requestMethod,resourceType:f.args.data.resourceType,statusCode:a.receiveResponse.args.data.statusCode,responseHeaders:a.receiveResponse.args.data.headers||[],fetchPriorityHint:f.args.data.fetchPriorityHint,initiator:f.args.data.initiator,stackTrace:f.args.data.stackTrace,timing:m,url:W,failed:a.resourceFinish?.args.data.didFail??!1,finished:Boolean(a.resourceFinish),connectionId:a.receiveResponse.args.data.connectionId,connectionReused:a.receiveResponse.args.data.connectionReused}},cat:"loading",name:"SyntheticNetworkRequest",ph:"X",dur:t.Timing.MicroSeconds(p-h),tdur:t.Timing.MicroSeconds(p-h),ts:t.Timing.MicroSeconds(h),tts:t.Timing.MicroSeconds(h),pid:f.pid,tid:f.tid}),j=n.MapUtilities.getWithDefault(wn,U.host,(()=>({renderBlocking:[],nonRenderBlocking:[],all:[]})));e.Network.isSyntheticNetworkRequestEventRenderBlocking(A)?j.renderBlocking.push(A):j.nonRenderBlocking.push(A),j.all.push(A),Mn.push(A);const G=A.args.data.initiator?.url||e.Trace.getZeroIndexedStackTraceForEvent(A)?.at(0)?.url;if(G){const e=In.get(G)??[];e.push(A),In.set(G,e)}}for(const e of Mn){const t=In.get(e.args.data.url);if(t)for(const n of t)Sn.set(n,e)}pn.forEach((e=>{let n=null,r=null;for(const i of e.events)t.TraceEvents.isTraceEventWebSocketCreate(i)&&(n=i),t.TraceEvents.isTraceEventWebSocketDestroy(i)&&(r=i);e.syntheticConnectionEvent=function(e,t,n){const{traceBounds:r}=fe(),i=e?e.ts:r.min,a=t?t.ts:r.max,s=a-i,o=e||t||n;return{name:"SyntheticWebSocketConnectionEvent",cat:o.cat,ph:"X",ts:i,dur:s,pid:o.pid,tid:o.tid,s:o.s,rawSourceEvent:o,_tag:"SyntheticEntryTag",args:{data:{identifier:o.args.data.identifier,priority:"Low",url:o.args.data.url||""}}}}(n,r,e.events[0])})),Pn=3},data:function(){if(3!==Pn)throw new Error("Network Request handler is not finalized");return{byOrigin:wn,byTime:Mn,eventToInitiator:Sn,webSocket:[...pn.values()]}},deps:function(){return["Meta"]}});const Cn=new Map;var Rn=Object.freeze({__proto__:null,reset:function(){Cn.clear()},handleEvent:function(e){if(t.TraceEvents.isTraceEventTracingStartedInBrowser(e))for(const t of e.args.data?.frames??[])Cn.set(t.frame,t);else if(t.TraceEvents.isTraceEventCommitLoad(e)){const t=e.args.data;if(!t)return;const n=Cn.get(t.frame);if(!n)return;Cn.set(t.frame,{...n,url:t.url||n.url,name:t.name||t.name})}},data:function(){return{frames:Cn}}});const kn=new Map;let Ln=[];let Dn=[];const bn=new Set;function Nn(r,i){const a=r.args.data?.navigationId;if(!a)throw new Error("Navigation event unexpectedly had no navigation ID.");const s=Wn(i),{rendererProcessesByFrame:o}=fe(),c=o.get(s);if(!c)return;if(c.get(i.pid)&&!t.TraceEvents.isTraceEventNavigationStart(i))if(t.TraceEvents.isTraceEventFirstContentfulPaint(i)){const e=t.Timing.MicroSeconds(i.ts-r.ts);zn(s,a,{event:i,metricName:"FCP",classification:On(e),navigation:r,timing:e})}else if(t.TraceEvents.isTraceEventFirstPaint(i)){zn(s,a,{event:i,metricName:"FP",classification:"unclassified",navigation:r,timing:t.Timing.MicroSeconds(i.ts-r.ts)})}else if(t.TraceEvents.isTraceEventMarkDOMContent(i)){const e=t.Timing.MicroSeconds(i.ts-r.ts);zn(s,a,{event:i,metricName:"DCL",classification:"unclassified",navigation:r,timing:e})}else if(t.TraceEvents.isTraceEventInteractiveTime(i)){const n=t.Timing.MicroSeconds(i.ts-r.ts);zn(s,a,{event:i,metricName:"TTI",classification:Bn(n),navigation:r,timing:n});const o=e.Timing.millisecondsToMicroseconds(t.Timing.MilliSeconds(i.args.args.total_blocking_time_ms));zn(s,a,{event:i,metricName:"TBT",classification:Hn(o),navigation:r,timing:o})}else if(t.TraceEvents.isTraceEventMarkLoad(i)){zn(s,a,{event:i,metricName:"L",classification:"unclassified",navigation:r,timing:t.Timing.MicroSeconds(i.ts-r.ts)})}else if(t.TraceEvents.isTraceEventLargestContentfulPaintCandidate(i)){const e=i.args.data?.candidateIndex;if(!e)throw new Error("Largest Contenful Paint unexpectedly had no candidateIndex.");const o=t.Timing.MicroSeconds(i.ts-r.ts),c={event:i,metricName:"LCP",classification:Un(o),navigation:r,timing:o},d=n.MapUtilities.getWithDefault(kn,s,(()=>new Map)),l=n.MapUtilities.getWithDefault(d,a,(()=>new Map)).get("LCP");if(void 0===l)return bn.add(c.event),void zn(s,a,c);const m=l.event;if(!t.TraceEvents.isTraceEventLargestContentfulPaintCandidate(m))return;const u=m.args.data?.candidateIndex;if(!u)return;u<e&&(bn.delete(m),bn.add(c.event),zn(s,a,c))}else if(!t.TraceEvents.isTraceEventLayoutShift(i))return n.assertNever(i,`Unexpected event type: ${i}`)}function zn(e,t,r){const i=n.MapUtilities.getWithDefault(kn,e,(()=>new Map)),a=n.MapUtilities.getWithDefault(i,t,(()=>new Map));a.delete(r.metricName),a.set(r.metricName,r)}function Wn(e){if(t.TraceEvents.isTraceEventFirstContentfulPaint(e)||t.TraceEvents.isTraceEventInteractiveTime(e)||t.TraceEvents.isTraceEventLargestContentfulPaintCandidate(e)||t.TraceEvents.isTraceEventNavigationStart(e)||t.TraceEvents.isTraceEventLayoutShift(e)||t.TraceEvents.isTraceEventFirstPaint(e))return e.args.frame;if(t.TraceEvents.isTraceEventMarkDOMContent(e)||t.TraceEvents.isTraceEventMarkLoad(e)){const t=e.args.data?.frame;if(!t)throw new Error("MarkDOMContent unexpectedly had no frame ID.");return t}n.assertNever(e,`Unexpected event type: ${e}`)}function xn(r){if(t.TraceEvents.isTraceEventFirstContentfulPaint(r)||t.TraceEvents.isTraceEventLargestContentfulPaintCandidate(r)||t.TraceEvents.isTraceEventFirstPaint(r)){const e=r.args.data?.navigationId;if(!e)throw new Error("Trace event unexpectedly had no navigation ID.");const{navigationsByNavigationId:t}=fe(),n=t.get(e);return n||null}if(t.TraceEvents.isTraceEventMarkDOMContent(r)||t.TraceEvents.isTraceEventInteractiveTime(r)||t.TraceEvents.isTraceEventLayoutShift(r)||t.TraceEvents.isTraceEventMarkLoad(r)){const t=Wn(r),{navigationsByFrameId:n}=fe();return e.Trace.getNavigationForTraceEvent(r,t,n)}return t.TraceEvents.isTraceEventNavigationStart(r)?null:n.assertNever(r,`Unexpected event type: ${r}`)}function On(n){const r=e.Timing.secondsToMicroseconds(t.Timing.Seconds(1.8));let i="bad";return n<=e.Timing.secondsToMicroseconds(t.Timing.Seconds(3))&&(i="ok"),n<=r&&(i="good"),i}function Bn(n){const r=e.Timing.secondsToMicroseconds(t.Timing.Seconds(3.8));let i="bad";return n<=e.Timing.secondsToMicroseconds(t.Timing.Seconds(7.3))&&(i="ok"),n<=r&&(i="good"),i}function Un(n){const r=e.Timing.secondsToMicroseconds(t.Timing.Seconds(2.5));let i="bad";return n<=e.Timing.secondsToMicroseconds(t.Timing.Seconds(4))&&(i="ok"),n<=r&&(i="good"),i}function qn(e){return"unclassified"}function Hn(n){const r=e.Timing.millisecondsToMicroseconds(t.Timing.MilliSeconds(200));let i="bad";return n<=e.Timing.millisecondsToMicroseconds(t.Timing.MilliSeconds(600))&&(i="ok"),n<=r&&(i="good"),i}var An=Object.freeze({__proto__:null,reset:function(){kn.clear(),Dn=[],Ln=[],bn.clear()},handleEvent:function(e){t.TraceEvents.eventIsPageLoadEvent(e)&&Dn.push(e)},getFrameIdForPageLoadEvent:Wn,scoreClassificationForFirstContentfulPaint:On,scoreClassificationForTimeToInteractive:Bn,scoreClassificationForLargestContentfulPaint:Un,scoreClassificationForDOMContentLoaded:qn,scoreClassificationForTotalBlockingTime:Hn,finalize:async function(){Dn.sort(((e,t)=>e.ts-t.ts));for(const e of Dn){const t=xn(e);t&&Nn(t,e)}const e=function(){const e=[],t=[...kn.values()].flatMap((e=>[...e.values()]));for(let n=0;n<t.length;n++){const r=t[n].get("LCP");r&&r.event&&e.push(r.event)}return e}(),n=fe().mainFrameId,r=[...e,...Dn.filter((e=>!t.TraceEvents.isTraceEventLargestContentfulPaintCandidate(e)))].filter(t.TraceEvents.isTraceEventMarkerEvent);Ln=r.filter((e=>Wn(e)===n)).sort(((e,t)=>e.ts-t.ts))},data:function(){return{metricScoresByFrameId:kn,allMarkerEvents:Ln}},deps:function(){return["Meta"]}});const jn=[],Gn=[],Vn=[];let $n={};function Xn(e){const t=parseInt(e.id,16);if(1===t)return e.ts;return $n[t]??e.ts}var Yn=Object.freeze({__proto__:null,reset:function(){jn.length=0,Gn.length=0,Vn.length=0,$n={}},handleEvent:function(e){t.TraceEvents.isTraceEventScreenshot(e)?Gn.push(e):t.TraceEvents.isTraceEventPipelineReporter(e)&&jn.push(e)},finalize:async function(){const n=e.Trace.createMatchedSortedSyntheticEvents(jn);$n=Object.fromEntries(n.map((e=>[e.args.data.beginEvent.args.chrome_frame_reporter.frame_sequence,t.Timing.MicroSeconds(e.ts+e.dur)])));for(const t of Gn){const{cat:n,name:r,ph:i,pid:a,tid:s}=t,o=e.SyntheticEvents.SyntheticEventsManager.registerSyntheticBasedEvent({rawSourceEvent:t,cat:n,name:r,ph:i,pid:a,tid:s,ts:Xn(t),args:{dataUri:`data:image/jpg;base64,${t.args.snapshot}`}});Vn.push(o)}},data:function(){return Vn},deps:function(){return["Meta"]}});let Kn=null;const Qn=new Map;var Jn=Object.freeze({__proto__:null,reset:function(){Kn=null,Qn.clear()},handleEvent:function(e){t.TraceEvents.isTraceEventSelectorStats(e)&&Kn&&e.args.selector_stats?Qn.set(Kn,{timings:e.args.selector_stats.selector_timings}):t.TraceEvents.isTraceEventUpdateLayoutTree(e)&&(Kn=e)},data:function(){return{dataForUpdateLayoutEvent:Qn}}});const Zn=[],er=[],tr=e.Timing.millisecondsToMicroseconds(t.Timing.MilliSeconds(200)),nr=tr,rr=e.Timing.millisecondsToMicroseconds(t.Timing.MilliSeconds(500));let ir=null;const ar=[],sr=[],or=new Map,cr=[];let dr=1;const lr=new Set(["pointerdown","touchstart","pointerup","touchend","mousedown","mouseup","click"]),mr=new Set(["keydown","keypress","keyup"]);function ur(e){return lr.has(e.type)?"POINTER":mr.has(e.type)?"KEYBOARD":"OTHER"}function fr(e){const n={POINTER:new Map,KEYBOARD:new Map,OTHER:new Map};function r(e){const r=ur(e),i=n[r],a=t.Timing.MicroSeconds(e.ts+e.dur),s=i.get(a);if(s){if(e.ts<s.ts)i.set(a,e);else if(e.ts===s.ts&&e.interactionId===s.interactionId){const t=s.processingEnd-s.processingStart;e.processingEnd-e.processingStart>t&&i.set(a,e)}e.processingStart<s.processingStart&&(s.processingStart=e.processingStart,gr(s)),e.processingEnd>s.processingEnd&&(s.processingEnd=e.processingEnd,gr(s))}else i.set(a,e)}for(const t of e)r(t);const i=Object.values(n).flatMap((e=>Array.from(e.values())));return i.sort(((e,t)=>e.ts-t.ts)),i}function gr(e){const n=e.args.data.beginEvent,r=e.args.data.endEvent;e.inputDelay=t.Timing.MicroSeconds(e.processingStart-n.ts),e.mainThreadHandling=t.Timing.MicroSeconds(e.processingEnd-e.processingStart),e.presentationDelay=t.Timing.MicroSeconds(r.ts-e.processingEnd)}function Tr(){return{allEvents:Zn,beginCommitCompositorFrameEvents:er,interactionEvents:ar,interactionEventsWithNoNesting:sr,longestInteractionEvent:ir,interactionsOverThreshold:new Set(ar.filter((e=>e.dur>tr)))}}var hr=Object.freeze({__proto__:null,LONG_INTERACTION_THRESHOLD:tr,reset:function(){Zn.length=0,er.length=0,ar.length=0,cr.length=0,or.clear(),sr.length=0,ir=null,dr=2},handleEvent:function(e){if(2!==dr)throw new Error("Handler is not initialized");if(t.TraceEvents.isTraceEventBeginCommitCompositorFrame(e))return void er.push(e);if(!t.TraceEvents.isTraceEventEventTiming(e))return;if(t.TraceEvents.isTraceEventEventTimingEnd(e)&&or.set(e.id,e),Zn.push(e),!e.args.data||!t.TraceEvents.isTraceEventEventTimingStart(e))return;const{duration:n,interactionId:r}=e.args.data;n<1||void 0===r||0===r||cr.push(e)},categoryOfInteraction:ur,removeNestedInteractions:fr,finalize:async function(){const{navigationsByFrameId:n}=fe();for(const r of cr){const i=or.get(r.id);if(!i)continue;if(!r.args.data?.type||!r.args.data?.interactionId)continue;const a=t.Timing.MicroSeconds(e.Timing.millisecondsToMicroseconds(r.args.data.processingStart)-e.Timing.millisecondsToMicroseconds(r.args.data.timeStamp)+r.ts),s=t.Timing.MicroSeconds(e.Timing.millisecondsToMicroseconds(r.args.data.processingEnd)-e.Timing.millisecondsToMicroseconds(r.args.data.timeStamp)+r.ts),o=r.args.frame??r.args.data.frame,c=e.Trace.getNavigationForTraceEvent(r,o,n),d=c?.args.data?.navigationId,l=e.SyntheticEvents.SyntheticEventsManager.registerSyntheticBasedEvent({rawSourceEvent:r,cat:r.cat,name:r.name,pid:r.pid,tid:r.tid,ph:r.ph,processingStart:a,processingEnd:s,inputDelay:t.Timing.MicroSeconds(-1),mainThreadHandling:t.Timing.MicroSeconds(-1),presentationDelay:t.Timing.MicroSeconds(-1),args:{data:{beginEvent:r,endEvent:i,frame:o,navigationId:d}},ts:r.ts,dur:t.Timing.MicroSeconds(i.ts-r.ts),type:r.args.data.type,interactionId:r.args.data.interactionId});gr(l),ar.push(l)}dr=3,sr.push(...fr(ar));for(const e of sr)(!ir||ir.dur<e.dur)&&(ir=e)},data:Tr,deps:function(){return["Meta"]},scoreClassificationForInteractionToNextPaint:function(e){return e<=nr?"good":e<=rr?"ok":"bad"}});const vr=new Map,pr=new Map,Er=[],wr=[],Mr=[],Ir=e.Timing.millisecondsToMicroseconds(t.Timing.MilliSeconds(30)),Sr=e.Timing.millisecondsToMicroseconds(t.Timing.MilliSeconds(50));function yr(e,t){const r=n.MapUtilities.getWithDefault(vr,e,(()=>[]));r.push(t),vr.set(e,r);const i=n.MapUtilities.getWithDefault(pr,t,(()=>[]));i.push(e),pr.set(t,i)}function Fr(e,t,n=!0){let r=t.at(-1);for(;r&&e.ts>r.ts+(r.dur||0);)t.pop(),r=t.at(-1);n&&t.push(e)}var Pr=Object.freeze({__proto__:null,FORCED_REFLOW_THRESHOLD:Ir,LONG_MAIN_THREAD_TASK_THRESHOLD:Sr,reset:function(){vr.clear(),pr.clear(),Er.length=0,wr.length=0,Mr.length=0},handleEvent:function(n){if(function(e){if(Fr(e,Er),Fr(e,wr,t.TraceEvents.isJSInvocationEvent(e)),wr.length&&("Layout"===e.name||"UpdateLayoutTree"===e.name))return void Mr.push(e);if(1===Er.length){const e=Mr.reduce(((e,t)=>e+(t.dur||0)),0);e>=Ir&&Mr.forEach((e=>yr(e,"FORCED_REFLOW"))),Mr.length=0}}(n),"RunTask"!==n.name)if(t.TraceEvents.isTraceEventFireIdleCallback(n)){const{duration:t}=e.Timing.eventTimingsMilliSeconds(n);t>n.args.data.allottedMilliseconds&&yr(n,"IDLE_CALLBACK_OVER_TIME")}else;else{const{duration:t}=e.Timing.eventTimingsMicroSeconds(n);t>Sr&&yr(n,"LONG_TASK")}},deps:function(){return["UserInteractions"]},finalize:async function(){const e=Tr().interactionsOverThreshold;for(const t of e)yr(t,"LONG_INTERACTION")},data:function(){return{perEvent:vr,perWarning:pr}}});let _r=1;const Cr=[],Rr=new Map,kr=new Map;var Lr=Object.freeze({__proto__:null,initialize:function(){if(1!==_r)throw new Error("Workers Handler was not reset");_r=2},reset:function(){Cr.length=0,Rr.clear(),kr.clear(),_r=1},handleEvent:function(e){if(2!==_r)throw new Error("Workers Handler is not initialized");t.TraceEvents.isTraceEventTracingSessionIdForWorker(e)&&Cr.push(e)},finalize:async function(){if(2!==_r)throw new Error("Handler is not initialized");for(const e of Cr)e.args.data&&(Rr.set(e.args.data.workerThreadId,e.args.data.workerId),kr.set(e.args.data.workerId,e.args.data.url));_r=3},data:function(){if(3!==_r)throw new Error("Workers Handler is not finalized");return{workerSessionIdEvents:Cr,workerIdByThread:Rr,workerURLById:kr}}}),Dr=Object.freeze({__proto__:null,Animations:c,AuctionWorklets:v,EnhancedTraces:_,ExtensionTraceData:j,Frames:Tt,GPU:Et,ImagePainting:yt,Initiators:Ot,Invalidations:Gt,LargestImagePaint:$t,LargestTextPaint:Yt,LayerTree:ye,LayoutShifts:fn,Memory:Tn,Meta:ge,NetworkRequests:_n,PageFrames:Rn,PageLoadMetrics:An,Renderer:tt,Samples:De,Screenshots:Yn,SelectorStats:Jn,UserInteractions:hr,UserTimings:x,Warnings:Pr,Workers:Lr}),br=Object.freeze({__proto__:null});export{Dr as ModelHandlers,it as Threads,br as Types};
>>>>>>> 2c830f7d0232ead70791aff6968a0e95ce850767
