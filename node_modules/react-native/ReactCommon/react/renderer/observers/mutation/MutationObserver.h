/*
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */

#pragma once

#include <react/renderer/components/root/RootShadowNode.h>
#include <react/renderer/core/ShadowNode.h>
<<<<<<< HEAD
#include <react/renderer/core/ShadowNodeFamily.h>
=======
#include <memory>
#include <utility>
>>>>>>> 2c830f7d0232ead70791aff6968a0e95ce850767

namespace facebook::react {

using MutationObserverId = int32_t;

struct MutationRecord {
  MutationObserverId mutationObserverId;
<<<<<<< HEAD
  std::shared_ptr<const ShadowNode> targetShadowNode;
  std::vector<std::shared_ptr<const ShadowNode>> addedShadowNodes;
  std::vector<std::shared_ptr<const ShadowNode>> removedShadowNodes;
=======
  ShadowNode::Shared targetShadowNode;
  std::vector<ShadowNode::Shared> addedShadowNodes;
  std::vector<ShadowNode::Shared> removedShadowNodes;
>>>>>>> 2c830f7d0232ead70791aff6968a0e95ce850767
};

class MutationObserver {
 public:
<<<<<<< HEAD
  explicit MutationObserver(MutationObserverId mutationObserverId);
=======
  MutationObserver(MutationObserverId intersectionObserverId);
>>>>>>> 2c830f7d0232ead70791aff6968a0e95ce850767

  // delete copy constructor
  MutationObserver(const MutationObserver&) = delete;

  // delete copy assignment
  MutationObserver& operator=(const MutationObserver&) = delete;

  // allow move constructor
  MutationObserver(MutationObserver&&) = default;

  // allow move assignment
  MutationObserver& operator=(MutationObserver&&) = default;

<<<<<<< HEAD
  void observe(
      std::shared_ptr<const ShadowNodeFamily> targetShadowNodeFamily,
      bool observeSubtree);
=======
  void observe(ShadowNode::Shared targetShadowNode, bool observeSubtree);
  void unobserve(const ShadowNode& targetShadowNode);

  bool isObserving() const;
>>>>>>> 2c830f7d0232ead70791aff6968a0e95ce850767

  void recordMutations(
      const RootShadowNode& oldRootShadowNode,
      const RootShadowNode& newRootShadowNode,
      std::vector<MutationRecord>& recordedMutations) const;

 private:
  MutationObserverId mutationObserverId_;
<<<<<<< HEAD
  std::vector<std::shared_ptr<const ShadowNodeFamily>>
      deeplyObservedShadowNodeFamilies_;
  std::vector<std::shared_ptr<const ShadowNodeFamily>>
      shallowlyObservedShadowNodeFamilies_;
=======
  std::vector<ShadowNode::Shared> deeplyObservedShadowNodes_;
  std::vector<ShadowNode::Shared> shallowlyObservedShadowNodes_;
>>>>>>> 2c830f7d0232ead70791aff6968a0e95ce850767

  using SetOfShadowNodePointers = std::unordered_set<const ShadowNode*>;

  void recordMutationsInTarget(
<<<<<<< HEAD
      const ShadowNodeFamily& targetShadowNodeFamily,
=======
      ShadowNode::Shared targetShadowNode,
>>>>>>> 2c830f7d0232ead70791aff6968a0e95ce850767
      const RootShadowNode& oldRootShadowNode,
      const RootShadowNode& newRootShadowNode,
      bool observeSubtree,
      std::vector<MutationRecord>& recordedMutations,
      SetOfShadowNodePointers& processedNodes) const;

  void recordMutationsInSubtrees(
<<<<<<< HEAD
      const std::shared_ptr<const ShadowNode>& oldNode,
      const std::shared_ptr<const ShadowNode>& newNode,
=======
      const ShadowNode::Shared& oldNode,
      const ShadowNode::Shared& newNode,
>>>>>>> 2c830f7d0232ead70791aff6968a0e95ce850767
      bool observeSubtree,
      std::vector<MutationRecord>& recordedMutations,
      SetOfShadowNodePointers& processedNodes) const;
};

} // namespace facebook::react
