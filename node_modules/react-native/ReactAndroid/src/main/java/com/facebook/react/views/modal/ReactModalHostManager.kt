/*
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */

package com.facebook.react.views.modal

import android.content.DialogInterface.OnShowListener
import com.facebook.react.bridge.ReadableArray
import com.facebook.react.module.annotations.ReactModule
import com.facebook.react.uimanager.ReactStylesDiffMap
import com.facebook.react.uimanager.StateWrapper
import com.facebook.react.uimanager.ThemedReactContext
import com.facebook.react.uimanager.UIManagerHelper
import com.facebook.react.uimanager.ViewGroupManager
import com.facebook.react.uimanager.ViewManagerDelegate
import com.facebook.react.uimanager.annotations.ReactProp
import com.facebook.react.viewmanagers.ModalHostViewManagerDelegate
import com.facebook.react.viewmanagers.ModalHostViewManagerInterface
import com.facebook.react.views.modal.ReactModalHostView.OnRequestCloseListener

/** View manager for [ReactModalHostView] components. */
@ReactModule(name = ReactModalHostManager.REACT_CLASS)
<<<<<<< HEAD
internal class ReactModalHostManager :
    ViewGroupManager<ReactModalHostView>(), ModalHostViewManagerInterface<ReactModalHostView> {
  private val delegate: ViewManagerDelegate<ReactModalHostView> = ModalHostViewManagerDelegate(this)

  override fun getName(): String = REACT_CLASS

  override fun createViewInstance(reactContext: ThemedReactContext): ReactModalHostView =
      ReactModalHostView(reactContext)

  override fun onDropViewInstance(view: ReactModalHostView) {
=======
public class ReactModalHostManager :
    ViewGroupManager<ReactModalHostView>(), ModalHostViewManagerInterface<ReactModalHostView> {
  private val delegate: ViewManagerDelegate<ReactModalHostView> = ModalHostViewManagerDelegate(this)

  public override fun getName(): String = REACT_CLASS

  protected override fun createViewInstance(reactContext: ThemedReactContext): ReactModalHostView =
      ReactModalHostView(reactContext)

  public override fun onDropViewInstance(view: ReactModalHostView) {
>>>>>>> 2c830f7d0232ead70791aff6968a0e95ce850767
    super.onDropViewInstance(view)
    view.onDropInstance()
  }

  @ReactProp(name = "animationType")
<<<<<<< HEAD
  override fun setAnimationType(view: ReactModalHostView, animationType: String?) {
=======
  public override fun setAnimationType(view: ReactModalHostView, animationType: String?) {
>>>>>>> 2c830f7d0232ead70791aff6968a0e95ce850767
    if (animationType != null) {
      view.animationType = animationType
    }
  }

  @ReactProp(name = "transparent")
<<<<<<< HEAD
  override fun setTransparent(view: ReactModalHostView, transparent: Boolean) {
=======
  public override fun setTransparent(view: ReactModalHostView, transparent: Boolean) {
>>>>>>> 2c830f7d0232ead70791aff6968a0e95ce850767
    view.transparent = transparent
  }

  @ReactProp(name = "statusBarTranslucent")
<<<<<<< HEAD
  override fun setStatusBarTranslucent(view: ReactModalHostView, statusBarTranslucent: Boolean) {
=======
  public override fun setStatusBarTranslucent(
      view: ReactModalHostView,
      statusBarTranslucent: Boolean
  ) {
>>>>>>> 2c830f7d0232ead70791aff6968a0e95ce850767
    view.statusBarTranslucent = statusBarTranslucent
  }

  @ReactProp(name = "navigationBarTranslucent")
<<<<<<< HEAD
  override fun setNavigationBarTranslucent(
=======
  public override fun setNavigationBarTranslucent(
>>>>>>> 2c830f7d0232ead70791aff6968a0e95ce850767
      view: ReactModalHostView,
      navigationBarTranslucent: Boolean
  ) {
    view.navigationBarTranslucent = navigationBarTranslucent
  }

  @ReactProp(name = "hardwareAccelerated")
<<<<<<< HEAD
  override fun setHardwareAccelerated(view: ReactModalHostView, hardwareAccelerated: Boolean) {
=======
  public override fun setHardwareAccelerated(
      view: ReactModalHostView,
      hardwareAccelerated: Boolean
  ) {
>>>>>>> 2c830f7d0232ead70791aff6968a0e95ce850767
    view.hardwareAccelerated = hardwareAccelerated
  }

  @ReactProp(name = "visible")
<<<<<<< HEAD
  override fun setVisible(view: ReactModalHostView, visible: Boolean) {
=======
  public override fun setVisible(view: ReactModalHostView, visible: Boolean) {
>>>>>>> 2c830f7d0232ead70791aff6968a0e95ce850767
    // iOS only
  }

  @ReactProp(name = "presentationStyle")
<<<<<<< HEAD
  override fun setPresentationStyle(view: ReactModalHostView, value: String?): Unit = Unit

  @ReactProp(name = "animated")
  override fun setAnimated(view: ReactModalHostView, value: Boolean): Unit = Unit

  @ReactProp(name = "supportedOrientations")
  override fun setSupportedOrientations(view: ReactModalHostView, value: ReadableArray?): Unit =
      Unit

  @ReactProp(name = "identifier")
  override fun setIdentifier(view: ReactModalHostView, value: Int): Unit = Unit

  @ReactProp(name = "allowSwipeDismissal")
  override fun setAllowSwipeDismissal(view: ReactModalHostView, value: Boolean): Unit = Unit

  override fun setTestId(view: ReactModalHostView, value: String?) {
=======
  public override fun setPresentationStyle(view: ReactModalHostView, value: String?): Unit = Unit

  @ReactProp(name = "animated")
  public override fun setAnimated(view: ReactModalHostView, value: Boolean): Unit = Unit

  @ReactProp(name = "supportedOrientations")
  public override fun setSupportedOrientations(
      view: ReactModalHostView,
      value: ReadableArray?
  ): Unit = Unit

  @ReactProp(name = "identifier")
  public override fun setIdentifier(view: ReactModalHostView, value: Int): Unit = Unit

  public override fun setTestId(view: ReactModalHostView, value: String?) {
>>>>>>> 2c830f7d0232ead70791aff6968a0e95ce850767
    super.setTestId(view, value)
    view.setDialogRootViewGroupTestId(value)
  }

<<<<<<< HEAD
  override fun addEventEmitters(reactContext: ThemedReactContext, view: ReactModalHostView) {
=======
  protected override fun addEventEmitters(
      reactContext: ThemedReactContext,
      view: ReactModalHostView
  ) {
>>>>>>> 2c830f7d0232ead70791aff6968a0e95ce850767
    val dispatcher = UIManagerHelper.getEventDispatcherForReactTag(reactContext, view.id)
    if (dispatcher != null) {
      view.onRequestCloseListener = OnRequestCloseListener {
        dispatcher.dispatchEvent(
            RequestCloseEvent(UIManagerHelper.getSurfaceId(reactContext), view.id))
      }
      view.onShowListener = OnShowListener {
        dispatcher.dispatchEvent(ShowEvent(UIManagerHelper.getSurfaceId(reactContext), view.id))
      }
      view.eventDispatcher = dispatcher
    }
  }

<<<<<<< HEAD
  override fun getExportedCustomDirectEventTypeConstants(): Map<String, Any> =
=======
  public override fun getExportedCustomDirectEventTypeConstants(): Map<String, Any> =
>>>>>>> 2c830f7d0232ead70791aff6968a0e95ce850767
      (super.getExportedCustomDirectEventTypeConstants() ?: mutableMapOf()).apply {
        put(RequestCloseEvent.EVENT_NAME, mapOf("registrationName" to "onRequestClose"))
        put(ShowEvent.EVENT_NAME, mapOf("registrationName" to "onShow")) // iOS only
        put("topDismiss", mapOf("registrationName" to "onDismiss")) // iOS only
        put("topOrientationChange", mapOf("registrationName" to "onOrientationChange"))
      }

<<<<<<< HEAD
  override fun onAfterUpdateTransaction(view: ReactModalHostView) {
=======
  protected override fun onAfterUpdateTransaction(view: ReactModalHostView) {
>>>>>>> 2c830f7d0232ead70791aff6968a0e95ce850767
    super.onAfterUpdateTransaction(view)
    view.showOrUpdate()
  }

<<<<<<< HEAD
  override fun updateState(
=======
  public override fun updateState(
>>>>>>> 2c830f7d0232ead70791aff6968a0e95ce850767
      view: ReactModalHostView,
      props: ReactStylesDiffMap,
      stateWrapper: StateWrapper
  ): Any? {
    view.stateWrapper = stateWrapper
    return null
  }

<<<<<<< HEAD
  override fun getDelegate(): ViewManagerDelegate<ReactModalHostView> = delegate

  companion object {
    const val REACT_CLASS: String = "RCTModalHostView"
=======
  public override fun getDelegate(): ViewManagerDelegate<ReactModalHostView> = delegate

  public companion object {
    public const val REACT_CLASS: String = "RCTModalHostView"
>>>>>>> 2c830f7d0232ead70791aff6968a0e95ce850767
  }
}
