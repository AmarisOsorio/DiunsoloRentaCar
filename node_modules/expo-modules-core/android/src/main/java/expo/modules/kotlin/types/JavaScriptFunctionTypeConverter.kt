package expo.modules.kotlin.types

import expo.modules.kotlin.AppContext
import expo.modules.kotlin.jni.CppType
import expo.modules.kotlin.jni.ExpectedType
import expo.modules.kotlin.jni.JavaScriptFunction
import kotlin.reflect.KType

class JavaScriptFunctionTypeConverter<T : Any>(
  val type: KType
<<<<<<< HEAD
) : NonNullableTypeConverter<JavaScriptFunction<T>>() {
  override fun convertNonNullable(value: Any, context: AppContext?, forceConversion: Boolean): JavaScriptFunction<T> {
=======
) : NullAwareTypeConverter<JavaScriptFunction<T>>(type.isMarkedNullable) {
  override fun convertNonOptional(value: Any, context: AppContext?): JavaScriptFunction<T> {
>>>>>>> 2c830f7d0232ead70791aff6968a0e95ce850767
    @Suppress("UNCHECKED_CAST")
    val jsFunction = value as JavaScriptFunction<T>
    jsFunction.returnType = requireNotNull(type.arguments.first().type)
    return jsFunction
  }

  override fun getCppRequiredTypes(): ExpectedType = ExpectedType(CppType.JS_FUNCTION)

  override fun isTrivial(): Boolean = false
}
